import{a as an,b as rn,c as mn,d as ln,e as cn,f as sn,g as dn}from"./chunk-SRH5RNIC.js";import"./chunk-664KCE5Z.js";import{a as be}from"./chunk-VHKOYFL3.js";import{a as en,b as tn}from"./chunk-YM7KQBEK.js";import{a as on}from"./chunk-JMTGRK3T.js";import{a as $t}from"./chunk-LXWDITUE.js";import"./chunk-7J5Y77OX.js";import{b as Y,d as j,e as ci,f as nn}from"./chunk-WVE4Y3TR.js";import{$b as bt,$e as et,A as Ve,Ae as At,B as Ct,Ba as P,Bb as wi,Bf as Yi,Ca as r,Ce as Ee,Da as E,Db as $e,E as T,Ea as b,Ed as je,Ef as ot,Fb as G,Fd as wt,Ff as ji,G as _t,Gb as ue,Gd as Ue,Ge as Ai,Gf as Ui,Hb as Qe,Hd as Ge,He as Pi,Hf as Gi,Ia as D,Ib as Ei,Id as ze,Ie as z,If as zi,J as y,Ja as gt,Jb as J,Jd as We,Jf as Ot,K as x,Ka as q,Kb as ve,Kd as Ke,Ke as Pe,Kf as Nt,La as we,Lb as Ce,Le as Ze,Nb as Ii,Nd as Li,Oa as _,Ob as xt,Od as Et,Pa as h,Pb as _e,Pe as k,Pf as he,Q as le,Qa as ct,Qe as Ri,Ra as Si,Sb as fe,Se as ye,Td as It,Te as Hi,U as ft,Ud as Je,Ue as Oi,Va as vt,Ve as Ni,Vf as Wi,Wd as Xe,We as Fi,X as m,Xe as Vi,Xf as Ft,Y as f,Ye as $i,Ze as Re,_a as yi,a as mi,aa as s,ae as Le,b as li,ba as vi,bc as Ie,ca as d,cb as U,da as ht,dc as Mi,df as Qi,e as A,ea as $,ec as Tt,ee as Ae,eg as Ki,fe as Mt,ff as tt,fg as Ji,ga as u,gc as Me,ge as X,ha as Q,hb as xi,he as Z,hf as Pt,ia as H,ib as bi,ic as qe,ie as ee,ja as O,jb as Ti,jc as Be,jf as qi,jg as Xi,ka as o,ke as te,la as a,le as ie,lg as L,ma as p,mb as B,na as g,ne,oa as v,ob as Di,oc as Dt,oe,of as xe,og as Vt,pg as Zi,q as gi,qa as I,qb as pe,qe as ae,qf as it,ra as S,rb as St,re,rg as w,sa as c,sb as W,sc as ki,sf as nt,sg as at,tb as K,tc as Ye,te as me,tf as Rt,tg as si,ub as yt,uc as ke,ue as Se,ug as di,vf as Ht,wa as ce,xa as se,y as ut,ya as de,ye as kt,ze as Lt,zf as Bi}from"./chunk-SAZ6MTOG.js";var un=(t,i)=>Ct(pi).canActivate(t,i);var pi=class t{constructor(i,e){this.authService=i;this.router=e}canActivate(i,e){return this.authService.getUser().hasSystemPrivilege("ControlCommandQueue")?!0:(this.router.navigate(["/403"],{queryParams:{page:e.url}}),!1)}canActivateChild(i,e){return this.canActivate(i,e)}static{this.\u0275fac=function(e){return new(e||t)(Ve(at),Ve(W))}}static{this.\u0275prov=ut({token:t,factory:t.\u0275fac,providedIn:"root"})}};var bn=()=>({matrixParams:"exact",paths:"exact",queryParams:"ignored"}),Cn=t=>({c:t}),rt=class t{constructor(i){this.yamcs=i}static{this.\u0275fac=function(e){return new(e||t)(f(L))}}static{this.\u0275cmp=T({type:t,selectors:[["app-clearances-page-tabs"]],standalone:!0,features:[D],decls:10,vars:12,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["tabPanel",""],["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","/commanding/clearances","routerLinkActive","",3,"routerLinkActiveOptions","active","queryParams"],["mat-tab-link","","routerLink","/commanding/clearances/log","routerLinkActive","",3,"active","queryParams"]],template:function(e,n){if(e&1&&(o(0,"nav",3)(1,"a",4,0),r(3," Clearances "),a(),o(4,"a",5,1),r(6," Action log "),a()(),o(7,"mat-tab-nav-panel",null,2),p(9,"router-outlet"),a()),e&2){let l=P(2),C=P(5),M=P(8);d("mat-stretch-tabs",!1)("tabPanel",M),m(),d("routerLinkActiveOptions",gt(7,bn))("active",l.isActive)("queryParams",q(8,Cn,n.yamcs.context)),m(3),d("active",C.isActive)("queryParams",q(10,Cn,n.yamcs.context))}},dependencies:[w,St,K,yt,kt,At,Lt],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}"],changeDetection:0})}};function Tn(t,i){if(t&1){let e=I();p(0,"ya-date-time-input",14)(1,"ya-date-time-input",15),o(2,"ya-button",16),S("click",function(){y(e);let l=c();return x(l.applyCustomDates())}),r(3,"Apply"),a()}if(t&2){let e=c();m(2),d("disabled",e.filterForm.invalid)}}function Dn(t,i){if(t&1){let e=I();o(0,"ya-button",17),S("click",function(){y(e);let l=c();return x(l.jumpToNow())}),r(1,"Jump to now"),a()}}function wn(t,i){t&1&&(o(0,"th",18),r(1,"Time"),a())}function En(t,i){if(t&1&&(o(0,"td",19),r(1),_(2,"datetime"),a()),t&2){let e=i.$implicit;m(),E(h(2,1,e.time))}}function In(t,i){t&1&&(o(0,"th",18),r(1,"User"),a())}function Mn(t,i){if(t&1&&(o(0,"td",19),r(1),a()),t&2){let e=i.$implicit;m(),E(e.user||"-")}}function kn(t,i){t&1&&(o(0,"th",18),r(1,"Action"),a())}function Ln(t,i){if(t&1&&(o(0,"td",19),p(1,"span",20),_(2,"actionLogFormat"),a()),t&2){let e=i.$implicit;m(),d("innerHTML",h(2,1,e.summary)||"-",ft)}}function An(t,i){t&1&&p(0,"th",21)}function Pn(t,i){t&1&&p(0,"td",19)}function Rn(t,i){t&1&&p(0,"tr",22)}function Hn(t,i){t&1&&p(0,"tr",23)}var Qt=class t{constructor(i,e,n,l,C){this.yamcs=i;this.messageService=e;this.router=n;this.route=l;this.interval=le();this.customStart=le();this.customStop=le();this.filterForm=new Qe({interval:new J("NO_LIMIT"),customStart:new J(null),customStop:new J(null)});this.displayedColumns=["time","user","summary","actions"];this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.dataSource=new Se;C.setTitle("Clearances")}ngOnInit(){this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(i=>{if(i==="CUSTOM"){let e=new Date,n=this.validStart||e,l=this.validStop||e;this.filterForm.get("customStart").setValue(k.toISOString(n)),this.filterForm.get("customStop").setValue(k.toISOString(l))}else i==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=i,this.loadData()):i&&(this.validStop=new Date,this.validStart=k.subtractDuration(this.validStop,i),this.appliedInterval=i,this.loadData())})}initializeOptions(){if(this.interval())if(this.appliedInterval=this.interval(),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let i=this.customStart();this.filterForm.get("customStart").setValue(i),this.validStart=k.toDate(i);let e=this.customStop();this.filterForm.get("customStop").setValue(e),this.validStop=k.toDate(e)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=k.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){let{controls:i}=this.filterForm;this.validStart=k.toDate(i.customStart.value),this.validStop=k.toDate(i.customStop.value),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let i={service:"ClearanceApi"};this.validStart&&(i.start=this.validStart.toISOString()),this.validStop&&(i.stop=this.validStop.toISOString()),this.yamcs.yamcsClient.getAuditRecords("_global",i).then(e=>this.dataSource.data=e.records||[]).catch(e=>this.messageService.showError(e))}updateURL(){let{controls:i}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?i.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?i.customStop.value:null},queryParamsHandling:"merge"})}static{this.\u0275fac=function(e){return new(e||t)(f(L),f(xe),f(W),f(pe),f(B))}}static{this.\u0275cmp=T({type:t,selectors:[["app-clearances-action-log-tab"]],inputs:{interval:[1,"interval"],customStart:[1,"customStart"],customStop:[1,"customStop"]},standalone:!0,features:[D],decls:25,vars:7,consts:[[1,"panel-content"],[2,"margin-top","16px",3,"formGroup"],[1,"filter-bar"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","user"],["matColumnDef","summary"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"innerHTML"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(e,n){e&1&&(o(0,"app-instance-page")(1,"app-instance-toolbar"),r(2,"Clearances"),a(),o(3,"div",0),p(4,"app-clearances-page-tabs"),o(5,"form",1)(6,"div",2),p(7,"ya-select",3),s(8,Tn,4,1)(9,Dn,2,0,"ya-button"),a()(),o(10,"table",4),g(11,5),s(12,wn,2,0,"th",6)(13,En,3,3,"td",7),v(),g(14,8),s(15,In,2,0,"th",6)(16,Mn,2,1,"td",7),v(),g(17,9),s(18,kn,2,0,"th",6)(19,Ln,3,3,"td",7),v(),g(20,10),s(21,An,1,0,"th",11)(22,Pn,1,0,"td",7),v(),s(23,Rn,1,0,"tr",12)(24,Hn,1,0,"tr",13),a()()()),e&2&&(m(5),d("formGroup",n.filterForm),m(2),d("options",n.intervalOptions),m(),u(n.filterForm.value.interval==="CUSTOM"?8:-1),m(),u(n.filterForm.value.interval!=="CUSTOM"?9:-1),m(),d("dataSource",n.dataSource),m(13),d("matHeaderRowDef",n.displayedColumns),m(),d("matRowDefColumns",n.displayedColumns))},dependencies:[rt,j,Y,w,Ce,G,ue,_e,fe,X,ee,oe,te,Z,ae,ie,ne,re,me,z,ye,Re,Ot,he],encapsulation:2,changeDetection:0})}};var _n=(t,i)=>Ct(ui).canActivate(t,i);var ui=class t{constructor(i,e){this.router=e;this.config=i.getConfig()}canActivate(i,e){return this.config.commandClearanceEnabled}canActivateChild(i,e){return this.canActivate(i,e)}static{this.\u0275fac=function(e){return new(e||t)(Ve(Ze),Ve(W))}}static{this.\u0275prov=ut({token:t,factory:t.\u0275fac,providedIn:"root"})}};var qt=class t{constructor(i,e,n){this.dialogRef=i;this.data=n;if(this.form=e.group({level:new ve(null,[$e.required])}),n.clearance){let l=n.clearance;this.form.setValue({level:l.level||"DISABLED"})}}confirm(){this.dialogRef.close({level:this.form.value.level==="DISABLED"?void 0:this.form.value.level})}static{this.\u0275fac=function(e){return new(e||t)(f(je),f(bt),f(wt))}}static{this.\u0275cmp=T({type:t,selectors:[["app-change-level-dialog"]],standalone:!0,features:[D],decls:31,vars:8,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["type","radio","formControlName","level","value","DISABLED"],[2,"font-weight","normal"],["type","radio","formControlName","level","value","NONE"],["level","NONE",3,"grayscale"],["type","radio","formControlName","level","value","WATCH"],["level","WATCH",3,"grayscale"],["type","radio","formControlName","level","value","WARNING"],["level","WARNING",3,"grayscale"],["type","radio","formControlName","level","value","DISTRESS"],["level","DISTRESS",3,"grayscale"],["type","radio","formControlName","level","value","CRITICAL"],["level","CRITICAL",3,"grayscale"],["type","radio","formControlName","level","value","SEVERE"],["level","SEVERE",3,"grayscale"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,n){e&1&&(o(0,"h2",0),r(1,"Command clearance"),a(),o(2,"mat-dialog-content")(3,"form",1)(4,"label"),p(5,"input",2),o(6,"span",3),r(7,"No clearance"),a()(),o(8,"label"),p(9,"input",4)(10,"app-significance-level",5),a(),o(11,"label"),p(12,"input",6)(13,"app-significance-level",7),a(),o(14,"label"),p(15,"input",8)(16,"app-significance-level",9),a(),o(17,"label"),p(18,"input",10)(19,"app-significance-level",11),a(),o(20,"label"),p(21,"input",12)(22,"app-significance-level",13),a(),o(23,"label"),p(24,"input",14)(25,"app-significance-level",15),a()()(),o(26,"mat-dialog-actions",16)(27,"ya-button",17),r(28,"CANCEL"),a(),o(29,"ya-button",18),S("click",function(){return n.confirm()}),r(30," SAVE CHANGES "),a()()),e&2&&(m(3),d("formGroup",n.form),m(7),d("grayscale",!0),m(3),d("grayscale",!0),m(3),d("grayscale",!0),m(3),d("grayscale",!0),m(3),d("grayscale",!0),m(3),d("grayscale",!0),m(4),d("disabled",!n.form.valid))},dependencies:[w,Ce,wi,Ii,G,ue,_e,fe,Ge,ze,Ke,We,z,be],styles:["[_ngcontent-%COMP%]:focus{outline:none}"]})}};function Fn(t,i){if(t&1){let e=I();o(0,"th",18)(1,"input",19),S("change",function(l){y(e);let C=c(2);return x(l?C.masterToggle():null)}),a()()}if(t&2){let e=c(2);m(),d("checked",e.selection.hasValue()&&e.isAllSelected())}}function Vn(t,i){if(t&1){let e=I();o(0,"td",20)(1,"input",21),S("click",function(l){return y(e),x(l.stopPropagation())})("change",function(l){let C=y(e).$implicit,M=c(2);return x(l?M.selection.toggle(C):null)}),a()()}if(t&2){let e=i.$implicit,n=c(2);m(),d("checked",n.selection.isSelected(e))}}function $n(t,i){t&1&&(o(0,"th",22),r(1,"Username"),a())}function Qn(t,i){if(t&1&&(o(0,"td",23),r(1),a()),t&2){let e=i.$implicit;m(),b(" ",e.username," ")}}function qn(t,i){t&1&&(o(0,"th",22),r(1,"May Command"),a())}function Bn(t,i){if(t&1&&(o(0,"td",23),r(1),a()),t&2){let e=i.$implicit;m(),b(" ",e.hasCommandPrivileges?"Yes":"-"," ")}}function Yn(t,i){t&1&&(o(0,"th",22),r(1,"Clearance Level"),a())}function jn(t,i){t&1&&r(0," No clearance ")}function Un(t,i){if(t&1&&p(0,"app-significance-level",24),t&2){let e=c().$implicit;d("level",e.level)("grayscale",!0)}}function Gn(t,i){if(t&1&&(o(0,"td",23),s(1,jn,1,0)(2,Un,1,2,"app-significance-level",24),a()),t&2){let e=i.$implicit;m(),u(e.level?2:1)}}function zn(t,i){t&1&&(o(0,"th",22),r(1,"Issued"),a())}function Wn(t,i){if(t&1&&r(0),t&2){let e=c().$implicit;b(" by ",e.issuedBy," ")}}function Kn(t,i){if(t&1&&(o(0,"td",23),r(1),_(2,"datetime"),s(3,Wn,1,1),a()),t&2){let e=i.$implicit;m(),b(" ",h(2,2,e.issueTime)||"-"," "),m(2),u(e.issuedBy?3:-1)}}function Jn(t,i){t&1&&p(0,"th",25)}function Xn(t,i){t&1&&p(0,"td",26)}function Zn(t,i){t&1&&p(0,"tr",27)}function eo(t,i){if(t&1){let e=I();o(0,"tr",28),S("click",function(){let l=y(e).$implicit,C=c(2);return x(C.toggleOne(l))}),a()}if(t&2){let e=i.$implicit,n=c(2);$("selected",n.selection.isSelected(e))}}function to(t,i){if(t&1&&(o(0,"table",2),g(1,4),s(2,Fn,2,1,"th",5)(3,Vn,2,1,"td",6),v(),g(4,7),s(5,$n,2,0,"th",8)(6,Qn,2,1,"td",9),v(),g(7,10),s(8,qn,2,0,"th",8)(9,Bn,2,1,"td",9),v(),g(10,11),s(11,Yn,2,0,"th",8)(12,Gn,3,1,"td",9),v(),g(13,12),s(14,zn,2,0,"th",8)(15,Kn,4,4,"td",9),v(),g(16,13),s(17,Jn,1,0,"th",14)(18,Xn,1,0,"td",15),v(),s(19,Zn,1,0,"tr",16)(20,eo,1,2,"tr",17),a()),t&2){let e=c();d("dataSource",e.dataSource),m(19),d("matHeaderRowDef",e.displayedColumns),m(),d("matRowDefColumns",e.displayedColumns)}}var Bt=class t{constructor(i,e,n){this.yamcs=i;this.dialog=n;this.displayedColumns=["select","username","hasCommandPrivileges","level","issued","actions"];this.dataSource=new Se;this.selection=new Tt(!0,[]);e.setTitle("Clearances"),this.refresh()}ngAfterViewInit(){this.dataSource.sort=this.sort,this.dataSource.paginator=this.paginator}isAllSelected(){let i=this.selection.selected.length,e=this.dataSource.filteredData.length;return i===e&&e>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.filteredData.forEach(i=>this.selection.select(i))}toggleOne(i){(!this.selection.isSelected(i)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(i)}refresh(){this.selection.clear(),this.yamcs.yamcsClient.getClearances().then(i=>{this.dataSource.data=i.clearances||[]})}isGroupChangeLevelEnabled(){return!this.selection.isEmpty()}openChangeLevelDialog(){let i;this.selection.selected.length===1&&(i=this.selection.selected[0]),this.dialog.open(qt,{data:{clearance:i},width:"400px"}).afterClosed().subscribe(n=>{if(n){let l=[];if(n.level)for(let C of this.selection.selected)l.push(this.yamcs.yamcsClient.changeClearance(C.username,{level:n.level}));else for(let C of this.selection.selected)l.push(this.yamcs.yamcsClient.deleteClearance(C.username));l.length&&Promise.all(l).then(()=>this.refresh())}})}static{this.\u0275fac=function(e){return new(e||t)(f(L),f(B),f(Ue))}}static{this.\u0275cmp=T({type:t,selectors:[["ng-component"]],viewQuery:function(e,n){if(e&1&&(ce(Ae,5),ce(Le,5)),e&2){let l;se(l=de())&&(n.sort=l.first),se(l=de())&&(n.paginator=l.first)}},standalone:!0,features:[D],decls:15,vars:5,consts:[["icon","how_to_reg",3,"click","disabled"],[1,"panel-content"],["mat-table","","matSort","","matSortActive","username","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",2,"margin-top","16px",3,"dataSource"],[3,"pageSize","hidePageSize","showFirstLastButtons"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["matColumnDef","username"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","hasCommandPrivileges"],["matColumnDef","level"],["matColumnDef","issued"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","expand",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"change","checked"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"click","change","checked"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[3,"level","grayscale"],["mat-header-cell",""],["mat-cell","",1,"expand"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,n){e&1&&(o(0,"app-instance-page")(1,"app-instance-toolbar"),r(2," Clearances "),o(3,"ya-help")(4,"p"),r(5," Clearances allow central control over the level of commands that users are able to send. "),a(),o(6,"p"),r(7," Clearance works in addition to regular permission checks. So if a user does anyway not have authorization to send certain commands, giving this user clearance will not change this fact. "),a()(),r(8," \xA0\xA0\xA0 "),o(9,"ya-page-button",0),S("click",function(){return n.openChangeLevelDialog()}),r(10," Change level "),a()(),o(11,"div",1),p(12,"app-clearances-page-tabs"),s(13,to,21,3,"table",2),p(14,"mat-paginator",3),a()()),e&2&&(m(9),d("disabled",!n.isGroupChangeLevelEnabled()),m(4),u(n.dataSource?13:-1),m(),d("pageSize",100)("hidePageSize",!0)("showFirstLastButtons",!0))},dependencies:[rt,j,Y,w,It,Je,Xe,Le,Ae,Mt,X,ee,oe,te,Z,ae,ie,ne,re,me,tt,nt,he,be],encapsulation:2,changeDetection:0})}};var io=(t,i)=>i.name;function no(t,i){if(t&1&&(o(0,"tr")(1,"td",1),r(2),a(),o(3,"td",2),p(4,"ya-value",3),a()()),t&2){let e=i.$implicit;m(2),E(e.name),m(2),d("value",e.value)}}var lt=class t{constructor(){this.nomargin=!1}static{this.\u0275fac=function(e){return new(e||t)}}static{this.\u0275cmp=T({type:t,selectors:[["app-command-arguments"]],hostVars:2,hostBindings:function(e,n){e&2&&$("nomargin",n.nomargin)},inputs:{command:"command",nomargin:"nomargin"},standalone:!0,features:[D],decls:3,vars:0,consts:[[1,"args"],["width","1",1,"key"],[1,"value"],[3,"value"]],template:function(e,n){e&1&&(o(0,"table",0),H(1,no,5,2,"tr",null,io),a()),e&2&&(m(),O(n.command.userAssignments))},dependencies:[w,ji],styles:[".args[_ngcontent-%COMP%]{margin:0 0 0 10px}.args[_ngcontent-%COMP%]   .key[_ngcontent-%COMP%]{min-width:80px;white-space:nowrap;vertical-align:top}.args[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:gray;padding-left:10px}.nomargin[_nghost-%COMP%]   .args[_ngcontent-%COMP%], .nomargin[_nghost-%COMP%]   .args[_ngcontent-%COMP%]   td.key[_ngcontent-%COMP%]:first-child{margin-left:0!important;padding-left:0!important}.nomargin[_nghost-%COMP%]   .args[_ngcontent-%COMP%]{border-spacing:0}"],changeDetection:0})}};var oo=/yamcs<([^>]+)>_/g,Yt=class t{transform(i){if(!i||!i.startsWith("yamcs<"))return i;let e,n=[];for(;e=oo.exec(i);)n.push(e[1]);return n.length?n[n.length-1]:i}static{this.\u0275fac=function(e){return new(e||t)}}static{this.\u0275pipe=_t({name:"cascadingPrefix",type:t,pure:!0,standalone:!0})}};var ro=(t,i)=>i.key,mo=(t,i)=>i.name;function lo(t,i){if(t&1){let e=I();o(0,"div",2),r(1," Unprocessed binary "),o(2,"ya-more",7)(3,"button",8),S("click",function(){y(e);let l=c();return x(l.copyHex(l.command.unprocessedBinary))}),r(4,"Copy Hex"),a(),o(5,"button",8),S("click",function(){y(e);let l=c();return x(l.copyBinary(l.command.unprocessedBinary))}),r(6,"Copy Binary"),a()()(),o(7,"div",9),p(8,"app-hex",10),a(),o(9,"div",11)(10,"pre"),r(11),_(12,"hexDump"),a()()}if(t&2){let e=c();m(8),d("base64String",e.command.unprocessedBinary),m(3),E(h(12,2,e.command.unprocessedBinary)||"-")}}function co(t,i){if(t&1){let e=I();o(0,"div",2),r(1," Binary "),o(2,"ya-more",7)(3,"button",8),S("click",function(){y(e);let l=c();return x(l.copyHex(l.command.binary))}),r(4,"Copy Hex"),a(),o(5,"button",8),S("click",function(){y(e);let l=c();return x(l.copyBinary(l.command.binary))}),r(6,"Copy Binary"),a()()(),o(7,"div",9),p(8,"app-hex",10),a(),o(9,"div",11)(10,"pre"),r(11),_(12,"hexDump"),a()()}if(t&2){let e=c();m(8),d("base64String",e.command.binary),m(3),E(h(12,2,e.command.binary)||"-")}}function so(t,i){if(t&1&&r(0),t&2){let e=c();b(" @",e.command.origin," ")}}function po(t,i){if(t&1&&(o(0,"div",2),r(1,"Queue"),a(),o(2,"div",1),r(3),a()),t&2){let e=c();m(3),b(" ",e.command.queue||"-"," ")}}function uo(t,i){if(t&1&&(p(0,"mat-divider",5),o(1,"div",0),r(2,"Comment"),a(),o(3,"div",1),r(4),a()),t&2){let e=c();m(4),b(" ",e.command.comment," ")}}function Co(t,i){if(t&1){let e=I();o(0,"ya-more",7)(1,"button",8),S("click",function(){y(e);let l=c().$implicit,C=c(2);return x(C.copyHex(l.value.binaryValue))}),r(2,"Copy Hex"),a(),o(3,"button",8),S("click",function(){y(e);let l=c().$implicit,C=c(2);return x(C.copyBinary(l.value.binaryValue))}),r(4,"Copy Binary"),a()()}}function _o(t,i){if(t&1&&(o(0,"div",9),p(1,"app-hex",10),a(),o(2,"div",11)(3,"pre"),r(4),_(5,"hexDump"),a()()),t&2){let e=c().$implicit;m(),d("base64String",e.value.binaryValue),m(3),E(h(5,2,e.value.binaryValue)||"-")}}function fo(t,i){if(t&1&&(o(0,"div",1),r(1),_(2,"value"),a()),t&2){let e=c().$implicit;m(),b(" ",h(2,1,e.value)," ")}}function ho(t,i){if(t&1&&(o(0,"div",2),r(1),s(2,Co,5,0,"ya-more",7),a(),s(3,_o,6,4)(4,fo,3,3,"div",1)),t&2){let e,n=i.$implicit,l=i.$index;$("first",l===0),m(),b(" ",n.name," "),m(),u(n.value.type==="BINARY"?2:-1),m(),u((e=n.value.type)==="BINARY"?3:4)}}function go(t,i){if(t&1&&(p(0,"mat-divider",5),H(1,ho,5,5,null,null,mo)),t&2){let e=c();m(),O(e.command.extra)}}function vo(t,i){if(t&1&&(o(0,"div",2),r(1,"Extra acknowledgments"),a(),o(2,"div",1),p(3,"app-extra-acknowledgments-table",6),a()),t&2){let e=c();m(3),d("command",e.command)("showIcons",e.showIcons)}}function So(t,i){if(t&1){let e=I();o(0,"ya-more",7)(1,"button",8),S("click",function(){y(e);let l=c(),C=c();return x(C.copyHex(l.binaryValue))}),r(2,"Copy Hex"),a(),o(3,"button",8),S("click",function(){y(e);let l=c(),C=c();return x(C.copyBinary(l.binaryValue))}),r(4,"Copy Binary"),a()()}}function yo(t,i){if(t&1&&(o(0,"div",9),p(1,"app-hex",10),a(),o(2,"div",11)(3,"pre"),r(4),_(5,"hexDump"),a()()),t&2){let e=c();m(),d("base64String",e.binaryValue),m(3),E(h(5,2,e.binaryValue)||"-")}}function xo(t,i){if(t&1&&(o(0,"div",1)(1,"pre",12),r(2),a()()),t&2){let e=c();m(2),E(e.stringValue)}}function bo(t,i){if(t&1&&(o(0,"div",1),r(1),_(2,"value"),a()),t&2){let e=c();m(),b(" ",h(2,1,e)," ")}}function To(t,i){if(t&1&&(p(0,"mat-divider",5),o(1,"div",0),r(2," Return value "),s(3,So,5,0,"ya-more",7),a(),s(4,yo,6,4)(5,xo,3,1,"div",1)(6,bo,3,3,"div",1)),t&2){let e,n=i;m(3),u(n.type==="BINARY"?3:-1),m(),u((e=n.type)==="BINARY"?4:e==="STRING"?5:6)}}function Do(t,i){t&1&&r(0," SUCCESS ")}function wo(t,i){if(t&1&&r(0),t&2){let e=c();b(" FAILURE: ",e.command.completed==null?null:e.command.completed.message," ")}}function Eo(t,i){t&1&&r(0," - ")}function Io(t,i){if(t&1&&(o(0,"div",2),r(1),_(2,"cascadingPrefix"),a(),o(3,"div",1),p(4,"app-extra-acknowledgments-table",6),a()),t&2){let e=c().$implicit,n=c();m(),b("",h(2,3,e.key)," extra acknowledgments"),m(3),d("command",e.value)("showIcons",n.showIcons)}}function Mo(t,i){t&1&&r(0," SUCCESS ")}function ko(t,i){if(t&1&&r(0),t&2){let e=c().$implicit;b(" FAILURE: ",e.value.completed==null?null:e.value.completed.message," ")}}function Lo(t,i){t&1&&r(0," - ")}function Ao(t,i){if(t&1&&(p(0,"mat-divider",5),o(1,"div",0),r(2),_(3,"cascadingPrefix"),a(),o(4,"div",1),p(5,"app-yamcs-acknowledgments-table",6),a(),s(6,Io,5,5),o(7,"div",2),r(8),_(9,"cascadingPrefix"),a(),o(10,"div",1),s(11,Mo,1,0)(12,ko,1,1)(13,Lo,1,0),a()),t&2){let e=i.$implicit,n=c();m(2),b(" ",h(3,8,e.key)," acknowledgments "),m(3),d("command",e.value)("showIcons",n.showIcons),m(),u(e.value.extraAcks.length?6:-1),m(2),b("",h(9,10,e.key)," completion"),m(3),u((e.value.completed==null?null:e.value.completed.status)==="OK"?11:-1),m(),u((e.value.completed==null?null:e.value.completed.status)==="NOK"?12:-1),m(),u(e.value.completed?-1:13)}}var Te=class t{constructor(i){this.clipboard=i;this.showIcons=!0}copyHex(i){let e=k.convertBase64ToHex(i);this.clipboard.copy(e)}copyBinary(i){let e=window.atob(i);this.clipboard.copy(e)}static{this.\u0275fac=function(e){return new(e||t)(f(Et))}}static{this.\u0275cmp=T({type:t,selectors:[["app-command-detail2"]],inputs:{command:"command",showIcons:"showIcons"},standalone:!0,features:[D],decls:41,vars:22,consts:[[1,"block-title",2,"padding-top","0"],[1,"block"],[1,"block-title"],[1,"block","command-text"],[3,"command"],[2,"margin-top","1em","margin-bottom","1em"],[3,"command","showIcons"],["icon","more_horiz"],["mat-menu-item","",3,"click"],[1,"block","no-print",2,"margin-top","4px"],[3,"base64String"],[1,"block","print-only"],[2,"margin","0","line-height","1em"]],template:function(e,n){if(e&1&&(o(0,"div",0),r(1,"ID"),a(),o(2,"div",1),r(3),a(),o(4,"div",2),r(5,"Command"),a(),o(6,"div",3),r(7),p(8,"app-command-arguments",4),a(),s(9,lo,13,4)(10,co,13,4),p(11,"mat-divider",5),o(12,"div",0),r(13,"Time"),a(),o(14,"div",1),r(15),_(16,"datetime"),a(),o(17,"div",2),r(18,"Issuer"),a(),o(19,"div",1),r(20),s(21,so,1,1),a(),s(22,po,4,1)(23,uo,5,1)(24,go,3,0),p(25,"mat-divider",5),o(26,"div",0),r(27,"Yamcs acknowledgments"),a(),o(28,"div",1),p(29,"app-yamcs-acknowledgments-table",6),a(),s(30,vo,4,2)(31,To,7,2),o(32,"div",2),r(33,"Completion"),a(),o(34,"div",1),s(35,Do,1,0)(36,wo,1,1)(37,Eo,1,0),a(),H(38,Ao,14,12,null,null,ro),_(40,"keyvalue")),e&2){let l;m(3),b(" ",n.command.id,`
`),m(4),b(" ",n.command.commandName," "),m(),d("command",n.command),m(),u(n.command.unprocessedBinary&&n.command.unprocessedBinary!==n.command.binary?9:-1),m(),u(n.command.binary?10:-1),m(5),b(" ",h(16,18,n.command.generationTime),`
`),m(5),b(" ",n.command.username," "),m(),u(n.command.origin?21:-1),m(),u(n.command.queue?22:-1),m(),u(n.command.comment?23:-1),m(),u(n.command.extra.length?24:-1),m(5),d("command",n.command)("showIcons",n.showIcons),m(),u(n.command.extraAcks.length?30:-1),m(),u((l=n.command.completed==null?null:n.command.completed.returnValue)?31:-1,l),m(4),u((n.command.completed==null?null:n.command.completed.status)==="OK"?35:-1),m(),u((n.command.completed==null?null:n.command.completed.status)==="NOK"?36:-1),m(),u(n.command.completed?-1:37),m(),O(h(40,20,n.command.cascadedRecordsByPrefix))}},dependencies:[Yt,lt,rn,$t,w,xi,ke,Me,it,he,Ft,ot,ln],styles:[".block-title.first[_ngcontent-%COMP%]{padding-top:0}"],changeDetection:0})}};function Po(t,i){if(t&1&&p(0,"app-command-detail2",0)(1,"div",1),t&2){let e=i.$implicit;d("command",e)("showIcons",!1)}}var jt=class t{static{this.\u0275fac=function(e){return new(e||t)}}static{this.\u0275cmp=T({type:t,selectors:[["app-command-history-printable"]],inputs:{pageTitle:"pageTitle",data:"data"},standalone:!0,features:[D],decls:2,vars:0,consts:[[3,"command","showIcons"],[2,"page-break-after","always"]],template:function(e,n){e&1&&H(0,Po,2,2,null,null,Q),e&2&&O(n.data)},dependencies:[Te,w],encapsulation:2,changeDetection:0})}};var Ut=class t{constructor(i,e,n){this.dialogRef=i;this.yamcs=e;this.data=n;this.delimiterOptions=[{id:"COMMA",label:"Comma"},{id:"SEMICOLON",label:"Semicolon"},{id:"TAB",label:"Tab"}];this.downloadURL$=new A(null);this.form=new Ei({start:new ve(null),stop:new ve(null),delimiter:new ve(null,$e.required)});this.form.setValue({start:n.start?k.toISOString(n.start):"",stop:n.stop?k.toISOString(n.stop):"",delimiter:"TAB"}),this.formChangeSubscription=this.form.valueChanges.subscribe(()=>{this.updateURL()}),this.updateURL()}closeDialog(){this.dialogRef.close(!0)}updateURL(){if(this.form.valid){let i={delimiter:this.form.value.delimiter};this.form.value.start&&(i.start=k.toISOString(this.form.value.start)),this.form.value.stop&&(i.stop=k.toISOString(this.form.value.stop));let e=this.yamcs.yamcsClient.getCommandsDownloadURL(this.yamcs.instance,i);this.downloadURL$.next(e)}else this.downloadURL$.next(null)}ngOnDestroy(){this.formChangeSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||t)(f(je),f(L),f(wt))}}static{this.\u0275cmp=T({type:t,selectors:[["ng-component"]],standalone:!0,features:[D],decls:22,vars:6,consts:[["mat-dialog-title",""],[1,"ya-form"],[3,"formGroup"],["formControlName","start"],["formControlName","stop"],["formControlName","delimiter",3,"options"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","link","disabled"]],template:function(e,n){e&1&&(o(0,"h2",0),r(1,"Export commands"),a(),o(2,"mat-dialog-content",1)(3,"form",2)(4,"label"),r(5," Start "),p(6,"ya-date-time-input",3),a(),p(7,"br"),o(8,"label"),r(9," Stop "),p(10,"ya-date-time-input",4),a(),p(11,"br"),o(12,"label"),r(13," CSV column delimiter "),p(14,"br")(15,"ya-select",5),a()()(),o(16,"mat-dialog-actions",6)(17,"ya-button",7),r(18,"CANCEL"),a(),o(19,"ya-download-button",8),_(20,"async"),S("click",function(){return n.closeDialog()}),r(21," DOWNLOAD "),a()()),e&2&&(m(3),d("formGroup",n.form),m(12),d("options",n.delimiterOptions),m(4),d("link",h(20,4,n.downloadURL$))("disabled",!n.form.valid))},dependencies:[w,U,Ce,G,ue,_e,fe,Ge,ze,Ke,We,z,ye,Fi,Re],encapsulation:2})}};var Gt=class t{constructor(i){this.yamcs=i}transform(i){if(!i)return null;let e=this.yamcs.instance;return this.yamcs.yamcsClient.getCommandDownloadURL(e,i.id)}static{this.\u0275fac=function(e){return new(e||t)(f(L,16))}}static{this.\u0275pipe=_t({name:"commandDownloadLink",type:t,pure:!0,standalone:!0})}};var zt=class{constructor(i){this.watermarkObserver=i;this.dirty=!1;this.archiveRecords=[];this.bufferSize=500;this.bufferWatermark=400;this.pointer=0;this.alreadyWarned=!1;this.realtimeBuffer=Array(this.bufferSize).fill(void 0)}addArchiveData(i){this.archiveRecords=this.archiveRecords.concat(i),this.dirty=!0}addRealtimeCommand(i){this.pointer<this.bufferSize&&(this.realtimeBuffer[this.pointer]=i,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.alreadyWarned=!0,this.watermarkObserver()),this.pointer=this.pointer+1),this.dirty=!0}reset(){this.archiveRecords=[],this.realtimeBuffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.dirty=!0}snapshot(){let i=[...this.archiveRecords];return this.realtimeBuffer.map(e=>{if(!e)return;let n=i.findIndex(l=>l.id==e.id);n===-1?i.push(new Ee(e)):i[n]=i[n].mergeEntry(e)}),i.sort((e,n)=>{let l=-e.generationTime.localeCompare(n.generationTime);return l===0&&(l=-e.origin.localeCompare(n.origin)),l!==0?l:n.sequenceNumber-e.sequenceNumber}),i}compact(i){let e=this.snapshot();e.length=Math.min(i,e.length),this.reset(),this.archiveRecords=e,this.dirty=!0}};var Wt=class extends Mi{constructor(e,n){super();this.yamcs=e;this.pageSize=100;this.blockHasMore=!1;this.records$=new A([]);this.loading$=new A(!1);this.streaming$=new A(!1);this.namespaces$=new A([]);this.syncSubscription=n.sync(()=>{this.buffer.dirty&&!this.loading$.getValue()&&(this.emitCommands(),this.buffer.dirty=!1)}),this.buffer=new zt(()=>{this.blockHasMore=!0,this.buffer.compact(500)})}connect(){return this.records$}emitCommands(){this.records$.next(this.buffer.snapshot())}loadEntries(e){return this.loading$.next(!0),this.loadPage(li(mi({},e),{limit:this.pageSize})).then(n=>{this.buffer.reset(),this.blockHasMore=!1,this.buffer.addArchiveData(n.map(l=>new Ee(l))),this.emitCommands()}).finally(()=>{this.loading$.next(!1)})}hasMore(){return!!this.continuationToken&&!this.blockHasMore}async loadPage(e){return this.yamcs.yamcsClient.getCommandHistoryEntries(this.yamcs.instance,e).then(n=>{this.continuationToken=n.continuationToken;var l=n.commands||[];for(let C of l)this.updateNamespaces(C);return l})}async loadMoreData(e){if(this.continuationToken)return this.loadPage(li(mi({},e),{next:this.continuationToken,limit:this.pageSize})).then(n=>{let l=n.map(C=>new Ee(C));this.buffer.addArchiveData(l),this.emitCommands()})}startStreaming(){this.streaming$.next(!0),this.realtimeSubscription=this.yamcs.yamcsClient.createCommandSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor},e=>{this.loading$.getValue()||(this.updateNamespaces(e),this.buffer.addRealtimeCommand(e))})}updateNamespaces(e){let n=this.namespaces$.value;if(e.aliases)for(let l in e.aliases)n.indexOf(l)===-1&&(n.push(l),n.sort(),this.namespaces$.next([...n]))}stopStreaming(){this.realtimeSubscription?.cancel(),this.streaming$.next(!1)}disconnect(){this.syncSubscription?.unsubscribe(),this.records$.complete(),this.loading$.complete(),this.streaming$.complete(),this.namespaces$.complete()}isEmpty(){return!this.records$.getValue().length}};var gn=(t,i)=>({c:t,template:i}),Ho=()=>["detail"],Oo=t=>["/commanding/history",t],No=t=>({c:t});function Fo(t,i){if(t&1){let e=I();o(0,"ya-page-button",9),S("click",function(){y(e);let l=c();return x(l.startStreaming())}),r(1,"Start streaming"),a()}}function Vo(t,i){if(t&1){let e=I();o(0,"ya-page-button",10),S("click",function(){y(e);let l=c();return x(l.stopStreaming())}),r(1," Stop streaming "),a()}}function $o(t,i){if(t&1&&(p(0,"br")(1,"mat-divider")(2,"br"),o(3,"ya-button",13),r(4," Resend "),a()),t&2){let e=c(),n=c();m(3),d("routerLink","/commanding/send"+(e==null?null:e.commandName))("queryParams",we(2,gn,n.yamcs.context,e==null?null:e.id))}}function Qo(t,i){if(t&1&&(o(0,"ya-detail-toolbar"),r(1,"Command Detail"),a(),o(2,"div",11),p(3,"app-command-detail2",12),s(4,$o,5,5),o(5,"p"),r(6,"\xA0"),a()()),t&2){let e=c();m(3),d("command",i),m(),u(e.showResend()?4:-1)}}function qo(t,i){t&1&&(o(0,"ya-detail-toolbar"),r(1,"Select a command"),a())}function Bo(t,i){if(t&1&&(o(0,"ya-button",19),_(1,"async"),r(2," Export "),a()),t&2){let e;c();let n=P(9),l=c();d("matMenuTriggerFor",n)("disabled",!((e=h(1,2,l.dataSource.records$))!=null&&e.length))}}function Yo(t,i){if(t&1&&p(0,"ya-option",25),t&2){let e=i.$implicit;d("id",e)("label",e)}}function jo(t,i){if(t&1){let e=I();p(0,"ya-date-time-input",70)(1,"ya-date-time-input",71),o(2,"ya-button",69),S("click",function(){y(e);let l=c(2);return x(l.applyCustomDates())}),r(3," Apply "),a()}if(t&2){let e=c(2);m(2),d("disabled",e.filterForm.invalid)}}function Uo(t,i){if(t&1){let e=I();o(0,"ya-button",72),S("click",function(){y(e);let l=c(2);return x(l.jumpToNow())}),r(1,"Jump to now"),a()}}function Go(t,i){t&1&&p(0,"ya-dots")}function zo(t,i){t&1&&(o(0,"div",32),r(1," Listening for commands "),p(2,"ya-dots",73),a())}function Wo(t,i){if(t&1&&(o(0,"span"),r(1," Showing entries from "),o(2,"b"),r(3,"the last hour"),a(),r(4," ending at "),o(5,"b"),r(6),_(7,"datetime"),a(),r(8," (Mission Time) "),a()),t&2){let e=c(2);m(6),E(h(7,1,e.validStop))}}function Ko(t,i){if(t&1&&(o(0,"span"),r(1," Showing entries from "),o(2,"b"),r(3,"the last 6 hours"),a(),r(4," ending at "),o(5,"b"),r(6),_(7,"datetime"),a(),r(8," (Mission Time) "),a()),t&2){let e=c(2);m(6),E(h(7,1,e.validStop))}}function Jo(t,i){if(t&1&&(o(0,"span"),r(1," Showing entries from "),o(2,"b"),r(3,"the last 24 hours"),a(),r(4," ending at "),o(5,"b"),r(6),_(7,"datetime"),a(),r(8," (Mission Time) "),a()),t&2){let e=c(2);m(6),E(h(7,1,e.validStop))}}function Xo(t,i){t&1&&(o(0,"span"),r(1," Showing entries from "),o(2,"b"),r(3,"all time"),a()())}function Zo(t,i){if(t&1&&(o(0,"span"),r(1," Showing entries from "),o(2,"b"),r(3),_(4,"datetime"),a(),r(5," to "),o(6,"b"),r(7),_(8,"datetime"),a(),r(9," (Mission Time) "),a()),t&2){let e=c(2);m(3),E(h(4,2,e.validStart)),m(4),E(h(8,4,e.validStop))}}function ea(t,i){t&1&&(o(0,"th",74),r(1,"ID"),a())}function ta(t,i){if(t&1&&(o(0,"td",75)(1,"a",13),r(2),a()()),t&2){let e=i.$implicit,n=c(2);m(),d("routerLink",q(3,Oo,e.id))("queryParams",q(5,No,n.yamcs.context)),m(),b(" ",e.id," ")}}function ia(t,i){t&1&&(o(0,"th",74),r(1,"Time"),a())}function na(t,i){if(t&1&&(o(0,"td",75),r(1),_(2,"datetime"),a()),t&2){let e=i.$implicit;m(),b(" ",h(2,1,e.generationTime)," ")}}function oa(t,i){t&1&&(o(0,"th",76)(1,"mat-icon",77),r(2,"comment"),a()())}function aa(t,i){if(t&1&&(o(0,"mat-icon",79),r(1,"comment"),a()),t&2){let e=c().$implicit;d("matTooltip",e.comment)}}function ra(t,i){t&1&&r(0," - ")}function ma(t,i){if(t&1&&(o(0,"td",78),s(1,aa,2,1,"mat-icon",79)(2,ra,1,0),a()),t&2){let e=i.$implicit;m(),u(e.comment?1:-1),m(),u(e.comment?-1:2)}}function la(t,i){t&1&&(o(0,"th",74),r(1,"Command"),a())}function ca(t,i){if(t&1&&(o(0,"td",75),p(1,"ya-highlight",80),a()),t&2){let e=i.$implicit,n=c(2);m(),d("text",e.commandName)("term",n.filterForm.value.filter)}}function sa(t,i){if(t&1&&(o(0,"th",74),r(1),a()),t&2){let e=c().$implicit;m(),b(" ",e.label," ")}}function da(t,i){if(t&1&&p(0,"ya-highlight",80),t&2){let e=c(4);d("text",i)("term",e.filterForm.value.filter)}}function pa(t,i){t&1&&r(0," - ")}function ua(t,i){if(t&1&&(o(0,"td",75),s(1,da,1,2,"ya-highlight",80),_(2,"alias"),s(3,pa,1,0),a()),t&2){let e,n=i.$implicit,l=c().$implicit;m(),u((e=ct(2,1,n,l.id))?1:3,e)}}function Ca(t,i){if(t&1&&(g(0,46),s(1,sa,2,1,"th",39)(2,ua,4,4,"td",40),v()),t&2){let e=i.$implicit;d("matColumnDef",e.id)}}function _a(t,i){t&1&&(o(0,"th",74),r(1,"Issuer"),a())}function fa(t,i){if(t&1&&(o(0,"span"),r(1),a()),t&2){let e=c().$implicit;m(),b("@",e.origin,"")}}function ha(t,i){if(t&1&&(o(0,"td",75),r(1),s(2,fa,2,1,"span"),a()),t&2){let e=i.$implicit;m(),b(" ",e.username," "),m(),u(e.origin?2:-1)}}function ga(t,i){t&1&&(o(0,"th",74),r(1,"Queue"),a())}function va(t,i){if(t&1&&(o(0,"td",75),r(1),a()),t&2){let e=i.$implicit;m(),b(" ",e.queue||"-"," ")}}function Sa(t,i){t&1&&(o(0,"th",74),r(1,"Sequence number"),a())}function ya(t,i){if(t&1&&(o(0,"td",75),r(1),a()),t&2){let e=i.$implicit;m(),b(" ",e.sequenceNumber," ")}}function xa(t,i){t&1&&(o(0,"th",81),r(1," Q "),a())}function ba(t,i){if(t&1&&(o(0,"td",82)(1,"div",83),p(2,"app-acknowledgment-icon",84),a()()),t&2){let e=i.$implicit;m(2),d("ack",e.queued)}}function Ta(t,i){t&1&&(o(0,"th",85),r(1," R "),a())}function Da(t,i){if(t&1&&p(0,"app-transmission-constraints-icon",12),t&2){let e=c().$implicit;d("command",e)}}function wa(t,i){if(t&1&&p(0,"app-acknowledgment-icon",84),t&2){let e=c().$implicit;d("ack",e.released)}}function Ea(t,i){if(t&1&&(o(0,"td",82)(1,"div",83),s(2,Da,1,1,"app-transmission-constraints-icon",12)(3,wa,1,1,"app-acknowledgment-icon",84),a()()),t&2){let e=i.$implicit;m(2),u(e.released?-1:2),m(),u(e.released?3:-1)}}function Ia(t,i){t&1&&(o(0,"th",86),r(1," S "),a())}function Ma(t,i){if(t&1&&(o(0,"td",82)(1,"div",83),p(2,"app-acknowledgment-icon",84),a()()),t&2){let e=i.$implicit;m(2),d("ack",e.sent)}}function ka(t,i){t&1&&(o(0,"th",87),r(1,"Acks"),a())}function La(t,i){if(t&1&&p(0,"app-acknowledgment-icon",84),t&2){let e=i.$implicit;d("ack",e)}}function Aa(t,i){t&1&&r(0," - ")}function Pa(t,i){if(t&1&&(o(0,"td",88)(1,"div",83),H(2,La,1,1,"app-acknowledgment-icon",84,Q),a(),s(4,Aa,1,0),a()),t&2){let e=i.$implicit;m(2),O(e.extraAcks),m(2),u(e.extraAcks.length?-1:4)}}function Ra(t,i){t&1&&(o(0,"th",89),r(1,"Completion"),a())}function Ha(t,i){t&1&&r(0," SUCCESS ")}function Oa(t,i){if(t&1&&(o(0,"span",91),r(1,"FAILURE"),a()),t&2){let e=c().$implicit;d("matTooltip",e.completed==null?null:e.completed.message)}}function Na(t,i){t&1&&r(0," - ")}function Fa(t,i){if(t&1&&(o(0,"td",90),s(1,Ha,1,0)(2,Oa,2,1,"span",91)(3,Na,1,0),a()),t&2){let e=i.$implicit;m(),u((e.completed==null?null:e.completed.status)==="OK"?1:-1),m(),u((e.completed==null?null:e.completed.status)==="NOK"?2:-1),m(),u(e.completed?-1:3)}}function Va(t,i){t&1&&p(0,"th",92)}function $a(t,i){if(t&1&&(o(0,"button",94),r(1," Resend "),a(),p(2,"mat-divider")),t&2){let e=c().$implicit,n=c(2);d("routerLink","/commanding/send"+e.commandName)("queryParams",we(2,gn,n.yamcs.context,e.id))}}function Qa(t,i){if(t&1&&(p(0,"mat-divider"),o(1,"ya-download-menu-item",95),_(2,"commandDownloadLink"),r(3," Download "),a()),t&2){let e=c().$implicit;m(),d("link",h(2,1,e))}}function qa(t,i){if(t&1){let e=I();o(0,"td",75)(1,"ya-more"),s(2,$a,3,5),o(3,"button",93),S("click",function(){let l=y(e).$implicit,C=c(2);return x(C.copyHex(l))}),r(4,"Copy Hex"),a(),o(5,"button",93),S("click",function(){let l=y(e).$implicit,C=c(2);return x(C.copyBinary(l))}),r(6,"Copy Binary"),a(),s(7,Qa,4,3),a()()}if(t&2){let e=c(2);m(2),u(e.showResend()?2:-1),m(5),u(e.showCommandExports()?7:-1)}}function Ba(t,i){if(t&1&&p(0,"app-command-arguments",100),t&2){let e=c(2).$implicit;d("command",e)("nomargin",!0)}}function Ya(t,i){t&1&&r(0," - ")}function ja(t,i){if(t&1&&(o(0,"div",97)(1,"div",98),r(2,"Arguments"),a(),o(3,"div",99),s(4,Ba,1,2,"app-command-arguments",100)(5,Ya,1,0),a()()),t&2){let e=c().$implicit;m(4),u(e.userAssignments.length?4:-1),m(),u(e.userAssignments.length?-1:5)}}function Ua(t,i){if(t&1&&(o(0,"div",101),p(1,"app-hex",102),a(),o(2,"div",103)(3,"pre",104),r(4),_(5,"hexDump"),a()()),t&2){let e=c();m(),d("base64String",e.binaryValue),m(3),E(h(5,2,e.binaryValue)||"-")}}function Ga(t,i){if(t&1&&(o(0,"div",99)(1,"pre",105),r(2),a()()),t&2){let e=c();m(2),E(e.stringValue)}}function za(t,i){if(t&1&&(o(0,"div",99),r(1),_(2,"value"),a()),t&2){let e=c();m(),b(" ",h(2,1,e)," ")}}function Wa(t,i){if(t&1&&s(0,Ua,6,4)(1,Ga,3,1,"div",99)(2,za,3,3,"div",99),t&2){let e;u((e=i.type)==="BINARY"?0:e==="STRING"?1:2)}}function Ka(t,i){t&1&&r(0," - ")}function Ja(t,i){if(t&1&&(o(0,"div")(1,"div",98),r(2,"Return value"),a(),s(3,Wa,3,1)(4,Ka,1,0),a()),t&2){let e,n=c().$implicit;m(3),u((e=n.completed==null?null:n.completed.returnValue)?3:-1,e),m(),u(n.completed!=null&&n.completed.returnValue?-1:4)}}function Xa(t,i){if(t&1&&(o(0,"td",75),_(1,"async"),o(2,"div",96),s(3,ja,6,2,"div",97)(4,Ja,5,2,"div"),p(5,"div",18),a()()),t&2){let e;c();let n=P(5),l=P(34),C=P(38);vi("colspan",(e=h(1,3,n.displayedColumns$))==null?null:e.length),m(3),u(l.checked?3:-1),m(),u(C.checked?4:-1)}}function Za(t,i){t&1&&p(0,"tr",106)}function er(t,i){if(t&1){let e=I();o(0,"tr",107),_(1,"async"),S("click",function(){let l=y(e).$implicit,C=c(2);return x(C.selectRecord(l))}),a()}if(t&2){let e=i.$implicit;c();let n=P(34),l=P(38),C=c();$("expanded",n.checked||l.checked)("selected",h(1,8,C.selectedRecord$)===e)("success",(e.completed==null?null:e.completed.status)==="OK")("failed",(e.completed==null?null:e.completed.status)==="NOK")}}function tr(t,i){if(t&1){let e=I();o(0,"tr",108),S("click",function(){let l=y(e).$implicit,C=c(2);return x(C.selectRecord(l))}),a()}if(t&2){c();let e=P(34),n=P(38);$("expanded",e.checked||n.checked)}}function ir(t,i){if(t&1){let e=I();o(0,"div",8)(1,"form",14)(2,"div",15),p(3,"ya-search-filter",16)(4,"ya-column-chooser",17,0)(6,"div",18),s(7,Bo,3,4,"ya-button",19),o(8,"mat-menu",20,1)(10,"button",21),S("click",function(){y(e);let l=c();return x(l.printReport())}),r(11," Printer-friendly "),a(),o(12,"button",22),S("click",function(){y(e);let l=c();return x(l.exportCsv())}),r(13," CSV format "),a()()(),o(14,"div",15)(15,"ya-select",23),p(16,"ya-option",24),H(17,Yo,1,2,"ya-option",25,Q),a(),o(19,"ya-select",26),p(20,"ya-option",27)(21,"ya-option",28)(22,"ya-option",29)(23,"ya-option",30)(24,"ya-option",31),a(),s(25,jo,4,1)(26,Uo,2,0,"ya-button")(27,Go,1,0,"ya-dots"),_(28,"async"),s(29,zo,3,0,"div",32),_(30,"async"),a()(),o(31,"div",33)(32,"div",34)(33,"ya-table-toggle",35,2),r(35,"Arguments"),a(),r(36," \xA0\xA0 "),o(37,"ya-table-toggle",36,3),r(39,"Return value"),a()(),s(40,Wo,9,3,"span")(41,Ko,9,3,"span")(42,Jo,9,3,"span")(43,Xo,4,0,"span")(44,Zo,10,6,"span"),a(),o(45,"table",37),g(46,38),s(47,ea,2,0,"th",39)(48,ta,3,7,"td",40),v(),g(49,41),s(50,ia,2,0,"th",39)(51,na,3,3,"td",40),v(),g(52,42),s(53,oa,3,0,"th",43)(54,ma,3,2,"td",44),v(),g(55,45),s(56,la,2,0,"th",39)(57,ca,2,2,"td",40),v(),H(58,Ca,3,1,"ng-container",46,Q),_(60,"async"),g(61,47),s(62,_a,2,0,"th",39)(63,ha,3,2,"td",40),v(),g(64,48),s(65,ga,2,0,"th",39)(66,va,2,1,"td",40),v(),g(67,49),s(68,Sa,2,0,"th",39)(69,ya,2,1,"td",40),v(),g(70,50),s(71,xa,2,0,"th",51)(72,ba,3,1,"td",52),v(),g(73,53),s(74,Ta,2,0,"th",54)(75,Ea,4,2,"td",52),v(),g(76,55),s(77,Ia,2,0,"th",56)(78,Ma,3,1,"td",52),v(),g(79,57),s(80,ka,2,0,"th",58)(81,Pa,5,1,"td",59),v(),g(82,60),s(83,Ra,2,0,"th",61)(84,Fa,4,3,"td",62),v(),g(85,63),s(86,Va,1,0,"th",64)(87,qa,8,2,"td",40),v(),g(88,65),s(89,Xa,6,5,"td",40),v(),s(90,Za,1,0,"tr",66),_(91,"async"),s(92,er,2,10,"tr",67),_(93,"async"),s(94,tr,1,2,"tr",68),a(),o(95,"mat-toolbar"),p(96,"span",18),o(97,"ya-button",69),S("click",function(){y(e);let l=c();return x(l.loadMoreData())}),r(98," Load more "),a(),p(99,"span",18),a()()}if(t&2){let e,n=P(5),l=c();m(),d("formGroup",l.filterForm),m(3),d("columns",l.columns),m(3),u(l.showCommandExports()?7:-1),m(10),O(l.config.queueNames),m(8),u(l.filterForm.value.interval==="CUSTOM"?25:-1),m(),u(l.filterForm.value.interval!=="CUSTOM"?26:-1),m(),u(h(28,13,l.dataSource.loading$)?27:-1),m(2),u(h(30,15,l.dataSource.streaming$)?29:-1),m(11),u((e=l.appliedInterval)==="PT1H"?40:e==="PT6H"?41:e==="P1D"?42:e==="NO_LIMIT"?43:e==="CUSTOM"?44:-1),m(5),d("dataSource",l.dataSource),m(13),O(h(60,17,l.aliasColumns$)),m(32),d("matHeaderRowDef",h(91,19,n.displayedColumns$)),m(2),d("matRowDefColumns",h(93,21,n.displayedColumns$)),m(2),d("matRowDefColumns",gt(23,Ho)),m(3),d("disabled",!l.dataSource.hasMore())}}var dt="PT1H",Kt=class t{constructor(i,e,n,l,C,M,R,De,pt,yn,Il){this.yamcs=i;this.messageService=l;this.router=C;this.route=M;this.printService=R;this.clipboard=yn;this.dialog=Il;this.selectedRecord$=new A(null);this.filterForm=new Qe({filter:new J(null),queue:new J(null),interval:new J(dt),customStart:new J(null),customStop:new J(null)});this.columns=[{id:"commandId",label:"ID",alwaysVisible:!0},{id:"generationTime",label:"Time",alwaysVisible:!0},{id:"comment",label:"Comment",visible:!0},{id:"command",label:"Command",alwaysVisible:!0},{id:"issuer",label:"Issuer"},{id:"queue",label:"Queue"},{id:"queued",label:"Queued",visible:!0},{id:"released",label:"Released",visible:!0},{id:"sent",label:"Sent",visible:!0},{id:"acknowledgments",label:"Extra acknowledgments",visible:!0},{id:"completion",label:"Completion",visible:!0},{id:"actions",label:"",alwaysVisible:!0}];this.aliasColumns$=new A([]);this.subscriptions=[];this.config=e.getConfig(),this.user=n.getUser(),De.setTitle("Command history"),this.dataSource=new Wt(this.yamcs,pt)}ngOnInit(){this.initializeOptions(),this.loadData(),this.filterForm.get("filter").valueChanges.pipe(gi(400)).forEach(i=>{this.loadData()}),this.filterForm.get("queue").valueChanges.forEach(i=>{this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(i=>{if(i==="CUSTOM"){let e=this.validStart||this.yamcs.getMissionTime(),n=this.validStop||this.yamcs.getMissionTime();this.filterForm.get("customStart").setValue(k.toISOString(e)),this.filterForm.get("customStop").setValue(k.toISOString(n))}else i==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=i,this.loadData()):i&&(this.validStop=this.yamcs.getMissionTime(),this.validStart=k.subtractDuration(this.validStop,i),this.appliedInterval=i,this.loadData())})}ngAfterViewInit(){this.subscriptions.push(this.dataSource.namespaces$.subscribe(i=>{for(let l of this.aliasColumns$.value){let C=this.columns.indexOf(l);C!==-1&&this.columns.splice(C,1)}let e=[];for(let l of i){let C={id:l,label:l,alwaysVisible:!0};e.push(C)}let n=this.columns.findIndex(l=>l.id==="command");this.columns.splice(n+1,0,...e),this.aliasColumns$.next(e),this.columnChooser.recalculate(this.columns)}))}initializeOptions(){let i=this.route.snapshot.queryParamMap;if(i.has("filter")){let e=i.get("filter");this.filterForm.get("filter").setValue(e)}if(i.has("queue")){let e=i.get("queue");this.filterForm.get("queue").setValue(e)}if(i.has("interval"))if(this.appliedInterval=i.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let e=i.get("customStart");this.filterForm.get("customStart").setValue(e),this.validStart=new Date(e);let n=i.get("customStop");this.filterForm.get("customStop").setValue(n),this.validStop=new Date(n)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=this.yamcs.getMissionTime(),this.validStart=k.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval=dt,this.validStop=this.yamcs.getMissionTime(),this.validStart=k.subtractDuration(this.validStop,dt)}jumpToNow(){let i=this.filterForm.value.interval;i==="NO_LIMIT"?this.filterForm.get("interval").setValue(dt):i==="CUSTOM"?this.filterForm.get("interval").setValue(dt):i&&(this.validStop=this.yamcs.getMissionTime(),this.validStart=k.subtractDuration(this.validStop,i),this.loadData())}startStreaming(){this.filterForm.get("interval").setValue("NO_LIMIT"),this.dataSource.startStreaming()}stopStreaming(){this.dataSource.stopStreaming()}applyCustomDates(){this.validStart=k.toDate(this.filterForm.value.customStart),this.validStop=k.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){let{controls:i}=this.filterForm;this.updateURL();let e={};this.validStart&&(e.start=this.validStart.toISOString()),this.validStop&&(e.stop=this.validStop.toISOString());let n=i.filter.value;n&&(e.q=n);let l=i.queue.value;l&&(e.queue=l),this.dataSource.loadEntries(e).catch(C=>this.messageService.showError(C))}loadMoreData(){let{controls:i}=this.filterForm,e={};this.validStart&&(e.start=this.validStart.toISOString());let n=i.filter.value;n&&(e.q=n);let l=i.queue.value;l&&(e.queue=l),this.dataSource.loadMoreData(e).catch(C=>this.messageService.showError(C))}showResend(){return this.config.tc&&this.user.hasAnyObjectPrivilegeOfType("Command")}showCommandExports(){return this.config.commandExports}updateURL(){let{controls:i}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:i.filter.value||null,queue:i.queue.value||null,interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?i.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?i.customStop.value:null},queryParamsHandling:"merge"})}copyHex(i){let e=k.convertBase64ToHex(i.binary);this.clipboard.copy(e)}copyBinary(i){let e=window.atob(i.binary);this.clipboard.copy(e)}selectRecord(i){this.selectedRecord$.next(i)}printReport(){let i=this.dataSource.records$.value.slice().reverse();this.printService.printComponent(jt,"Command Report",i)}exportCsv(){this.dialog.open(Ut,{width:"400px",data:{start:this.validStart,stop:this.validStop,q:this.filterForm.controls.filter.value}})}ngOnDestroy(){this.subscriptions.forEach(i=>i.unsubscribe())}static{this.\u0275fac=function(e){return new(e||t)(f(L),f(Ze),f(at),f(xe),f(W),f(pe),f(Xi),f(B),f(Vt),f(Et),f(Ue))}}static{this.\u0275cmp=T({type:t,selectors:[["ng-component"]],viewQuery:function(e,n){if(e&1&&ce(Pe,5),e&2){let l;se(l=de())&&(n.columnChooser=l.first)}},standalone:!0,features:[D],decls:14,vars:10,consts:[["columnChooser",""],["exportMenu","matMenu"],["args",""],["rv",""],["icon","play_arrow"],["matTooltip","Pause streaming commands","icon","pause"],["matTooltip","Jump to now","color","primary","icon","refresh",3,"click"],[1,"table-wrapper"],[1,"panel-content"],["icon","play_arrow",3,"click"],["matTooltip","Pause streaming commands","icon","pause",3,"click"],[2,"padding","0 16px"],[3,"command"],[3,"routerLink","queryParams"],[3,"formGroup"],[1,"filter-bar"],["formControlName","filter","placeholder","Filter by text search"],["preferenceKey","cmdhist",3,"columns"],[2,"flex","1 1 auto"],["appearance","primary","dropdown","true","icon","download",1,"no-margin",3,"matMenuTriggerFor","disabled"],["overlapTrigger","false","xPosition","before",1,"ya-menu"],["mat-menu-item","","matTooltip","Print preview with one page per command","matTooltipPosition","right",3,"click"],["mat-menu-item","","matTooltip","Command table, one row per command","matTooltipPosition","right",3,"click"],["formControlName","queue"],["id","","label","Any queue"],[3,"id","label"],["icon","access_time","formControlName","interval"],["id","PT1H","label","Last hour"],["id","PT6H","label","Last 6 hours"],["id","P1D","label","Last 24 hours"],["id","NO_LIMIT","label","No limit"],["id","CUSTOM","label","Custom","group","true"],[2,"text-align","right","flex","1 1 150px"],[1,"table-status"],[1,"toggles"],["preferenceKey","cmdhist.arguments"],["preferenceKey","cmdhist.returnValue"],["mat-table","","multiTemplateDataRows","",1,"ya-data-table","expand","nohover",3,"dataSource"],["matColumnDef","commandId"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","generationTime"],["matColumnDef","comment"],["mat-header-cell","","class","iconcol",4,"matHeaderCellDef"],["mat-cell","","class","iconcol",4,"matCellDef"],["matColumnDef","command"],[3,"matColumnDef"],["matColumnDef","issuer"],["matColumnDef","queue"],["matColumnDef","sequenceNumber"],["matColumnDef","queued"],["mat-header-cell","","class","iconcol dense","style","text-align: center","matTooltip","Command queued",4,"matHeaderCellDef"],["mat-cell","","class","iconcol dense","style","text-align: center",4,"matCellDef"],["matColumnDef","released"],["mat-header-cell","","class","iconcol dense","style","text-align: center","matTooltip","Command released",4,"matHeaderCellDef"],["matColumnDef","sent"],["mat-header-cell","","class","iconcol dense","style","text-align: center","matTooltip","Command sent",4,"matHeaderCellDef"],["matColumnDef","acknowledgments"],["mat-header-cell","","class","dense",4,"matHeaderCellDef"],["mat-cell","","class","dense",4,"matCellDef"],["matColumnDef","completion"],["mat-header-cell","","style","padding-left: 8px",4,"matHeaderCellDef"],["mat-cell","","class","completion","style","text-align: center; padding-left: 8px",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["matColumnDef","detail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","item-row",3,"expanded","selected","success","failed","click",4,"matRowDef","matRowDefColumns"],["mat-row","","class","item-detail",3,"expanded","click",4,"matRowDef","matRowDefColumns"],[3,"click","disabled"],["formControlName","customStart"],["formControlName","customStop"],[3,"click"],["fontSize","16px"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"iconcol"],["matTooltip","Comment",1,"icon16"],["mat-cell","",1,"iconcol"],[1,"icon16",3,"matTooltip"],[3,"text","term"],["mat-header-cell","","matTooltip","Command queued",1,"iconcol","dense",2,"text-align","center"],["mat-cell","",1,"iconcol","dense",2,"text-align","center"],[2,"display","flex","align-items","center"],[3,"ack"],["mat-header-cell","","matTooltip","Command released",1,"iconcol","dense",2,"text-align","center"],["mat-header-cell","","matTooltip","Command sent",1,"iconcol","dense",2,"text-align","center"],["mat-header-cell","",1,"dense"],["mat-cell","",1,"dense"],["mat-header-cell","",2,"padding-left","8px"],["mat-cell","",1,"completion",2,"text-align","center","padding-left","8px"],[3,"matTooltip"],["mat-header-cell","",1,"expand"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"routerLink","queryParams"],[3,"link"],[2,"display","flex"],[2,"min-width","300px"],[1,"block-title",2,"padding-top","0"],[1,"block"],[3,"command","nomargin"],[1,"block","no-print",2,"margin-top","4px"],[3,"base64String"],[1,"block","print-only"],[2,"margin","0","line-height","1em"],[2,"margin","0","margin-top","4px","line-height","1em"],["mat-header-row",""],["mat-row","",1,"item-row",3,"click"],["mat-row","",1,"item-detail",3,"click"]],template:function(e,n){if(e&1&&(o(0,"app-instance-page")(1,"app-instance-toolbar"),r(2," Command history \xA0\xA0\xA0 "),s(3,Fo,2,0,"ya-page-button",4),_(4,"async"),s(5,Vo,2,0,"ya-page-button",5),_(6,"async"),o(7,"ya-page-icon-button",6),S("click",function(){return n.jumpToNow()}),a()(),o(8,"ya-detail-pane"),s(9,Qo,7,2),_(10,"async"),s(11,qo,2,0,"ya-detail-toolbar"),a(),o(12,"div",7),s(13,ir,100,24,"div",8),a()()),e&2){let l;m(3),u(h(4,4,n.dataSource.streaming$)?-1:3),m(2),u(h(6,6,n.dataSource.streaming$)?5:-1),m(4),u((l=h(10,8,n.selectedRecord$))?9:11,l),m(4),u(n.dataSource?13:-1)}},dependencies:[an,lt,Te,Gt,$t,j,Y,w,U,Ce,G,ue,_e,fe,K,Ie,ke,qe,Me,Be,X,ee,oe,te,Z,ae,ie,ne,re,me,Ye,Dt,z,Pe,ye,Hi,Oi,Ni,Vi,Pt,it,$i,nt,Rt,Ht,Re,Bi,Nt,he,Ft,ot,mn],styles:[".table-wrapper[_ngcontent-%COMP%]{position:relative;overflow:auto;height:100%}.table-status[_ngcontent-%COMP%]{background-color:var(--y-background-color);height:24px;line-height:24px;font-size:12px;padding-left:6px}.table-status[_ngcontent-%COMP%]   .toggles[_ngcontent-%COMP%]{float:right;height:24px;line-height:24px;font-size:12px;padding-right:6px}.mat-mdc-row[_ngcontent-%COMP%]{cursor:pointer}tr.failed[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], tr.failed[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:red}tr.success[_ngcontent-%COMP%]   td.completion[_ngcontent-%COMP%]{background-color:#e6ffed;color:#00c752}tr.failed[_ngcontent-%COMP%]   td.completion[_ngcontent-%COMP%]{background-color:#ffeef0;color:red}th.dense[_ngcontent-%COMP%], td.dense[_ngcontent-%COMP%]{width:1px;white-space:nowrap;padding-left:12px;padding-right:12px}tr.item-row.expanded[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:none}tr.item-detail[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:40px!important}tr.item-detail[_ngcontent-%COMP%]:not(.expanded){display:none}"],changeDetection:0})}};var nr=t=>({c:t});function or(t,i){if(t&1&&(o(0,"app-instance-page")(1,"app-instance-toolbar"),p(2,"ya-page-icon-button",0),r(3),a(),o(4,"div",1),p(5,"app-command-detail2",2),a()()),t&2){let e=i,n=c();m(2),d("queryParams",q(3,nr,n.yamcs.context)),m(),b(" Command history / ",e.id," "),m(2),d("command",e)}}var Jt=class t{constructor(i,e){this.yamcs=e;this.command$=new A(null);let n=i.snapshot.paramMap.get("commandId");e.yamcsClient.getCommandHistoryEntry(e.instance,n).then(l=>{this.mergeEntry(l),this.commandSubscription=e.yamcsClient.createCommandSubscription({instance:e.instance,processor:e.processor,ignorePastCommands:!1},C=>{C.id===n&&this.mergeEntry(C)})})}mergeEntry(i){let e=this.command$.value;if(e){let n=e.mergeEntry(i);this.command$.next(n)}else this.command$.next(new Ee(i))}ngOnDestroy(){this.commandSubscription?.cancel()}static{this.\u0275fac=function(e){return new(e||t)(f(pe),f(L))}}static{this.\u0275cmp=T({type:t,selectors:[["ng-component"]],standalone:!0,features:[D],decls:2,vars:3,consts:[["routerLink","..","icon","arrow_back",3,"queryParams"],[1,"panel-content"],[3,"command"]],template:function(e,n){if(e&1&&(s(0,or,6,5,"app-instance-page"),_(1,"async")),e&2){let l;u((l=h(1,1,n.command$))?0:-1,l)}},dependencies:[Te,j,Y,w,U,K,Rt],encapsulation:2,changeDetection:0})}};var Ne=class t{static{this.\u0275fac=function(e){return new(e||t)}}static{this.\u0275cmp=T({type:t,selectors:[["app-send-command-wizard-step"]],inputs:{step:"step"},standalone:!0,features:[D],decls:11,vars:6,consts:[[1,"sub"]],template:function(e,n){e&1&&(o(0,"mat-toolbar",0)(1,"mat-toolbar-row")(2,"span")(3,"span"),r(4,"1. Select command"),a(),r(5," \xA0\xA0\xA0\xA0\xA0\xA0\xA0 "),o(6,"span"),r(7,"2. Configure command"),a(),r(8," \xA0\xA0\xA0\xA0\xA0\xA0\xA0 "),o(9,"span"),r(10,"3. View report"),a()()()()),e&2&&(m(3),$("active",n.step==1),m(3),$("active",n.step==2),m(3),$("active",n.step==3))},dependencies:[w,Ye,ki],styles:["span[_ngcontent-%COMP%]{cursor:default}span[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{opacity:.3}span[_ngcontent-%COMP%]   span.active[_ngcontent-%COMP%]{opacity:1}mat-toolbar.sub[_ngcontent-%COMP%]{border-bottom:1px solid #d3d3d3;background-color:#fff;font-size:12px}.mat-toolbar-row[_ngcontent-%COMP%]{height:32px;padding:0 24px}.mat-toolbar-multiple-rows[_ngcontent-%COMP%]{min-height:32px}"],changeDetection:0})}};var ar=t=>({c:t}),rr=(t,i)=>({c:t,template:i});function mr(t,i){if(t&1&&(o(0,"div",1),p(1,"app-command-detail2",2),g(2),p(3,"br")(4,"mat-divider")(5,"br"),o(6,"ya-button",3),r(7," Send another command "),a(),r(8," \xA0\xA0 "),o(9,"ya-button",4),r(10," Resend this command "),a(),v(),a()),t&2){let e=i,n=c();m(),d("command",e),m(5),d("queryParams",q(4,ar,n.yamcs.context)),m(3),d("routerLink","/commanding/send"+e.commandName)("queryParams",we(6,rr,n.yamcs.context,e.id))}}var Xt=class t{constructor(i,e){this.yamcs=i;this.title=e;this.qualifiedName=le.required({alias:"command"});this.commandId=le.required();this.command$=new A(null)}ngOnInit(){this.title.setTitle(this.qualifiedName());let i=this.commandId();this.commandSubscription=this.yamcs.yamcsClient.createCommandSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor,ignorePastCommands:!1},e=>{e.id===i&&this.mergeEntry(e,!1)}),this.commandSubscription.addReplyListener(()=>{this.yamcs.yamcsClient.getCommandHistoryEntry(this.yamcs.instance,i).then(e=>{this.mergeEntry(e,!0)})})}mergeEntry(i,e){let n=this.command$.value;if(n){let l=n.mergeEntry(i,e);this.command$.next(l)}else this.command$.next(new Ee(i))}ngOnDestroy(){this.commandSubscription?.cancel()}static{this.\u0275fac=function(e){return new(e||t)(f(L),f(B))}}static{this.\u0275cmp=T({type:t,selectors:[["ng-component"]],inputs:{qualifiedName:[1,"command","qualifiedName"],commandId:[1,"commandId"]},standalone:!0,features:[D],decls:6,vars:3,consts:[["step","3"],[1,"panel-content"],[3,"command"],["routerLink","/commanding/send",3,"queryParams"],[3,"routerLink","queryParams"]],template:function(e,n){if(e&1&&(o(0,"app-instance-page")(1,"app-instance-toolbar"),r(2,"Send a command"),a(),p(3,"app-send-command-wizard-step",0),s(4,mr,11,9,"div",1),_(5,"async"),a()),e&2){let l;m(4),u((l=h(5,1,n.command$))?4:-1,l)}},dependencies:[Te,j,Y,Ne,w,U,K,ke,z],encapsulation:2,changeDetection:0})}};var Zt=class t{constructor(i,e){this.dialogRef=i;this.form=e.group({executionTime:["",[$e.required]],tags:[[],[]]})}schedule(){this.dialogRef.close(this.form.value)}static{this.\u0275fac=function(e){return new(e||t)(f(je),f(bt))}}static{this.\u0275cmp=T({type:t,selectors:[["app-schedule-command-dialog"]],standalone:!0,features:[D],decls:26,vars:3,consts:[["mat-dialog-title",""],[1,"hint"],[1,"ya-form",3,"formGroup"],[1,"label"],["formControlName","executionTime",3,"showMillis"],[1,"half-break"],["dialogTitle","Timeline Tags"],["formControlName","tags"],["align","end"],[2,"flex","1 1 auto"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,n){e&1&&(o(0,"h2",0),r(1,"Send later"),a(),o(2,"mat-dialog-content")(3,"div",1)(4,"p"),r(5,"This command will be submitted to the Yamcs Timeline, for execution at a later time."),a()(),o(6,"form",2)(7,"div",3),r(8," Execution time "),p(9,"br")(10,"ya-date-time-input",4),a(),p(11,"hr",5),o(12,"div",3),r(13," Timeline tags "),o(14,"span",1),r(15,"(optional)"),a(),o(16,"ya-help",6),r(17," Tags allow to categorise items per band. Bands only show items for which one of the tags is matching. "),a(),p(18,"br")(19,"ya-tag-select",7),a()()(),o(20,"mat-dialog-actions",8),p(21,"div",9),o(22,"ya-button",10),r(23,"CANCEL"),a(),o(24,"ya-button",11),S("click",function(){return n.schedule()}),r(25,"SCHEDULE"),a()()),e&2&&(m(6),d("formGroup",n.form),m(4),d("showMillis",!0),m(14),d("disabled",!n.form.valid))},dependencies:[w,Ce,G,ue,_e,fe,Ge,ze,Ke,We,z,ye,tt,Yi],encapsulation:2,changeDetection:0})}};var lr=["commandForm"];function cr(t,i){if(t&1&&(o(0,"dt"),r(1),a(),o(2,"dd"),r(3),a()),t&2){let e=i.$implicit;m(),E(e.namespace),m(2),E(e.name)}}function sr(t,i){if(t&1&&(o(0,"dt"),r(1,"Description"),a(),o(2,"dd"),p(3,"app-markdown",10),a()),t&2){let e=c(2);m(3),d("text",e.longDescription)}}function dr(t,i){if(t&1&&(o(0,"dt"),r(1,"Description"),a(),o(2,"dd"),r(3),a()),t&2){let e=c(2);m(3),b(" ",e.shortDescription||"-"," ")}}function pr(t,i){if(t&1&&s(0,sr,4,1)(1,dr,4,1),t&2){let e=c();u(e.longDescription?0:-1),m(),u(e.longDescription?-1:1)}}function ur(t,i){if(t&1&&(p(0,"app-significance-level",11),r(1)),t&2){let e=i;d("level",e.consequenceLevel),m(),b(" \xA0\xA0",e.reasonForWarning," ")}}function Cr(t,i){t&1&&r(0," - ")}function _r(t,i){if(t&1&&(o(0,"dl",5)(1,"dt"),r(2,"Command"),a(),o(3,"dd"),r(4),_(5,"shortName"),a(),o(6,"dt"),r(7,"System"),a(),o(8,"dd"),r(9),_(10,"spaceSystemName"),a(),H(11,cr,4,2,null,null,Q),s(13,pr,2,2),o(14,"dt"),r(15,"Significance"),a(),o(16,"dd"),s(17,ur,2,2)(18,Cr,1,0),a()()),t&2){let e,n=i;m(4),E(h(5,4,n.qualifiedName)),m(5),E(h(10,6,n.qualifiedName)||"-"),m(2),O(n.alias),m(2),u(n.longDescription||n.shortDescription?13:-1),m(4),u((e=n==null?null:n.effectiveSignificance)?17:18,e)}}function fr(t,i){t&1&&(o(0,"ya-warning-message"),r(1,"You're not cleared to send this command"),a())}function hr(t,i){t&1&&(o(0,"span",13),r(1,"satisfied"),a())}function gr(t,i){t&1&&(o(0,"span",14),r(1,"not satisfied"),a())}function vr(t,i){if(t&1&&(o(0,"tr")(1,"td"),r(2),a(),o(3,"td"),r(4),a(),o(5,"td"),s(6,hr,2,0,"span",13),_(7,"async"),s(8,gr,2,0,"span",14),_(9,"async"),p(10,"app-live-expression",15,1),a()()),t&2){let e=i.$implicit,n=P(11);m(2),E(e.expression),m(2),E(e.timeout||"-"),m(2),u(h(7,7,n.result$)===!0?6:-1),m(2),u(h(9,9,n.result$)===!1?8:-1),m(2),ht("display","none"),d("expression",e.expression)}}function Sr(t,i){if(t&1&&(o(0,"p"),r(1,"\xA0"),a(),o(2,"h3"),r(3,"Constraints"),a(),o(4,"table",12)(5,"tr")(6,"th"),r(7,"Constraint"),a(),o(8,"th"),r(9,"Timeout"),a(),o(10,"th"),r(11,"Live Evaluation"),a()(),H(12,vr,12,11,"tr",null,Q),a()),t&2){let e=c();m(12),O(e.constraint)}}function yr(t,i){t&1&&s(0,Sr,14,0),t&2&&u(i.constraint?0:-1)}function xr(t,i){t&1&&(o(0,"p"),r(1,"\xA0"),a(),o(2,"h3"),r(3,"Arguments"),a())}function br(t,i){if(t&1&&(o(0,"mat-slide-toggle",16),r(1,"Arm"),a(),p(2,"div",17)),t&2){let e=c();d("formControl",e.armControl)}}function Tr(t,i){if(t&1){let e=I();r(0," \xA0 "),p(1,"ya-icon-action",18),_(2,"async"),_(3,"async"),o(4,"mat-menu",19,2)(6,"button",20),S("click",function(){y(e);let l=c();return x(l.sendCommand())}),r(7,"Send now"),a(),o(8,"button",20),S("click",function(){y(e);let l=c();return x(l.openScheduleCommandDialog())}),r(9,"Send later..."),a()()}if(t&2){let e=P(5),n=c(),l=P(14);m(),d("matMenuTriggerFor",n.config.twoStageCommanding&&!n.armControl.value||!h(2,4,n.cleared$)||!l.form.valid?null:e)("padding",!1)("disabled",n.config.twoStageCommanding&&!n.armControl.value||!h(3,6,n.cleared$)||!l.form.valid),m(3),d("overlapTrigger",!1)}}var ei=class t{constructor(i,e,n,l,C,M,R,De,pt,yn){this.route=i;this.router=e;this.title=n;this.messageService=l;this.yamcs=C;this.location=M;this.authService=De;this.changeDetection=pt;this.dialog=yn;this.qualifiedName=le.required({alias:"command"});this.command$=new A(null);this.templateProvider$=new A(null);this.cleared$=new A(!0);this.armControl=new ve;this.config=R.getConfig()}ngOnInit(){this.title.setTitle(`Send a command: ${this.qualifiedName()}`);let i=[this.yamcs.yamcsClient.getCommand(this.yamcs.instance,this.qualifiedName())],e=this.route.snapshot.queryParamMap.get("template");if(e){let n=this.yamcs.yamcsClient.getCommandHistoryEntry(this.yamcs.instance,e);i.push(n)}Promise.all(i).then(n=>{let l=n[0],C;n.length>1&&(C=n[1]),this.command$.next(l),C?this.templateProvider$.next(new hi(C)):this.templateProvider$.next(null),this.config.commandClearanceEnabled&&(this.connectionInfoSubscription=this.yamcs.clearance$.subscribe(M=>{let R=l.effectiveSignificance;this.cleared$.next(this.isCleared(M,R?.consequenceLevel))}))})}ngAfterViewInit(){this.config.twoStageCommanding&&(this.commandForm.form.valueChanges.subscribe(()=>{this.armControl.setValue(!1)}),this.commandForm.form.statusChanges.subscribe(()=>{this.commandForm.form.valid?this.armControl.enable():this.armControl.disable()})),this.commandForm.hasArguments$.subscribe(i=>{this.changeDetection.detectChanges()})}goBack(){this.location.back()}sendCommand(){this.armControl.setValue(!1);let i=this.commandForm.getAssignments(),e=this.commandForm.getComment(),n=this.commandForm.getExtraOptions(),l=this.qualifiedName();this.yamcs.yamcsClient.issueCommand(this.yamcs.instance,this.yamcs.processor,l,{args:i,comment:e,extra:n}).then(C=>{this.router.navigate(["/commanding/send"+l,"-","report",C.id],{queryParams:{c:this.yamcs.context}})}).catch(C=>{this.messageService.showError(C)})}showSchedule(){let i=this.yamcs.connectionInfo$.value?.instance?.capabilities||[];return i.indexOf("timeline")!==-1&&i.indexOf("activities")!==-1&&this.authService.getUser().hasSystemPrivilege("ControlTimeline")}openScheduleCommandDialog(){this.dialog.open(Zt,{width:"600px"}).afterClosed().subscribe(i=>{if(i){this.armControl.setValue(!1);let e=this.qualifiedName(),n=this.commandForm.getAssignments(),l=this.commandForm.getExtraOptions(!0),C={type:"ACTIVITY",duration:"0s",name:e,start:i.executionTime,tags:i.tags,activityDefinition:{type:"COMMAND",args:{processor:this.yamcs.processor,command:e,args:n,extra:l}}};this.yamcs.yamcsClient.createTimelineItem(this.yamcs.instance,C).then(()=>{this.messageService.showInfo("Command scheduled"),this.router.navigateByUrl(`/commanding/send?c=${this.yamcs.context}`)}).catch(M=>this.messageService.showError(M))}})}isCleared(i,e){if(!i)return!1;switch(i.level){case"SEVERE":if(e==="SEVERE")return!0;case"CRITICAL":if(e==="CRITICAL")return!0;case"DISTRESS":if(e==="DISTRESS")return!0;case"WARNING":if(e==="WARNING")return!0;case"WATCH":if(e==="WATCH")return!0;case"NONE":if(e==="NONE"||!e)return!0}return!1}ngOnDestroy(){this.connectionInfoSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||t)(f(pe),f(W),f(B),f(xe),f(L),f(yi),f(Ze),f(at),f(vt),f(Ue))}}static{this.\u0275cmp=T({type:t,selectors:[["ng-component"]],viewQuery:function(e,n){if(e&1&&ce(lr,5),e&2){let l;se(l=de())&&(n.commandForm=l.first)}},inputs:{qualifiedName:[1,"command","qualifiedName"]},standalone:!0,features:[D],decls:28,vars:23,consts:[["commandForm",""],["expr",""],["sendMenu","matMenu"],["step","2"],[1,"form-content"],[1,"dl-horizontal","no-lead","no-trail"],[3,"command","templateProvider"],[3,"click"],[2,"flex","1 1 auto"],["appearance","primary","icon","send",3,"click","disabled"],[3,"text"],[3,"level"],["yaDataTable",""],[1,"evaluation","valid"],[1,"evaluation","invalid"],[3,"expression"],["color","primary",3,"formControl"],[2,"width","20px"],["icon","arrow_drop_down",2,"line-height","12px",3,"matMenuTriggerFor","padding","disabled"],[1,"ya-menu",3,"overlapTrigger"],["mat-menu-item","",3,"click"]],template:function(e,n){if(e&1){let l=I();o(0,"app-instance-page")(1,"app-instance-toolbar"),r(2,"Send a command"),a(),p(3,"app-send-command-wizard-step",3),o(4,"div",4),s(5,_r,19,8,"dl",5),_(6,"async"),s(7,fr,2,0,"ya-warning-message"),_(8,"async"),s(9,yr,1,1),_(10,"async"),s(11,xr,4,0),_(12,"async"),p(13,"app-command-form",6,0),_(15,"async"),_(16,"async"),o(17,"p"),r(18,"\xA0"),a(),o(19,"mat-toolbar")(20,"ya-button",7),S("click",function(){return y(l),x(n.goBack())}),r(21,"Cancel"),a(),p(22,"span",8),s(23,br,3,1),o(24,"ya-button",9),_(25,"async"),S("click",function(){return y(l),x(n.sendCommand())}),r(26," Send "),a(),s(27,Tr,10,8),a()()()}if(e&2){let l,C,M=P(14);m(5),u((l=h(6,9,n.command$))?5:-1,l),m(2),u(h(8,11,n.cleared$)?-1:7),m(2),u((C=h(10,13,n.command$))?9:-1,C),m(2),u(h(12,15,M.hasArguments$)?11:-1),m(2),d("command",h(15,17,n.command$))("templateProvider",h(16,19,n.templateProvider$)),m(10),u(n.config.twoStageCommanding?23:-1),m(),d("disabled",n.config.twoStageCommanding&&!n.armControl.value||!h(25,21,n.cleared$)||!M.form.valid),m(3),u(n.showSchedule()?27:-1)}},dependencies:[sn,j,Y,cn,on,Ne,w,U,G,xt,Gi,qe,Me,Be,Li,Ye,z,Ri,Ui,Ki,Ji,be],styles:[".evaluation[_ngcontent-%COMP%]{font-family:Roboto Mono,monospace;background-color:#ffeef0;color:red;padding-left:2px;padding-right:2px}.evaluation.valid[_ngcontent-%COMP%]{background-color:#e6ffed;color:#00c752}"],changeDetection:0})}},hi=class{constructor(i){this.entry=i}getAssignment(i){if(this.entry.assignments){for(let e of this.entry.assignments)if(e.name===i)return e.value}}getOption(i,e){for(let n of this.entry.attr||[])if(n.name===i)switch(e){case"BOOLEAN":return this.getBooleanOption(n.value);case"NUMBER":return this.getNumberOption(n.value);case"STRING":return this.getStringOption(n.value);case"TIMESTAMP":return this.getTimestampOption(n.value)}}getBooleanOption(i){if(i.type==="BOOLEAN")return i}getNumberOption(i){switch(i.type){case"SINT32":case"UINT32":case"SINT64":case"UINT64":return i}}getStringOption(i){if(i.type==="STRING")return i}getTimestampOption(i){if(i.type==="TIMESTAMP")return i}getComment(){}};var Dr=["top"],vn=t=>({c:t}),wr=(t,i)=>({c:t,system:i});function Er(t,i){if(t&1&&p(0,"ya-breadcrumb",11),t&2){let e=i.$implicit;d("link",e.route)("queryParams",e.queryParams)("label",e.name)}}function Ir(t,i){if(t&1&&(o(0,"div",4)(1,"ya-breadcrumb-trail"),p(2,"ya-breadcrumb",10),H(3,Er,1,3,"ya-breadcrumb",11,Q),a()()),t&2){let e=c(),n=c(2);m(2),d("queryParams",q(1,vn,n.yamcs.context)),m(),O(e)}}function Mr(t,i){t&1&&s(0,Ir,5,3,"div",4),t&2&&u(i.length?0:-1)}function kr(t,i){t&1&&(o(0,"th",25),r(1,"Significance"),a())}function Lr(t,i){t&1&&p(0,"app-significance-level",27),t&2&&d("level",i.consequenceLevel)}function Ar(t,i){t&1&&r(0," - ")}function Pr(t,i){if(t&1&&(o(0,"td",26),s(1,Lr,1,1,"app-significance-level",27)(2,Ar,1,0),a()),t&2){let e,n=i.$implicit;m(),u((e=n.command==null?null:n.command.effectiveSignificance)?1:2,e)}}function Rr(t,i){t&1&&(o(0,"th",25),r(1,"Name"),a())}function Hr(t,i){if(t&1&&(o(0,"mat-icon",29),r(1,"folder"),a(),o(2,"a",30),r(3),_(4,"filename"),a()),t&2){let e=c().$implicit,n=c(3);m(2),d("queryParams",we(4,wr,n.yamcs.context,e.name)),m(),b("",h(4,2,e.name),"/ ")}}function Or(t,i){if(t&1&&p(0,"ya-highlight",32),t&2){let e=c(2).$implicit,n=c(3);d("text",e.command.qualifiedName)("term",n.filterControl.value)}}function Nr(t,i){if(t&1&&(p(0,"ya-highlight",32),_(1,"slice")),t&2){let e=c(2).$implicit,n=c(3);d("text",ct(1,2,e.command.qualifiedName,n.system.length+1))("term",n.filterControl.value)}}function Fr(t,i){if(t&1&&(o(0,"mat-icon",29),r(1,"rss_feed"),a(),o(2,"a",31),s(3,Or,1,2,"ya-highlight",32)(4,Nr,2,5,"ya-highlight",32),a()),t&2){let e=c().$implicit,n=c(3);m(2),d("routerLink","/commanding/send"+e.command.qualifiedName)("queryParams",q(4,vn,n.yamcs.context)),m(),u(n.system?-1:3),m(),u(n.system?4:-1)}}function Vr(t,i){if(t&1&&(o(0,"td",28),s(1,Hr,5,7)(2,Fr,5,6),a()),t&2){let e=i.$implicit;m(),u(e.system?1:-1),m(),u(e.command?2:-1)}}function $r(t,i){t&1&&(o(0,"th",25),r(1,"Description"),a())}function Qr(t,i){if(t&1&&r(0),t&2){let e=c().$implicit;b(" ",e.system.shortDescription||"-"," ")}}function qr(t,i){if(t&1&&p(0,"ya-highlight",32),t&2){let e=c(5);d("text",i)("term",e.filterControl.value)}}function Br(t,i){t&1&&r(0," - ")}function Yr(t,i){if(t&1&&s(0,qr,1,2,"ya-highlight",32)(1,Br,1,0),t&2){let e,n=c().$implicit;u((e=n.command==null?null:n.command.shortDescription)?0:1,e)}}function jr(t,i){if(t&1&&(o(0,"td",33),s(1,Qr,1,1)(2,Yr,2,1),a()),t&2){let e=i.$implicit;m(),u(e.system?1:-1),m(),u(e.command?2:-1)}}function Ur(t,i){if(t&1&&(o(0,"th",25),r(1),a()),t&2){let e=c().$implicit;m(),b(" ",e.label," ")}}function Gr(t,i){if(t&1&&p(0,"ya-highlight",32),t&2){let e=c(5);d("text",i)("term",e.filterControl.value)}}function zr(t,i){t&1&&r(0," - ")}function Wr(t,i){if(t&1&&(o(0,"td",26),s(1,Gr,1,2,"ya-highlight",32),_(2,"alias"),s(3,zr,1,0),a()),t&2){let e,n=i.$implicit,l=c().$implicit;m(),u((e=ct(2,1,n.command,l.id))?1:3,e)}}function Kr(t,i){if(t&1&&(g(0,20),s(1,Ur,2,1,"th",13)(2,Wr,4,4,"td",14),v()),t&2){let e=i.$implicit;d("matColumnDef",e.id)}}function Jr(t,i){t&1&&p(0,"th",34)}function Xr(t,i){t&1&&p(0,"td",26)}function Zr(t,i){t&1&&p(0,"tr",35)}function em(t,i){if(t&1&&p(0,"tr",36),t&2){let e=i.$implicit,n=c(3);$("selected",n.selection.isSelected(e))}}function tm(t,i){if(t&1&&(o(0,"table",7),g(1,12),s(2,kr,2,0,"th",13)(3,Pr,3,1,"td",14),v(),g(4,15),s(5,Rr,2,0,"th",16)(6,Vr,3,2,"td",17),v(),g(7,18),s(8,$r,2,0,"th",13)(9,jr,3,2,"td",19),v(),H(10,Kr,3,1,"ng-container",20,Q),_(12,"async"),g(13,21),s(14,Jr,1,0,"th",22)(15,Xr,1,0,"td",14),v(),s(16,Zr,1,0,"tr",23),_(17,"async"),s(18,em,1,2,"tr",24),_(19,"async"),a()),t&2){c();let e=P(7),n=c();d("dataSource",n.dataSource),m(10),O(h(12,3,n.aliasColumns$)),m(6),d("matHeaderRowDef",h(17,5,e.displayedColumns$)),m(2),d("matRowDefColumns",h(19,7,e.displayedColumns$))}}function im(t,i){t&1&&r(0," replay ")}function nm(t,i){if(t&1&&(o(0,"ya-empty-message",9)(1,"p"),r(2," You are connected to the "),s(3,im,1,0),r(4," processor "),o(5,"strong"),r(6),a(),r(7,". "),a(),o(8,"p"),r(9,"This processor does not support commanding."),a()()),t&2){let e=c();m(3),u(e.processor!=null&&e.processor.replay?3:-1),m(3),E(e.processor==null?null:e.processor.name)}}function om(t,i){if(t&1){let e=I();o(0,"div",3)(1,"div"),s(2,Mr,1,1),_(3,"async"),o(4,"div",4)(5,"ya-search-filter",5),S("onArrowDown",function(){y(e);let l=c();return x(l.selectNext())})("onArrowUp",function(){y(e);let l=c();return x(l.selectPrevious())})("onEnter",function(){y(e);let l=c();return x(l.applySelection())}),a(),p(6,"ya-column-chooser",6,1),a(),s(8,tm,20,9,"table",7),p(9,"mat-paginator",8),_(10,"async"),a(),s(11,nm,10,2,"ya-empty-message",9),a()}if(t&2){let e,n=i,l=c();m(),$("noDisplay",!(n.processor!=null&&n.processor.hasCommanding)),m(),u((e=h(3,11,l.breadcrumb$))?2:-1,e),m(3),d("formControl",l.filterControl),m(),d("columns",l.columns),m(2),u(l.dataSource?8:-1),m(),d("pageSize",l.pageSize)("hidePageSize",!0)("showFirstLastButtons",!0)("length",h(10,13,l.dataSource.totalSize$)),m(2),u(n.processor!=null&&n.processor.hasCommanding?-1:11)}}var ti=class t{constructor(i,e,n,l){this.yamcs=e;this.route=n;this.router=l;this.pageSize=100;this.system=null;this.breadcrumb$=new A([]);this.filterControl=new ve;this.columns=[{id:"name",label:"Name",alwaysVisible:!0},{id:"significance",label:"Significance",visible:!0},{id:"shortDescription",label:"Description"},{id:"actions",label:"",alwaysVisible:!0}];this.aliasColumns$=new A([]);this.selection=new Tt(!1);i.setTitle("Send a command"),this.connectionInfo$=e.connectionInfo$,this.dataSource=new dn(e)}ngAfterViewInit(){this.filterControl.setValue(this.route.snapshot.queryParamMap.get("filter")),this.changeSystem(this.route.snapshot.queryParamMap),this.queryParamMapSubscription=this.route.queryParamMap.subscribe(i=>{i.get("system")!==this.system&&this.changeSystem(i)}),this.filterControl.valueChanges.subscribe(()=>{this.paginator.pageIndex=0,this.updateDataSource()}),this.paginator.page.subscribe(()=>{this.updateDataSource(),this.top.nativeElement.scrollIntoView()})}changeSystem(i){this.system=i.get("system"),this.updateBrowsePath(),i.has("page")?this.paginator.pageIndex=Number(i.get("page")):this.paginator.pageIndex=0,this.updateDataSource()}updateDataSource(){this.updateURL();let i={system:this.system||"/",noAbstract:!0,details:!0,pos:this.paginator.pageIndex*this.pageSize,limit:this.pageSize,fields:["name","qualifiedName","alias","effectiveSignificance","shortDescription"]},e=this.filterControl.value;e&&(i.q=e.toLowerCase()),this.dataSource.loadCommands(i).then(()=>{this.selection.clear(),this.updateBrowsePath();for(let l of this.aliasColumns$.value){let C=this.columns.indexOf(l);C!==-1&&this.columns.splice(C,1)}let n=[];for(let l of this.dataSource.getAliasNamespaces()){let C={id:l,label:l,alwaysVisible:!0};n.push(C)}this.columns.splice(1,0,...n),this.aliasColumns$.next(n),this.columnChooser.recalculate(this.columns)})}updateURL(){let i=this.filterControl.value;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{page:this.paginator.pageIndex||null,filter:i||null,system:this.system||null},queryParamsHandling:"merge"})}updateBrowsePath(){let i=[],e="";if(this.system)for(let n of this.system.slice(1).split("/"))e+="/"+n,i.push({name:n,route:"/commanding/send",queryParams:{system:e,c:this.yamcs.context}});this.breadcrumb$.next(i)}selectNext(){let i=this.dataSource.items$.value,e=0;if(this.selection.hasValue()){let n=this.selection.selected[0];i.indexOf(n)!==-1&&(e=Math.min(i.indexOf(n)+1,i.length-1))}this.selection.select(i[e])}selectPrevious(){let i=this.dataSource.items$.value,e=0;if(this.selection.hasValue()){let n=this.selection.selected[0];i.indexOf(n)!==-1&&(e=Math.max(i.indexOf(n)-1,0))}this.selection.select(i[e])}applySelection(){if(this.selection.hasValue()){let i=this.selection.selected[0],e=this.dataSource.items$.value;i.command&&e.indexOf(i)!==-1&&this.router.navigate(["/commanding/send"+i.command?.qualifiedName],{queryParams:{c:this.yamcs.context}})}}ngOnDestroy(){this.queryParamMapSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||t)(f(B),f(L),f(pe),f(W))}}static{this.\u0275cmp=T({type:t,selectors:[["ng-component"]],viewQuery:function(e,n){if(e&1&&(ce(Dr,7),ce(Le,5),ce(Pe,5)),e&2){let l;se(l=de())&&(n.top=l.first),se(l=de())&&(n.paginator=l.first),se(l=de())&&(n.columnChooser=l.first)}},standalone:!0,features:[D],decls:8,vars:3,consts:[["top",""],["columnChooser",""],["step","1"],[1,"panel-content"],[1,"filter-bar"],["placeholder","Search by name","icon","search",3,"onArrowDown","onArrowUp","onEnter","formControl"],["preferenceKey","sendCommand",3,"columns"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],[3,"pageSize","hidePageSize","showFirstLastButtons","length"],["headerTitle","Send a command"],["link","/commanding/send","icon","account_tree",3,"queryParams"],[3,"link","queryParams","label"],["matColumnDef","significance"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["cdkColumnDef","name"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","","class","primary-td",4,"matCellDef"],["matColumnDef","shortDescription"],["mat-cell","","class","wrap400",4,"matCellDef"],[3,"matColumnDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"level"],["mat-cell","",1,"primary-td"],[1,"icon12",2,"vertical-align","middle"],["routerLink","/commanding/send",3,"queryParams"],[3,"routerLink","queryParams"],[3,"text","term"],["mat-cell","",1,"wrap400"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(e,n){if(e&1&&(o(0,"app-instance-page")(1,"app-instance-toolbar"),r(2," Send a command "),a(),p(3,"span",null,0)(5,"app-send-command-wizard-step",2),s(6,om,12,15,"div",3),_(7,"async"),a()),e&2){let l;m(6),u((l=h(7,1,n.connectionInfo$))?6:-1,l)}},dependencies:[j,Y,Ne,w,U,Ti,G,xt,K,Je,Xe,Ie,Le,X,ee,oe,te,Z,ae,ie,ne,re,me,Pi,Ai,Pe,et,Pt,Ht,Nt,Wi,be],styles:[".pullRight[_ngcontent-%COMP%]{float:right}.primary-td[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:7px}"],changeDetection:0})}};function am(t,i){t&1&&(o(0,"th",17),r(1,"Time"),a())}function rm(t,i){if(t&1&&(o(0,"td",18),r(1),_(2,"datetime"),a()),t&2){let e=i.$implicit;m(),b(" ",h(2,1,e.generationTime)," ")}}function mm(t,i){t&1&&(o(0,"th",19)(1,"mat-icon",20),r(2,"comment"),a()())}function lm(t,i){if(t&1&&(o(0,"mat-icon",22),r(1,"comment"),a()),t&2){let e=c().$implicit;d("matTooltip",e.comment)}}function cm(t,i){t&1&&r(0," - ")}function sm(t,i){if(t&1&&(o(0,"td",21),s(1,lm,2,1,"mat-icon",22)(2,cm,1,0),a()),t&2){let e=i.$implicit;m(),u(e.comment?1:-1),m(),u(e.comment?-1:2)}}function dm(t,i){t&1&&(o(0,"th",17),r(1,"Command"),a())}function pm(t,i){if(t&1&&(o(0,"td",18),r(1),a()),t&2){let e=i.$implicit;m(),b(" ",e.commandName||"-"," ")}}function um(t,i){t&1&&(o(0,"th",17),r(1,"Queue"),a())}function Cm(t,i){if(t&1&&(o(0,"td",18),r(1),a()),t&2){let e=i.$implicit;m(),b(" ",e.queueName||"-"," ")}}function _m(t,i){t&1&&(o(0,"th",17),r(1,"Issuer"),a())}function fm(t,i){if(t&1&&(o(0,"span"),r(1),a()),t&2){let e=c().$implicit;m(),b("@",e.origin,"")}}function hm(t,i){if(t&1&&(o(0,"td",18),r(1),s(2,fm,2,1,"span"),a()),t&2){let e=i.$implicit;m(),b(" ",e.username," "),m(),u(e.origin?2:-1)}}function gm(t,i){t&1&&(o(0,"th",17),r(1,"Source"),a())}function vm(t,i){if(t&1&&(o(0,"td",18),r(1),a()),t&2){let e=i.$implicit;m(),b(" ",e.origin||"-"," ")}}function Sm(t,i){t&1&&(o(0,"th",23),r(1,"Command"),a())}function ym(t,i){if(t&1&&(o(0,"tr")(1,"td",25),r(2),a(),o(3,"td",26),r(4),_(5,"value"),a()()),t&2){let e=c().$implicit;m(2),E(e.name),m(2),E(h(5,2,e.value))}}function xm(t,i){if(t&1&&s(0,ym,6,4,"tr"),t&2){let e=i.$implicit;u(e.userInput?0:-1)}}function bm(t,i){if(t&1&&(o(0,"td",18),r(1),o(2,"table",24),H(3,xm,1,1,null,null,Q),a()()),t&2){let e=i.$implicit;m(),b(" ",e.commandName," "),m(2),O(e.assignments)}}function Tm(t,i){t&1&&(o(0,"th",27),r(1,"Actions"),a())}function Dm(t,i){t&1&&(o(0,"span",28)(1,"mat-icon",29),r(2,"cached"),a(),r(3," Checking transmission constraints "),a())}function wm(t,i){if(t&1){let e=I();o(0,"ya-text-action",30),S("click",function(){y(e);let l=c().$implicit,C=c(2);return x(C.acceptEntry(l))}),r(1,"ACCEPT"),a(),o(2,"ya-text-action",31),S("click",function(){y(e);let l=c().$implicit,C=c(2);return x(C.rejectEntry(l))}),r(3,"REJECT"),a()}if(t&2){let e=c().$implicit;d("disabled",e.pendingTransmissionConstraints),m(2),d("disabled",e.pendingTransmissionConstraints)}}function Em(t,i){if(t&1&&(o(0,"td",18),s(1,Dm,4,0,"span",28)(2,wm,4,2),a()),t&2){let e=i.$implicit;m(),u(e.pendingTransmissionConstraints?1:-1),m(),u(e.pendingTransmissionConstraints?-1:2)}}function Im(t,i){t&1&&p(0,"tr",32)}function Mm(t,i){t&1&&p(0,"tr",33)}function km(t,i){if(t&1&&(o(0,"table",0),g(1,1),s(2,am,2,0,"th",2)(3,rm,3,3,"td",3),v(),g(4,4),s(5,mm,3,0,"th",5)(6,sm,3,2,"td",6),v(),g(7,7),s(8,dm,2,0,"th",2)(9,pm,2,1,"td",3),v(),g(10,8),s(11,um,2,0,"th",2)(12,Cm,2,1,"td",3),v(),g(13,9),s(14,_m,2,0,"th",2)(15,hm,3,2,"td",3),v(),g(16,10),s(17,gm,2,0,"th",2)(18,vm,2,1,"td",3),v(),g(19,11),s(20,Sm,2,0,"th",12)(21,bm,5,1,"td",3),v(),g(22,13),s(23,Tm,2,0,"th",14)(24,Em,3,2,"td",3),v(),s(25,Im,1,0,"tr",15)(26,Mm,1,0,"tr",16),a()),t&2){let e=c();d("dataSource",e.dataSource),m(25),d("matHeaderRowDef",e.displayedColumns),m(),d("matRowDefColumns",e.displayedColumns)}}var ii=class t{constructor(i){this.yamcs=i;this.dataSource=new Se;this.displayedColumns=["generationTime","comment","source","queueName","issuer","actions"]}ngAfterViewInit(){this.dataSource.sort=this.sort,this.cqueues$.subscribe(i=>{let e=[];for(let n of i)n.entries&&e.push(...n.entries);this.dataSource.data=e})}acceptEntry(i){confirm(`Are you sure you want to accept this command?

 ${i.commandName}`)&&this.yamcs.yamcsClient.acceptCommand(i.instance,i.processorName,i.queueName,i.id)}rejectEntry(i){confirm(`Are you sure you want to reject this command?

 ${i.commandName}`)&&this.yamcs.yamcsClient.rejectCommand(i.instance,i.processorName,i.queueName,i.id)}static{this.\u0275fac=function(e){return new(e||t)(f(L))}}static{this.\u0275cmp=T({type:t,selectors:[["app-queued-commands-table"]],viewQuery:function(e,n){if(e&1&&ce(Ae,5),e&2){let l;se(l=de())&&(n.sort=l.first)}},inputs:{cqueues$:"cqueues$"},standalone:!0,features:[D],decls:1,vars:1,consts:[["mat-table","","matSort","","matSortActive","generationTime","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","generationTime"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","comment"],["mat-header-cell","","style","text-align: center",4,"matHeaderCellDef"],["mat-cell","","style","text-align: center",4,"matCellDef"],["matColumnDef","commandName"],["matColumnDef","queueName"],["matColumnDef","issuer"],["matColumnDef","origin"],["matColumnDef","source"],["mat-header-cell","","mat-sort-header","","style","width: 350px",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell","",2,"text-align","center"],["matTooltip","Comment"],["mat-cell","",2,"text-align","center"],[3,"matTooltip"],["mat-header-cell","","mat-sort-header","",2,"width","350px"],[1,"args"],["width","1",1,"key"],[1,"value"],["mat-header-cell","",1,"expand"],[2,"color","#999"],[1,"icon16","spin",2,"vertical-align","middle"],["icon","check",3,"click","disabled"],["icon","close",3,"click","disabled"],["mat-header-row",""],["mat-row",""]],template:function(e,n){e&1&&s(0,km,27,3,"table",0),e&2&&u(n.dataSource?0:-1)},dependencies:[w,Ie,Ae,Mt,X,ee,oe,te,Z,ae,ie,ne,re,me,Dt,Qi,he,ot],styles:[".args[_ngcontent-%COMP%]{margin:0 0 0 10px}.args[_ngcontent-%COMP%]   .key[_ngcontent-%COMP%]{min-width:120px;white-space:nowrap}.args[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:gray;padding-left:10px}.args[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .args[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border:none;font-size:10px;line-height:12px;font-family:Roboto Mono,monospace}"],changeDetection:0})}};function Lm(t,i){if(t&1&&p(0,"app-queued-commands-table",1),t&2){let e=c();d("cqueues$",e.cqueues$)}}function Am(t,i){t&1&&r(0,` All queues are empty.
`)}function Pm(t,i){t&1&&r(0," All queues are empty. ")}var ni=class t{constructor(i){this.cqueues$=new A([]);this.hasEntries$=new A(!1);this.cqueueByName={};i.yamcsClient.getCommandQueues(i.instance,i.processor).then(e=>{for(let n of e)this.cqueueByName[n.name]=n;this.emitChange()}),this.queueEventSubscription=i.yamcsClient.createQueueEventsSubscription({instance:i.instance,processor:i.processor},e=>{let n=this.cqueueByName[e.data.queueName];if(n){if(e.type==="COMMAND_ADDED")n.entries=n.entries||[],n.entries.push(e.data);else if(e.type==="COMMAND_UPDATED"){let l=(n.entries||[]).findIndex(C=>C.id===e.data.id);l!==-1&&(n.entries[l]=e.data)}else if(e.type==="COMMAND_REJECTED")n.entries=n.entries||[],n.entries=n.entries.filter(l=>l.id!==e.data.id);else if(e.type==="COMMAND_SENT")n.entries=n.entries||[],n.entries=n.entries.filter(l=>l.id!==e.data.id);else throw new Error(`Unexpected queue event ${e.type}`);this.emitChange()}else console.warn("Received an event for an unknown queue",e)})}emitChange(){this.cqueues$.next(Object.values(this.cqueueByName));let i=!1;for(let e of this.cqueues$.getValue())if(e.entries&&e.entries.length){i=!0;break}this.hasEntries$.next(i)}ngOnDestroy(){this.queueEventSubscription?.cancel()}static{this.\u0275fac=function(e){return new(e||t)(f(L))}}static{this.\u0275cmp=T({type:t,selectors:[["ng-component"]],standalone:!0,features:[D],decls:5,vars:3,consts:[["empty",""],[3,"cqueues$"]],template:function(e,n){e&1&&(s(0,Lm,1,1,"app-queued-commands-table",1),_(1,"async"),s(2,Am,1,0)(3,Pm,1,0,"ng-template",null,0,Si)),e&2&&u(h(1,1,n.hasEntries$)?0:2)},dependencies:[w,U,ii],encapsulation:2,changeDetection:0})}};function Rm(t,i){if(t&1){let e=I();p(0,"ya-date-time-input",13)(1,"ya-date-time-input",14),o(2,"ya-button",15),S("click",function(){y(e);let l=c();return x(l.applyCustomDates())}),r(3,"Apply"),a()}if(t&2){let e=c();m(2),d("disabled",e.filterForm.invalid)}}function Hm(t,i){if(t&1){let e=I();o(0,"ya-button",16),S("click",function(){y(e);let l=c();return x(l.jumpToNow())}),r(1,"Jump to now"),a()}}function Om(t,i){t&1&&(o(0,"th",17),r(1,"Time"),a())}function Nm(t,i){if(t&1&&(o(0,"td",18),r(1),_(2,"datetime"),a()),t&2){let e=i.$implicit;m(),E(h(2,1,e.time))}}function Fm(t,i){t&1&&(o(0,"th",17),r(1,"User"),a())}function Vm(t,i){if(t&1&&(o(0,"td",18),r(1),a()),t&2){let e=i.$implicit;m(),E(e.user||"-")}}function $m(t,i){t&1&&(o(0,"th",17),r(1,"Action"),a())}function Qm(t,i){if(t&1&&(o(0,"td",18),p(1,"span",19),_(2,"actionLogFormat"),a()),t&2){let e=i.$implicit;m(),d("innerHTML",h(2,1,e.summary)||"-",ft)}}function qm(t,i){t&1&&p(0,"th",20)}function Bm(t,i){t&1&&p(0,"td",18)}function Ym(t,i){t&1&&p(0,"tr",21)}function jm(t,i){t&1&&p(0,"tr",22)}var oi=class t{constructor(i,e,n,l,C){this.yamcs=e;this.messageService=n;this.router=l;this.route=C;this.interval=le();this.customStart=le();this.customStop=le();this.filterForm=new Qe({interval:new J("NO_LIMIT"),customStart:new J(null),customStop:new J(null)});this.displayedColumns=["time","user","summary","actions"];this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.dataSource=new Se;i.setTitle("Queues")}ngOnInit(){this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(i=>{if(i==="CUSTOM"){let e=new Date,n=this.validStart||e,l=this.validStop||e;this.filterForm.get("customStart").setValue(k.toISOString(n)),this.filterForm.get("customStop").setValue(k.toISOString(l))}else i==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=i,this.loadData()):i&&(this.validStop=new Date,this.validStart=k.subtractDuration(this.validStop,i),this.appliedInterval=i,this.loadData())})}initializeOptions(){if(this.interval())if(this.appliedInterval=this.interval(),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let i=this.customStart();this.filterForm.get("customStart").setValue(i),this.validStart=k.toDate(i);let e=this.customStop();this.filterForm.get("customStop").setValue(e),this.validStop=k.toDate(e)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=k.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){let{controls:i}=this.filterForm;this.validStart=k.toDate(i.customStart.value),this.validStop=k.toDate(i.customStop.value),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let i={service:"QueuesApi"};this.validStart&&(i.start=this.validStart.toISOString()),this.validStop&&(i.stop=this.validStop.toISOString()),this.yamcs.yamcsClient.getAuditRecords(this.yamcs.instance,i).then(e=>this.dataSource.data=e.records||[]).catch(e=>this.messageService.showError(e))}updateURL(){let{controls:i}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?i.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?i.customStop.value:null},queryParamsHandling:"merge"})}static{this.\u0275fac=function(e){return new(e||t)(f(B),f(L),f(xe),f(W),f(pe))}}static{this.\u0275cmp=T({type:t,selectors:[["app-queues-action-log-tab"]],inputs:{interval:[1,"interval"],customStart:[1,"customStart"],customStop:[1,"customStop"]},standalone:!0,features:[D],decls:20,vars:7,consts:[[3,"formGroup"],[1,"filter-bar"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","user"],["matColumnDef","summary"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"innerHTML"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(e,n){e&1&&(o(0,"form",0)(1,"div",1),p(2,"ya-select",2),s(3,Rm,4,1)(4,Hm,2,0,"ya-button"),a()(),o(5,"table",3),g(6,4),s(7,Om,2,0,"th",5)(8,Nm,3,3,"td",6),v(),g(9,7),s(10,Fm,2,0,"th",5)(11,Vm,2,1,"td",6),v(),g(12,8),s(13,$m,2,0,"th",5)(14,Qm,3,3,"td",6),v(),g(15,9),s(16,qm,1,0,"th",10)(17,Bm,1,0,"td",6),v(),s(18,Ym,1,0,"tr",11)(19,jm,1,0,"tr",12),a()),e&2&&(d("formGroup",n.filterForm),m(2),d("options",n.intervalOptions),m(),u(n.filterForm.value.interval==="CUSTOM"?3:-1),m(),u(n.filterForm.value.interval!=="CUSTOM"?4:-1),m(),d("dataSource",n.dataSource),m(13),d("matHeaderRowDef",n.displayedColumns),m(),d("matRowDefColumns",n.displayedColumns))},dependencies:[w,Ce,G,ue,_e,fe,X,ee,oe,te,Z,ae,ie,ne,re,me,z,ye,Re,Ot,he],encapsulation:2,changeDetection:0})}};var Sn=t=>({c:t}),Um=(t,i)=>({c:t,queue:i});function Gm(t,i){if(t&1){let e=I();o(0,"th",32)(1,"input",33),S("change",function(l){y(e);let C=c(3);return x(l?C.masterToggle():null)}),a()()}if(t&2){let e=c(3);m(),d("checked",e.selection.hasValue()&&e.isAllSelected())}}function zm(t,i){if(t&1){let e=I();o(0,"td",34)(1,"input",35),S("click",function(l){return y(e),x(l.stopPropagation())})("change",function(l){let C=y(e).$implicit,M=c(3);return x(l?M.selection.toggle(C):null)}),a()()}if(t&2){let e=i.$implicit,n=c(3);m(),d("checked",n.selection.isSelected(e))}}function Wm(t,i){t&1&&(o(0,"th",36),r(1,"#"),a())}function Km(t,i){if(t&1&&(o(0,"td",37),r(1),a()),t&2){let e=i.$implicit;m(),b(" ",e.order," ")}}function Jm(t,i){t&1&&(o(0,"th",36),r(1,"Queue"),a())}function Xm(t,i){if(t&1&&(o(0,"td",37),r(1),a()),t&2){let e=i.$implicit;m(),b(" ",e.name," ")}}function Zm(t,i){t&1&&(o(0,"th",36),r(1,"Issuer"),a())}function el(t,i){if(t&1&&(o(0,"ya-label",38),r(1),a()),t&2){let e=i.$implicit;m(),E(e)}}function tl(t,i){if(t&1&&(o(0,"ya-label",39),r(1),a()),t&2){let e=i.$implicit;m(),E(e)}}function il(t,i){t&1&&r(0," any ")}function nl(t,i){if(t&1&&(o(0,"td",37),H(1,el,2,1,"ya-label",38,Q),H(3,tl,2,1,"ya-label",39,Q),s(5,il,1,0),a()),t&2){let e=i.$implicit;m(),O(e.groups),m(2),O(e.users),m(2),u(!e.groups&&!e.users?5:-1)}}function ol(t,i){t&1&&(o(0,"th",36),r(1,"Min.\xA0level"),a())}function al(t,i){if(t&1&&(o(0,"td",37),p(1,"app-significance-level",40),a()),t&2){let e=i.$implicit;m(),d("level",e.minLevel)("grayscale",!0)}}function rl(t,i){t&1&&(o(0,"th",36),r(1,"Name\xA0patterns"),a())}function ml(t,i){t&1&&r(0," any ")}function ll(t,i){if(t&1&&(r(0),p(1,"br")),t&2){let e=i.$implicit;b(" ",e," ")}}function cl(t,i){if(t&1&&(o(0,"td",37),s(1,ml,1,0),H(2,ll,2,1,"br",null,Q),a()),t&2){let e=i.$implicit;m(),u(e.tcPatterns?-1:1),m(),O(e.tcPatterns)}}function sl(t,i){t&1&&(o(0,"th",36),r(1,"Action"),a())}function dl(t,i){t&1&&(o(0,"span"),r(1,"ACCEPT"),a())}function pl(t,i){if(t&1&&(o(0,"span"),_(1,"async"),r(2,"HOLD"),a()),t&2){let e=c(4);ht("visibility",h(1,2,e.visibility$)?"visible":"hidden")}}function ul(t,i){t&1&&(o(0,"span"),r(1,"REJECT"),a())}function Cl(t,i){if(t&1&&(o(0,"td",37),s(1,dl,2,0,"span")(2,pl,3,4,"span",41)(3,ul,2,0,"span"),a()),t&2){let e=i.$implicit;m(),u(e.state==="ENABLED"?1:-1),m(),u(e.state==="BLOCKED"?2:-1),m(),u(e.state==="DISABLED"?3:-1)}}function _l(t,i){t&1&&(o(0,"th",36),r(1,"Pending"),a())}function fl(t,i){if(t&1&&(o(0,"td",42),r(1),_(2,"number"),a()),t&2){let e=i.$implicit;m(),b(" ",h(2,1,(e.entries==null?null:e.entries.length)||0)," ")}}function hl(t,i){t&1&&p(0,"th",43)}function gl(t,i){if(t&1){let e=I();o(0,"td",37)(1,"ya-more")(2,"button",8),S("click",function(){let l=y(e).$implicit,C=c(3);return x(C.enableQueue(l))}),o(3,"mat-icon"),r(4,"check"),a(),r(5," Accept mode "),a(),o(6,"button",8),S("click",function(){let l=y(e).$implicit,C=c(3);return x(C.blockQueue(l))}),o(7,"mat-icon"),r(8,"pause"),a(),r(9," Hold mode "),a(),o(10,"button",8),S("click",function(){let l=y(e).$implicit,C=c(3);return x(C.disableQueue(l))}),o(11,"mat-icon"),r(12,"close"),a(),r(13," Reject mode "),a(),p(14,"mat-divider"),o(15,"a",44),r(16," View command history "),a()()()}if(t&2){let e=i.$implicit,n=c(3);m(15),d("queryParams",we(1,Um,n.yamcs.context,e.name))}}function vl(t,i){t&1&&p(0,"tr",45)}function Sl(t,i){if(t&1){let e=I();o(0,"tr",46),S("click",function(){let l=y(e).$implicit,C=c(3);return x(C.toggleOne(l))}),a()}if(t&2){let e=i.$implicit,n=c(3);$("selected",n.selection.isSelected(e))}}function yl(t,i){if(t&1&&(o(0,"table",10),g(1,15),s(2,Gm,2,1,"th",16)(3,zm,2,1,"td",17),v(),g(4,18),s(5,Wm,2,0,"th",19)(6,Km,2,1,"td",20),v(),g(7,21),s(8,Jm,2,0,"th",19)(9,Xm,2,1,"td",20),v(),g(10,22),s(11,Zm,2,0,"th",19)(12,nl,6,1,"td",20),v(),g(13,23),s(14,ol,2,0,"th",19)(15,al,2,2,"td",20),v(),g(16,24),s(17,rl,2,0,"th",19)(18,cl,4,1,"td",20),v(),g(19,25),s(20,sl,2,0,"th",19)(21,Cl,4,3,"td",20),v(),g(22,26),s(23,_l,2,0,"th",19)(24,fl,3,3,"td",27),v(),g(25,28),s(26,hl,1,0,"th",29)(27,gl,17,4,"td",20),v(),s(28,vl,1,0,"tr",30)(29,Sl,1,2,"tr",31),a()),t&2){let e=c(2);d("dataSource",e.dataSource)("trackBy",e.tableTrackerFn),m(28),d("matHeaderRowDef",e.displayedColumns),m(),d("matRowDefColumns",e.displayedColumns)}}function xl(t,i){if(t&1&&(s(0,yl,30,4,"table",10),o(1,"p"),r(2,"\xA0"),a(),o(3,"nav",11)(4,"a",12,1),r(6," Pending "),a(),o(7,"a",13,2),r(9," Action log "),a()(),o(10,"div",14)(11,"mat-tab-nav-panel",null,3),p(13,"router-outlet"),a()()),t&2){let e=P(5),n=P(8),l=P(12),C=c();u(C.dataSource?0:-1),m(3),d("mat-stretch-tabs",!1)("tabPanel",l),m(),d("active",e.isActive)("queryParams",q(7,Sn,C.yamcs.context)),m(3),d("active",n.isActive)("queryParams",q(9,Sn,C.yamcs.context))}}function bl(t,i){t&1&&r(0," replay ")}function Tl(t,i){if(t&1&&(o(0,"ya-empty-message",47)(1,"p"),r(2," You are connected to the "),s(3,bl,1,0),r(4," processor "),o(5,"strong"),r(6),a(),r(7," . "),a(),o(8,"p"),r(9,"This processor does not support commanding."),a()()),t&2){let e=i;m(3),u(e.processor!=null&&e.processor.replay?3:-1),m(3),E(e.processor==null?null:e.processor.name)}}function Dl(t,i){if(t&1&&(s(0,Tl,10,2,"ya-empty-message",47),_(1,"async")),t&2){let e,n=c();u((e=h(1,1,n.connectionInfo$))?0:-1,e)}}var ai=class t{constructor(i,e,n,l,C){this.yamcs=i;this.changeDetection=l;this.cqueues$=new A([]);this.dataSource=new Se;this.selection=new Zi((i,e)=>e.name,!0,[]);this.tableTrackerFn=(i,e)=>e.name;this.displayedColumns=["select","order","name","issuer","level","patterns","action","pending","actions"];this.visibility$=new A(!0);this.cqueueByName={};e.setTitle("Queues"),this.connectionInfo$=i.connectionInfo$,i.yamcsClient.getCommandQueues(i.instance,i.processor).then(M=>{for(let R of M)this.cqueueByName[R.name]=R;this.emitChange()}).catch(M=>n.showError(M)),this.syncSubscription=C.syncFast(()=>{this.visibility$.next(!this.visibility$.value)}),this.queueSubscription=i.yamcsClient.createQueueStatisticsSubscription({instance:i.instance,processor:i.processor},M=>{let R=this.cqueueByName[M.name];R&&(M.entries=R.entries,this.cqueueByName[M.name]=M,this.emitChange())}),this.queueEventSubscription=i.yamcsClient.createQueueEventsSubscription({instance:i.instance,processor:i.processor},M=>{let R=this.cqueueByName[M.data.queueName];if(R){if(M.type==="COMMAND_ADDED")R.entries=R.entries||[],R.entries.push(M.data);else if(M.type==="COMMAND_UPDATED"){let De=(R.entries||[]).findIndex(pt=>pt.id===M.data.id);De!==-1&&(R.entries[De]=M.data)}else if(M.type==="COMMAND_REJECTED")R.entries=R.entries||[],R.entries=R.entries.filter(De=>De.id!==M.data.id);else if(M.type==="COMMAND_SENT")R.entries=R.entries||[],R.entries=R.entries.filter(De=>De.id!==M.data.id);else throw new Error(`Unexpected queue event ${M.type}`);this.emitChange()}else console.warn("Received an event for an unknown queue",M)})}ngAfterViewInit(){this.cqueues$.subscribe(i=>{this.dataSource.data=i,this.selection.matchNewValues(i),this.changeDetection.detectChanges()})}isAllSelected(){let i=this.selection.selected.length,e=this.dataSource.filteredData.length;return i===e&&e>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.filteredData.forEach(i=>this.selection.select(i))}toggleOne(i){(!this.selection.isSelected(i)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(i)}enableSelectedQueues(){for(let i of this.selection.selected)this.enableQueue(i)}enableQueue(i){let e=i.entries?.length||0,n=`Are you sure you want to change the '${i.name}' queue's action to ACCEPT?

`;e===1?n+=`There is ${e} queued command that will be accepted immediately.`:n+=`There are ${e} queued commands that will be accepted immediately.`,!(e&&!confirm(n))&&this.yamcs.yamcsClient.enableCommandQueue(i.instance,i.processorName,i.name)}disableSelectedQueues(){for(let i of this.selection.selected)this.disableQueue(i)}disableQueue(i){let e=i.entries?.length||0,n=`Are you sure you want to change the '${i.name}' queue's action to REJECT?

`;e===1?n+=`There is ${e} queued command that will be rejected immediately.`:n+=`There are ${e} queued commands that will be rejected immediately.`,!(e&&!confirm(n))&&this.yamcs.yamcsClient.disableCommandQueue(i.instance,i.processorName,i.name)}blockSelectedQueues(){for(let i of this.selection.selected)this.blockQueue(i)}blockQueue(i){this.yamcs.yamcsClient.blockCommandQueue(i.instance,i.processorName,i.name)}emitChange(){this.cqueues$.next(Object.values(this.cqueueByName))}ngOnDestroy(){this.syncSubscription?.unsubscribe(),this.queueSubscription?.cancel(),this.queueEventSubscription?.cancel()}static{this.\u0275fac=function(e){return new(e||t)(f(L),f(B),f(xe),f(vt),f(Vt))}}static{this.\u0275cmp=T({type:t,selectors:[["ng-component"]],standalone:!0,features:[D],decls:47,vars:5,consts:[["actionMenu","matMenu"],["rla","routerLinkActive"],["rlb","routerLinkActive"],["tabPanel",""],["yaSimpleTable","",2,"width","100%"],["width","1"],["dropdown","true",3,"matMenuTriggerFor","disabled"],[1,"ya-menu"],["mat-menu-item","",3,"click"],[1,"panel-content"],["mat-table","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","/commanding/queues/pending","routerLinkActive","",3,"active","queryParams"],["mat-tab-link","","routerLink","/commanding/queues/log","routerLinkActive","",3,"active","queryParams"],[2,"margin-top","16px"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["matColumnDef","order"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","issuer"],["matColumnDef","level"],["matColumnDef","patterns"],["matColumnDef","action"],["matColumnDef","pending"],["mat-cell","","style","text-align: center",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"change","checked"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"click","change","checked"],["mat-header-cell",""],["mat-cell",""],["icon","people"],["icon","person"],[3,"level","grayscale"],[3,"visibility"],["mat-cell","",2,"text-align","center"],["mat-header-cell","",1,"expand"],["mat-menu-item","","routerLink","/commanding/history",3,"queryParams"],["mat-header-row",""],["mat-row","",3,"click"],["headerTitle","Queues"]],template:function(e,n){if(e&1){let l=I();o(0,"app-instance-page")(1,"app-instance-toolbar"),r(2," Queues "),o(3,"ya-help")(4,"p"),r(5," A queue is a temporary holding location for issued commands that are waiting to enter the next stage of processing. "),a(),o(6,"p"),r(7,"Queues are an ordered list. Issued commands are offered to the first matching queue."),a(),o(8,"p"),r(9,"A queue can perform these actions:"),a(),o(10,"table",4)(11,"tr")(12,"th",5),r(13,"ACCEPT"),a(),o(14,"td"),r(15,"The queue accepts and releases commands."),a()(),o(16,"tr")(17,"th"),r(18,"HOLD"),a(),o(19,"td"),r(20," The queue accepts commands but does not release them. These commands may be released manually, or automatically as soon as the queue action changes to ACCEPT. "),a()(),o(21,"tr")(22,"th"),r(23,"REJECT"),a(),o(24,"td"),r(25,"The queue does not accept commands. Matching commands fail immediately."),a()()()(),r(26," \xA0\xA0\xA0 "),o(27,"ya-page-button",6),r(28," Change action "),a(),o(29,"mat-menu",7,0)(31,"button",8),S("click",function(){return y(l),x(n.enableSelectedQueues())}),o(32,"mat-icon"),r(33,"check"),a(),r(34," ACCEPT "),a(),o(35,"button",8),S("click",function(){return y(l),x(n.blockSelectedQueues())}),o(36,"mat-icon"),r(37,"pause"),a(),r(38," HOLD "),a(),o(39,"button",8),S("click",function(){return y(l),x(n.disableSelectedQueues())}),o(40,"mat-icon"),r(41,"close"),a(),r(42," REJECT "),a()()(),o(43,"div",9),s(44,xl,14,11),_(45,"async"),s(46,Dl,2,3),a()()}if(e&2){let l,C=P(30);m(27),d("matMenuTriggerFor",C)("disabled",n.selection.isEmpty()),m(17),u(!((l=h(45,3,n.connectionInfo$))==null||l.processor==null)&&l.processor.hasCommanding?44:46)}},dependencies:[j,Y,w,U,bi,St,K,yt,zi,It,Je,Xe,Ie,ke,qe,Me,Be,X,ee,oe,te,Z,ae,ie,ne,re,me,kt,At,Lt,et,tt,qi,it,nt,be],encapsulation:2,changeDetection:0})}};var wl=t=>({c:t}),ri=class t{constructor(i,e){this.yamcs=e;i.setTitle("Command stacks")}static{this.\u0275fac=function(e){return new(e||t)(f(B),f(L))}}static{this.\u0275cmp=T({type:t,selectors:[["app-stacks-page"]],standalone:!0,features:[D],decls:13,vars:3,consts:[[1,"panel-content"],["headerTitle","Notice"],["routerLink","/procedures/stacks",1,"ya-link",3,"queryParams"]],template:function(e,n){e&1&&(o(0,"app-instance-page")(1,"app-instance-toolbar"),r(2,"Command stacks"),a(),o(3,"div",0)(4,"ya-empty-message",1)(5,"p"),r(6," The "),o(7,"strong"),r(8,"Command stacks"),a(),r(9," functionality was moved to "),o(10,"a",2),r(11," Procedures > Stacks "),a(),r(12," . "),a()()()()),e&2&&(m(10),d("queryParams",q(1,wl,n.yamcs.context)))},dependencies:[Y,j,w,K,et],encapsulation:2,changeDetection:0})}};var El=t=>{let i=t,e=t.findIndex(l=>l.path==="-");e!==-1&&(i=t.slice(0,e));let n="/"+i.map(l=>l.path).join("/");return{consumed:i,posParams:{command:new Di(n,{})}}},I0=[{path:"",canActivate:[si,ci],canActivateChild:[di],runGuardsAndResolvers:"always",component:nn,children:[{path:"clearances",canActivate:[_n],children:[{path:"",pathMatch:"full",component:Bt},{path:"log",component:Qt}]},{path:"send",children:[{path:"",pathMatch:"full",component:ti},{matcher:El,children:[{path:"",pathMatch:"full",component:ei},{path:"-/report/:commandId",component:Xt}]}]},{path:"history",children:[{path:"",pathMatch:"full",component:Kt},{path:":commandId",component:Jt}]},{path:"queues",component:ai,canActivate:[un],children:[{path:"",pathMatch:"full",redirectTo:"pending"},{path:"pending",component:ni},{path:"log",component:oi}]},{path:"stacks",component:ri},{path:"ext",canActivate:[si,ci],canActivateChild:[di],runGuardsAndResolvers:"always",children:[{matcher:tn,component:en}]}]}];export{I0 as ROUTES};
