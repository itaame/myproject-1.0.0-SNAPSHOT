import{b as it,d as nt,e as pi,f as ui}from"./chunk-WVE4Y3TR.js";import{$a as ce,$b as $t,$e as ii,Ab as Mt,Ae as Xt,B as yt,Ba as X,Bb as kt,Ca as s,Da as $,Db as St,E as O,Ea as h,Ed as Vt,Fa as Pe,Fb as me,Fd as jt,Gb as pe,Gd as Ut,Ge as Jt,Ha as Ie,Hb as Pt,Hd as zt,He as Zt,I as Me,Ia as M,Ib as It,Ie as ve,J as v,Ja as k,Jb as je,Je as ei,Jf as li,K as S,Ka as Le,Kb as ee,La as gt,Lb as de,Ld as Ht,O as we,Oa as u,Pa as _,Pb as fe,Pe as E,Pf as q,Q as U,Qa as vt,Sb as ue,Se as Je,Tb as Lt,Td as he,U as Tt,Ub as Nt,Ud as Ye,V as bt,Va as Ne,Vb as Rt,Vd as Yt,Ve as ti,Vf as tt,Wa as Re,Wd as Ce,Wf as ae,X as o,Xd as Ge,Y as F,Yd as Gt,Zd as ge,Ze,_ as ke,a as Fe,aa as d,ab as wt,b as Ee,ba as oe,bc as H,ca as m,cb as Z,da as Ft,dc as At,df as ni,e as D,ea as I,ga as f,gc as _e,ge as Y,gg as si,ha as L,he as We,ia as N,ic as Ue,ie as qe,ja as R,jc as ze,ka as l,ke as Ke,la as r,le as te,lg as A,ma as T,mb as $e,mc as Bt,me as Wt,na as x,ne as G,oa as y,oc as He,oe as Qe,of as Se,og as ci,qa as b,qb as Ae,qe as Xe,qf as ai,ra as g,rb as Dt,re as ie,rf as oi,rg as P,sa as c,sb as Be,se as qt,sf as ri,sg as mi,tb as Et,te as W,tg as di,ub as Ot,ue as ne,uf as et,ug as fi,wa as _t,x as Oe,xa as ht,ya as Ct,ye as Kt,zb as Ve,ze as Qt}from"./chunk-SAZ6MTOG.js";var wi=()=>({matrixParams:"exact",paths:"exact",queryParams:"ignored"}),_i=(i,t)=>({c:i,service:t}),xe=class i{constructor(t){this.yamcs=t;this.service=U()}static{this.\u0275fac=function(e){return new(e||i)(F(A))}}static{this.\u0275cmp=O({type:i,selectors:[["app-file-transfer-tabs"]],inputs:{service:[1,"service"]},standalone:!0,features:[M],decls:10,vars:14,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["tabPanel",""],["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","/file-transfer","routerLinkActive","",3,"routerLinkActiveOptions","active","queryParams"],["mat-tab-link","","routerLink","/file-transfer/log","routerLinkActive","",3,"active","queryParams"]],template:function(e,n){if(e&1&&(l(0,"nav",3)(1,"a",4,0),s(3," Transfers "),r(),l(4,"a",5,1),s(6," Action log "),r()(),l(7,"mat-tab-nav-panel",null,2),T(9,"router-outlet"),r()),e&2){let a,p,w=X(2),B=X(5),V=X(8);m("mat-stretch-tabs",!1)("tabPanel",V),o(),m("routerLinkActiveOptions",k(7,wi))("active",w.isActive)("queryParams",gt(8,_i,n.yamcs.context,(a=n.service())==null?null:a.name)),o(3),m("active",B.isActive)("queryParams",gt(11,_i,n.yamcs.context,(p=n.service())==null?null:p.name))}},dependencies:[P,Dt,Et,Ot,Kt,Xt,Qt],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}"],changeDetection:0})}};function Ei(i,t){if(i&1){let e=b();T(0,"ya-date-time-input",14)(1,"ya-date-time-input",15),l(2,"ya-button",16),g("click",function(){v(e);let a=c();return S(a.applyCustomDates())}),s(3,"Apply"),r()}if(i&2){let e=c();o(2),m("disabled",e.filterForm.invalid)}}function Oi(i,t){if(i&1){let e=b();l(0,"ya-button",17),g("click",function(){v(e);let a=c();return S(a.jumpToNow())}),s(1,"Jump to now"),r()}}function Mi(i,t){i&1&&(l(0,"th",18),s(1,"Time"),r())}function ki(i,t){if(i&1&&(l(0,"td",19),s(1),u(2,"datetime"),r()),i&2){let e=t.$implicit;o(),$(_(2,1,e.time))}}function Pi(i,t){i&1&&(l(0,"th",18),s(1,"User"),r())}function Ii(i,t){if(i&1&&(l(0,"td",19),s(1),r()),i&2){let e=t.$implicit;o(),$(e.user||"-")}}function Li(i,t){i&1&&(l(0,"th",18),s(1,"Action"),r())}function Ni(i,t){if(i&1&&(l(0,"td",19),T(1,"span",20),u(2,"actionLogFormat"),r()),i&2){let e=t.$implicit;o(),m("innerHTML",_(2,1,e.summary)||"-",Tt)}}function Ri(i,t){i&1&&T(0,"th",21)}function $i(i,t){i&1&&T(0,"td",19)}function Ai(i,t){i&1&&T(0,"tr",22)}function Bi(i,t){i&1&&T(0,"tr",23)}var at=class i{constructor(t,e,n,a,p){this.yamcs=t;this.messageService=e;this.router=n;this.route=a;this.interval=U();this.customStart=U();this.customStop=U();this.filterForm=new Pt({interval:new je("NO_LIMIT"),customStart:new je(null),customStop:new je(null)});this.displayedColumns=["time","user","summary","actions"];this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.dataSource=new ne;p.setTitle("File transfer")}ngOnInit(){this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(t=>{if(t==="CUSTOM"){let e=new Date,n=this.validStart||e,a=this.validStop||e;this.filterForm.get("customStart").setValue(E.toISOString(n)),this.filterForm.get("customStop").setValue(E.toISOString(a))}else t==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=t,this.loadData()):t&&(this.validStop=new Date,this.validStart=E.subtractDuration(this.validStop,t),this.appliedInterval=t,this.loadData())})}initializeOptions(){if(this.interval())if(this.appliedInterval=this.interval(),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let t=this.customStart();this.filterForm.get("customStart").setValue(t),this.validStart=E.toDate(t);let e=this.customStop();this.filterForm.get("customStop").setValue(e),this.validStop=E.toDate(e)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=E.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){let{controls:t}=this.filterForm;this.validStart=E.toDate(t.customStart.value),this.validStop=E.toDate(t.customStop.value),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let t={service:"FileTransferApi"};this.validStart&&(t.start=this.validStart.toISOString()),this.validStop&&(t.stop=this.validStop.toISOString()),this.yamcs.yamcsClient.getAuditRecords(this.yamcs.instance,t).then(e=>this.dataSource.data=e.records||[]).catch(e=>this.messageService.showError(e))}updateURL(){let{controls:t}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?t.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?t.customStop.value:null},queryParamsHandling:"merge"})}static{this.\u0275fac=function(e){return new(e||i)(F(A),F(Se),F(Be),F(Ae),F($e))}}static{this.\u0275cmp=O({type:i,selectors:[["app-file-transfer-action-log-tab"]],inputs:{interval:[1,"interval"],customStart:[1,"customStart"],customStop:[1,"customStop"]},standalone:!0,features:[M],decls:25,vars:7,consts:[[1,"panel-content"],[2,"margin-top","16px",3,"formGroup"],[1,"filter-bar"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","user"],["matColumnDef","summary"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"innerHTML"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(e,n){e&1&&(l(0,"app-instance-page")(1,"app-instance-toolbar"),s(2,"File transfer"),r(),l(3,"div",0),T(4,"app-file-transfer-tabs"),l(5,"form",1)(6,"div",2),T(7,"ya-select",3),d(8,Ei,4,1)(9,Oi,2,0,"ya-button"),r()(),l(10,"table",4),x(11,5),d(12,Mi,2,0,"th",6)(13,ki,3,3,"td",7),y(),x(14,8),d(15,Pi,2,0,"th",6)(16,Ii,2,1,"td",7),y(),x(17,9),d(18,Li,2,0,"th",6)(19,Ni,3,3,"td",7),y(),x(20,10),d(21,Ri,1,0,"th",11)(22,$i,1,0,"td",7),y(),d(23,Ai,1,0,"tr",12)(24,Bi,1,0,"tr",13),r()()()),e&2&&(o(5),m("formGroup",n.filterForm),o(2),m("options",n.intervalOptions),o(),f(n.filterForm.value.interval==="CUSTOM"?8:-1),o(),f(n.filterForm.value.interval!=="CUSTOM"?9:-1),o(),m("dataSource",n.dataSource),o(13),m("matHeaderRowDef",n.displayedColumns),o(),m("matRowDefColumns",n.displayedColumns))},dependencies:[xe,nt,it,P,de,me,pe,fe,ue,Y,qe,Qe,Ke,We,Xe,te,G,ie,W,ve,Je,Ze,li,q],encapsulation:2,changeDetection:0})}};var Vi=()=>["parent"];function ji(i,t){i&1&&(l(0,"th",14),s(1,"Name"),r())}function Ui(i,t){if(i&1&&(l(0,"mat-icon",16),s(1,"folder"),r(),s(2),u(3,"filename")),i&2){let e=c().$implicit;o(2),h(" ",_(3,1,e.name)," ")}}function zi(i,t){if(i&1&&(l(0,"mat-icon",16),s(1,"description"),r(),l(2,"span",17),s(3),u(4,"filename"),r()),i&2){let e=c().$implicit,n=c(2);o(2),m("ngClass",n.foldersOnly?"disabled":""),o(),$(_(4,2,e.name))}}function Hi(i,t){if(i&1&&(l(0,"td",15),d(1,Ui,4,3)(2,zi,5,4),r()),i&2){let e=t.$implicit;o(),f(e.folder?1:2)}}function Yi(i,t){i&1&&(l(0,"th",18),s(1,"Date modified"),r())}function Gi(i,t){if(i&1&&(l(0,"td",15)(1,"span",17),s(2),u(3,"datetime"),r()()),i&2){let e=t.$implicit,n=c(2);o(),m("ngClass",!e.folder&&n.foldersOnly?"disabled":""),o(),h(" ",_(3,2,e.modified)||"-"," ")}}function Wi(i,t){i&1&&(l(0,"th",19),s(1,"Size"),r())}function qi(i,t){if(i&1&&(l(0,"td",15)(1,"span",17),s(2),u(3,"formatBytes"),r()()),i&2){let e=t.$implicit,n=c(2);o(),m("ngClass",!e.folder&&n.foldersOnly?"disabled":""),o(),h(" ",_(3,2,e.size)||"-"," ")}}function Ki(i,t){if(i&1&&(l(0,"td",20)(1,"mat-icon",21),s(2," description "),r(),s(3," .. "),r()),i&2){let e=c(2);oe("colspan",e.displayedColumns.length)}}function Qi(i,t){if(i&1){let e=b();l(0,"tr",22),g("click",function(){v(e);let a=c(2);return S(a.clearSelection())}),r()}}function Xi(i,t){if(i&1){let e=b();l(0,"tr",23),u(1,"async"),g("click",function(){v(e);let a=c(2);return S(a.selectParent())}),r()}if(i&2){let e=c(2);I("hide",!_(1,2,e.currentPrefix$))}}function Ji(i,t){if(i&1){let e=b();l(0,"tr",24),g("click",function(a){let p=v(e).$implicit,w=c(2);return S(w.selectFile(a,p))}),r()}if(i&2){let e=t.$implicit,n=c(2);I("selected",n.isSelected(e))}}function Zi(i,t){if(i&1&&(l(0,"table",1),x(1,2),d(2,ji,2,0,"th",3)(3,Hi,3,1,"td",4),y(),x(4,5),d(5,Yi,2,0,"th",6)(6,Gi,4,4,"td",4),y(),x(7,7),d(8,Wi,2,0,"th",8)(9,qi,4,4,"td",4),y(),x(10,9),d(11,Ki,4,1,"td",10),y(),d(12,Qi,1,0,"tr",11)(13,Xi,2,4,"tr",12)(14,Ji,1,2,"tr",13),r()),i&2){let e=c();I("no-frame",e.noFrame)("no-select",e.noSelect),m("dataSource",e.dataSource),o(12),m("cdkHeaderRowDef",e.displayedColumns),o(),m("cdkHeaderRowDef",k(8,Vi)),o(),m("cdkRowDefColumns",e.displayedColumns)}}var rt=class i{constructor(t,e){this.changeDetection=e;this.noFrame=!1;this.noSelect=!1;this.allowFolderSelection=!1;this.prefixChange=new we;this.displayedColumns=["name","size","modified"];this.dataSource=new ne([]);this.currentPrefix$=new D(null);this.selectedFileNames=new Set;this.onChange=t=>{};this.onTouched=()=>{};this.storageClient=t.createStorageClient()}ngOnChanges(){this.bucket&&this.loadCurrentFolder()}changePrefix(t){this.loadCurrentFolder(t)}loadCurrentFolder(t){let e={delimiter:"/"};t&&(e.prefix=t),this.storageClient.listObjects(this.bucket.name,e).then(n=>{this.changedir(n);let a=t||null;a!==this.currentPrefix$.value&&(this.currentPrefix$.next(a),this.prefixChange.emit(a))})}changedir(t){this.selectedFileNames.clear(),this.updateFileNames();let e=[];for(let n of t.prefixes||[])e.push({folder:!0,name:n});for(let n of t.objects||[])n.name.endsWith("/")||e.push({folder:!1,name:n.name,modified:n.created,size:n.size,objectUrl:this.storageClient.getObjectURL(this.bucket.name,n.name)});this.dataSource.data=e,this.changeDetection.detectChanges()}selectFile(t,e){if(e.folder)this.allowFolderSelection&&t.ctrlKey&&t.shiftKey?this.flipRowSelection(e):this.loadCurrentFolder(e.name);else if(!this.foldersOnly){if(this.isMultiSelect&&t.ctrlKey)this.flipRowSelection(e);else if(this.isMultiSelect&&t.shiftKey)if(this.selectedFileNames.size==0||!this.lastSelected||this.lastSelected.name===e.name)this.flipRowSelection(e);else{let n=!1;for(let a of this.dataSource.data)(a.name===e.name||a.name===this.lastSelected.name)&&(n=!n),n&&this.selectedFileNames.add(a.name);this.selectedFileNames.add(e.name)}else this.selectedFileNames.size==1&&this.selectedFileNames.has(e.name)?this.selectedFileNames.clear():(this.selectedFileNames.clear(),this.selectedFileNames.add(e.name));this.selectedFileNames.has(e.name)&&(this.lastSelected=e)}this.updateFileNames()}flipRowSelection(t){this.selectedFileNames.has(t.name)?this.selectedFileNames.delete(t.name):this.selectedFileNames.add(t.name)}updateFileNames(){this.onChange(Array.from(this.selectedFileNames).join("|"))}isSelected(t){return this.selectedFileNames.has(t.name)}selectParent(){let t=this.currentPrefix$.value;if(t){let e=t.slice(0,-1),n=e.lastIndexOf("/");if(n){let a=e.substring(0,n+1);this.selectedFileNames.clear(),this.updateFileNames(),this.loadCurrentFolder(a)}}}writeValue(t){this.path=t}clearSelection(){this.selectedFileNames.clear(),this.updateFileNames(),this.changeDetection.detectChanges()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}ngOnDestroy(){this.selectionSubscription&&this.selectionSubscription.unsubscribe()}static{this.\u0275fac=function(e){return new(e||i)(F(A),F(Ne))}}static{this.\u0275cmp=O({type:i,selectors:[["app-object-selector"]],inputs:{bucket:"bucket",isMultiSelect:"isMultiSelect",foldersOnly:"foldersOnly",noFrame:"noFrame",path:"path",noSelect:"noSelect",allowFolderSelection:"allowFolderSelection"},outputs:{prefixChange:"prefixChange"},standalone:!0,features:[Ie([{provide:Ve,useExisting:Oe(()=>i),multi:!0}]),Me,M],decls:1,vars:1,consts:[["mat-table","",1,"ya-data-table","expand",3,"dataSource","no-frame","no-select"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","name"],["mat-header-cell","","style","width: 400px",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","modified"],["mat-header-cell","","style","width: 200px",4,"cdkHeaderCellDef"],["cdkColumnDef","size"],["mat-header-cell","","style","width: 70px",4,"cdkHeaderCellDef"],["cdkColumnDef","parent"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-header-row","",3,"click",4,"cdkHeaderRowDef"],["mat-row","","class","parent-row",3,"hide","click",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["mat-header-cell","",2,"width","400px"],["mat-cell",""],[1,"icon12",2,"vertical-align","middle"],[3,"ngClass"],["mat-header-cell","",2,"width","200px"],["mat-header-cell","",2,"width","70px"],["mat-header-cell",""],[1,"icon12",2,"vertical-align","middle","visibility","hidden"],["mat-header-row","",3,"click"],["mat-row","",1,"parent-row",3,"click"],["mat-row","",3,"click"]],template:function(e,n){e&1&&d(0,Zi,15,9,"table",0),e&2&&f(n.dataSource?0:-1)},dependencies:[P,ce,Z,ge,he,Ye,Ce,Ge,H,Y,te,G,ie,W,q,tt,ae],styles:["table[_ngcontent-%COMP%]{cursor:pointer}.folder[_ngcontent-%COMP%]:hover{text-decoration:underline}  .parent-row td{font-size:12px;line-height:16px;color:#000000a7;padding:7px 8px 8px 0;border-bottom:1px solid rgba(0,0,0,.12)}.hide[_ngcontent-%COMP%]{display:none}.disabled[_ngcontent-%COMP%]{color:#d3d3d3}.no-select[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}"],changeDetection:0})}};var en=()=>["parent"],tn=()=>["progress"];function nn(i,t){i&1&&T(0,"th",21)}function an(i,t){if(i&1&&(l(0,"mat-icon"),s(1," check "),r()),i&2){let e=c().$implicit;Ft("visibility",e.checked?"visible":"hidden")}}function on(i,t){if(i&1){let e=b();l(0,"button",25),g("click",function(){let a=v(e).$implicit,p=c().$implicit,w=c(2);return S(w.runFileAction(p.name,a))}),d(1,an,2,2,"mat-icon",26),s(2),r()}if(i&2){let e=t.$implicit;m("disabled",!e.enabled),o(),f(e.style==="CHECK_BOX"?1:-1),o(),h(" ",e.label," ")}}function rn(i,t){if(i&1&&(l(0,"td",22)(1,"ya-more",23),N(2,on,3,3,"button",24,L),r()()),i&2){let e=c(2);o(),m("padding",!1),o(),R(e.fileActions)}}function ln(i,t){i&1&&(l(0,"th",27),s(1,"Name"),r())}function sn(i,t){if(i&1&&(l(0,"mat-icon",29),s(1,"folder"),r(),s(2),u(3,"filename")),i&2){let e,n=c().$implicit;o(2),h(" ",(e=n.displayName)!==null&&e!==void 0?e:_(3,1,n.name),"/ ")}}function cn(i,t){if(i&1&&(l(0,"mat-icon",29),s(1,"description"),r(),l(2,"span",30),s(3),u(4,"filename"),r()),i&2){let e,n=c().$implicit,a=c(2);o(2),m("ngClass",a.foldersOnly?"disabled":""),o(),h(" ",(e=n.displayName)!==null&&e!==void 0?e:_(4,2,n.name)," ")}}function mn(i,t){if(i&1&&(l(0,"td",28),d(1,sn,4,3)(2,cn,5,4),r()),i&2){let e=t.$implicit;o(),f(e.folder?1:2)}}function pn(i,t){i&1&&(l(0,"th",31),s(1,"Date modified"),r())}function dn(i,t){if(i&1&&(l(0,"td",28)(1,"span",30),s(2),u(3,"datetime"),r()()),i&2){let e=t.$implicit,n=c(2);o(),m("ngClass",!e.folder&&n.foldersOnly?"disabled":""),o(),h(" ",_(3,2,e.modified)||"-"," ")}}function fn(i,t){i&1&&(l(0,"th",32),s(1,"Size"),r())}function un(i,t){if(i&1&&(l(0,"td",28)(1,"span",30),s(2),u(3,"formatBytes"),r()()),i&2){let e=t.$implicit,n=c(2);o(),m("ngClass",!e.folder&&n.foldersOnly?"disabled":""),o(),h(" ",_(3,2,e.size)||"-"," ")}}function _n(i,t){if(i&1&&(l(0,"td",33),u(1,"async"),l(2,"mat-icon",34),s(3," description "),r(),s(4," .. "),r()),i&2){let e,n=c(2);oe("colspan",(e=_(1,1,n.displayedColumns$))==null?null:e.length)}}function hn(i,t){if(i&1&&(l(0,"td",35),u(1,"async"),s(2),T(3,"ya-dots",36),r()),i&2){let e,n=c(2);oe("colspan",(e=_(1,2,n.displayedColumns$))==null?null:e.length),o(2),h(" ",n.progressMessage()," ")}}function Cn(i,t){if(i&1&&(l(0,"th",38),s(1),r()),i&2){let e=c().$implicit;o(),$(e.label)}}function gn(i,t){if(i&1&&s(0),i&2){let e,n=c().$implicit,a=c().$implicit;h(" ",(e=n.extra[a.id])!==null&&e!==void 0?e:"-"," ")}}function vn(i,t){i&1&&s(0," - ")}function Sn(i,t){if(i&1&&(l(0,"td",28),d(1,gn,1,1)(2,vn,1,0),r()),i&2){let e=t.$implicit;o(),f(e.extra?1:2)}}function xn(i,t){if(i&1&&(x(0,16),d(1,Cn,2,1,"th",37)(2,Sn,3,1,"td",7),y()),i&2){let e=t.$implicit;m("cdkColumnDef",e.id)}}function yn(i,t){if(i&1){let e=b();l(0,"tr",39),g("click",function(){v(e);let a=c(2);return S(a.clearSelection())}),r()}}function Tn(i,t){if(i&1){let e=b();l(0,"tr",40),u(1,"async"),g("click",function(){v(e);let a=c(2);return S(a.selectParent())}),r()}if(i&2){let e=c(2);I("hide",!_(1,2,e.currentPrefix$))}}function bn(i,t){if(i&1){let e=b();l(0,"tr",41),g("click",function(a){let p=v(e).$implicit,w=c(2);return S(w.selectFile(a,p))}),r()}if(i&2){let e=t.$implicit,n=c(2);I("selected",n.isSelected(e))}}function Fn(i,t){if(i&1&&T(0,"tr",42),i&2){let e=c(2);I("hide",!e.progressMessage())}}function wn(i,t){if(i&1&&(l(0,"table",1),x(1,2),d(2,nn,1,0,"th",3)(3,rn,4,1,"td",4),y(),x(4,5),d(5,ln,2,0,"th",6)(6,mn,3,1,"td",7),y(),x(7,8),d(8,pn,2,0,"th",9)(9,dn,4,4,"td",7),y(),x(10,10),d(11,fn,2,0,"th",11)(12,un,4,4,"td",7),y(),x(13,12),d(14,_n,5,3,"td",13),y(),x(15,14),d(16,hn,4,4,"td",15),y(),N(17,xn,3,1,"ng-container",16,L),u(19,"async"),d(20,yn,1,0,"tr",17),u(21,"async"),d(22,Tn,2,4,"tr",18)(23,bn,1,2,"tr",19),u(24,"async"),d(25,Fn,1,2,"tr",20),r()),i&2){let e=c();I("no-select",e.noSelect),m("dataSource",e.dataSource),o(17),R(_(19,7,e.extraColumns$)),o(3),m("cdkHeaderRowDef",_(21,9,e.displayedColumns$)),o(2),m("cdkHeaderRowDef",k(13,en)),o(),m("cdkRowDefColumns",_(24,11,e.displayedColumns$)),o(2),m("cdkFooterRowDef",k(14,tn))}}var st=class i{constructor(t){this.changeDetection=t;this.noSelect=!1;this.allowFolderSelection=!1;this.fileListExtraColumns=[];this.fileActions=[];this.prefixChange=new we;this.onAction=new we;this.displayedColumns$=new D(["name","size","modified"]);this.extraColumns$=new D([]);this.dataSource=new ne([]);this.progressMessage=ke(null);this.currentPrefix$=new D(null);this.selectedFileNames=new Set;this.onChange=t=>{};this.onTouched=()=>{}}ngOnChanges(){this.loadCurrentFolder();let t=[];this.fileActions.length&&t.push("actions"),t.push("name");for(let e of this.fileListExtraColumns)t.push(e.id);t.push("size"),t.push("modified"),this.extraColumns$.next(this.fileListExtraColumns),this.displayedColumns$.next(t)}changePrefix(t){this.loadCurrentFolder(t)}loadCurrentFolder(t){if((t||null)!==this.currentPrefix$.value){let n={files:[],destination:"",remotePath:"",listTime:""};this.setFolderContent(t,n)}}setFolderContent(t,e){this.changeDir(e);let n=t||null;n!==this.currentPrefix$.value&&(this.currentPrefix$.next(n),this.prefixChange.emit(n))}changeDir(t){this.selectedFileNames.clear(),this.updateFileNames();let e=[],n=t.remotePath?t.remotePath+"/":"";for(let a of t.files||[]){let p=n+a.name;e.push({folder:a.isDirectory,name:p,displayName:a.displayName??a.name,modified:a.modified,size:a.size,extra:a.extra||{}})}this.progressMessage.set(t.progressMessage||null),this.dataSource.data=e,this.changeDetection.detectChanges()}selectFile(t,e){if(e.folder)this.allowFolderSelection&&t.ctrlKey&&t.shiftKey?this.flipRowSelection(e):this.loadCurrentFolder(e.name);else if(!this.foldersOnly){if(this.isMultiSelect&&t.ctrlKey)this.flipRowSelection(e);else if(this.isMultiSelect&&t.shiftKey)if(this.selectedFileNames.size==0||!this.lastSelected||this.lastSelected.name===e.name)this.flipRowSelection(e);else{let n=!1;for(let a of this.dataSource.data)(a.name===e.name||a.name===this.lastSelected.name)&&(n=!n),n&&this.selectedFileNames.add(a.name);this.selectedFileNames.add(e.name)}else this.selectedFileNames.size==1&&this.selectedFileNames.has(e.name)?this.selectedFileNames.clear():(this.selectedFileNames.clear(),this.selectedFileNames.add(e.name));this.selectedFileNames.has(e.name)&&(this.lastSelected=e)}this.updateFileNames()}flipRowSelection(t){this.selectedFileNames.has(t.name)?this.selectedFileNames.delete(t.name):this.selectedFileNames.add(t.name)}updateFileNames(){this.onChange(Array.from(this.selectedFileNames).join("|"))}runFileAction(t,e){this.onAction.emit({file:t,action:e})}isSelected(t){return this.selectedFileNames.has(t.name)}selectParent(){let t=this.currentPrefix$.value;if(t){let e=t.slice(0,-1),n=e.lastIndexOf("/"),a=n!=-1?e.substring(0,n+1):void 0;this.selectedFileNames.clear(),this.updateFileNames(),this.loadCurrentFolder(a)}}clearSelection(){this.selectedFileNames.clear(),this.updateFileNames(),this.changeDetection.detectChanges()}writeValue(t){this.path=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}ngOnDestroy(){this.selectionSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||i)(F(Ne))}}static{this.\u0275cmp=O({type:i,selectors:[["app-remote-file-selector"]],inputs:{isMultiSelect:"isMultiSelect",foldersOnly:"foldersOnly",path:"path",noSelect:"noSelect",allowFolderSelection:"allowFolderSelection",fileListExtraColumns:"fileListExtraColumns",fileActions:"fileActions"},outputs:{prefixChange:"prefixChange",onAction:"onAction"},standalone:!0,features:[Ie([{provide:Ve,useExisting:Oe(()=>i),multi:!0}]),Me,M],decls:1,vars:1,consts:[["mat-table","",1,"ya-data-table","expand","no-frame",3,"dataSource","no-select"],["mat-table","",1,"ya-data-table","expand","no-frame",3,"dataSource"],["cdkColumnDef","actions"],["mat-header-cell","","class","status","width","1",4,"cdkHeaderCellDef"],["mat-cell","","class","status",4,"cdkCellDef"],["cdkColumnDef","name"],["mat-header-cell","","style","width: 400px",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","modified"],["mat-header-cell","","style","width: 200px",4,"cdkHeaderCellDef"],["cdkColumnDef","size"],["mat-header-cell","","style","width: 70px",4,"cdkHeaderCellDef"],["cdkColumnDef","parent"],["mat-header-cell","",4,"cdkHeaderCellDef"],["cdkColumnDef","progress"],["mat-footer-cell","",4,"cdkFooterCellDef"],[3,"cdkColumnDef"],["mat-header-row","",3,"click",4,"cdkHeaderRowDef"],["mat-row","","class","parent-row",3,"hide","click",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["mat-footer-row","","class","progress-row",3,"hide",4,"cdkFooterRowDef"],["mat-header-cell","","width","1",1,"status"],["mat-cell","",1,"status"],[3,"padding"],["mat-menu-item","",3,"disabled"],["mat-menu-item","",3,"click","disabled"],[3,"visibility"],["mat-header-cell","",2,"width","400px"],["mat-cell",""],[1,"icon12",2,"vertical-align","middle"],[3,"ngClass"],["mat-header-cell","",2,"width","200px"],["mat-header-cell","",2,"width","70px"],["mat-header-cell",""],[1,"icon12",2,"vertical-align","middle","visibility","hidden"],["mat-footer-cell",""],[2,"vertical-align","middle"],["mat-header-cell","","width","1",4,"cdkHeaderCellDef"],["mat-header-cell","","width","1"],["mat-header-row","",3,"click"],["mat-row","",1,"parent-row",3,"click"],["mat-row","",3,"click"],["mat-footer-row","",1,"progress-row"]],template:function(e,n){e&1&&d(0,wn,26,15,"table",0),e&2&&f(n.dataSource?0:-1)},dependencies:[P,ce,Z,ge,he,Ye,Yt,Ce,Ge,Gt,H,_e,Y,te,G,Wt,ie,W,qt,ti,ai,q,tt,ae],styles:["table[_ngcontent-%COMP%]{cursor:pointer}.folder[_ngcontent-%COMP%]:hover{text-decoration:underline}  .parent-row td{font-size:12px;line-height:16px;color:#000000a7;padding:7px 8px 8px 0;border-bottom:1px solid rgba(0,0,0,.12)}.hide[_ngcontent-%COMP%]{display:none}.disabled[_ngcontent-%COMP%]{color:#d3d3d3}.no-select[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}td.status[_ngcontent-%COMP%]{padding:0;padding-left:0!important;padding-right:0!important}.ya-data-table[_ngcontent-%COMP%]   td.status[_ngcontent-%COMP%] + td[_ngcontent-%COMP%], .ya-data-table[_ngcontent-%COMP%]   th.status[_ngcontent-%COMP%] + th[_ngcontent-%COMP%]{padding-left:2px!important}"],changeDetection:0})}};var On=["objectSelector"],Mn=["remoteSelector"],xi=()=>({visibility:"hidden"}),yi=i=>({"no-filelist":i}),kn=i=>({selected:i}),Si=()=>[];function Pn(i,t){if(i&1&&(l(0,"span"),s(1),u(2,"formatBytes"),u(3,"formatBytes"),r()),i&2){let e=c().$implicit;o(),Pe("",_(2,2,e.size),"/",_(3,4,e.maxSize),"")}}function In(i,t){if(i&1&&T(0,"ya-progress",33),i&2){let e=c().$implicit;m("value",e.size)("total",e.maxSize)}}function Ln(i,t){if(i&1&&(l(0,"td",31),u(1,"formatBytes"),l(2,"span")(3,"mat-icon",32),s(4,"shopping_basket"),r(),s(5),r(),d(6,Pn,4,6,"span")(7,In,1,2,"ya-progress",33),r()),i&2){let e=t.$implicit,n=c();m("title",_(1,4,e.maxSize-e.size)+" available"),o(5),h(" \xA0 ",e.name," "),o(),f(n.showBucketSize$.value?6:-1),o(),f(n.showBucketSize$.value?7:-1)}}function Nn(i,t){if(i&1){let e=b();l(0,"tr",34),u(1,"async"),g("click",function(){let a=v(e).$implicit,p=c();return S(p.selectBucket(a))}),r()}if(i&2){let e=t.$implicit,n=c();m("ngClass",Le(3,kn,e===_(1,1,n.selectedBucket$)))}}function Rn(i,t){if(i&1&&(l(0,"option",17),s(1),r()),i&2){let e=t.$implicit;m("value",e.name),o(),Pe("",e.name," [id=",e.id,"]")}}function $n(i,t){if(i&1){let e=b();l(0,"ya-breadcrumb",37),g("click",function(){let a=v(e).$implicit,p=c(2);return S(p.changeLocalPrefix(a.prefix))}),r()}if(i&2){let e=t.$implicit;m("label",e.name)("action",!0)}}function An(i,t){if(i&1){let e=b();l(0,"ya-breadcrumb-trail",18)(1,"ya-breadcrumb",35),g("click",function(){v(e);let a=c();return S(a.changeLocalPrefix(""))}),r(),N(2,$n,1,2,"ya-breadcrumb",36,L),r()}i&2&&(m("showMargin",!1),o(),m("action",!0),o(),R(t))}function Bn(i,t){if(i&1){let e=b();l(0,"app-object-selector",38,0),g("prefixChange",function(a){v(e);let p=c();return S(p.updateLocalBreadcrumb(a))}),r()}i&2&&m("bucket",t)("isMultiSelect",!0)("foldersOnly",!1)("noSelect",!0)("noFrame",!0)("allowFolderSelection",!0)}function Vn(i,t){if(i&1){let e=b();l(0,"ya-button",39),g("click",function(){v(e);let a=c();return S(a.startUpload())}),s(1," UPLOAD "),r()}if(i&2){let e=c();m("disabled",!e.isUploadEnabled)}}function jn(i,t){if(i&1&&(l(0,"option",17),s(1),r()),i&2){let e=t.$implicit;m("value",e.name),o(),Pe("",e.name," [id=",e.id,"]")}}function Un(i,t){if(i&1){let e=b();l(0,"ya-breadcrumb",37),g("click",function(){let a=v(e).$implicit,p=c(3);return S(p.changeRemotePrefix(a.prefix))}),r()}if(i&2){let e=t.$implicit;m("label",e.name)("action",!0)}}function zn(i,t){if(i&1){let e=b();l(0,"ya-breadcrumb-trail",18)(1,"ya-breadcrumb",35),g("click",function(){v(e);let a=c(2);return S(a.changeRemotePrefix(""))}),r(),N(2,Un,1,2,"ya-breadcrumb",36,L),r()}i&2&&(m("showMargin",!1),o(),m("action",!0),o(),R(t))}function Hn(i,t){i&1&&s(0),i&2&&h(" (",t,") ")}function Yn(i,t){if(i&1){let e=b();l(0,"a",41),s(1),u(2,"async"),u(3,"datetime"),d(4,Hn,1,1),u(5,"async"),s(6," \u25BE "),r(),l(7,"mat-menu",42,1)(9,"button",43),g("click",function(){v(e);let a=c(2);return S(a.requestFileList())}),s(10,"Refresh file list"),r()()}if(i&2){let e,n=X(8),a=c(2);m("matMenuTriggerFor",n),o(),h(" ",_(3,5,_(2,3,a.lastFileListTime$))||"No file list received"," "),o(3),f((e=_(5,7,a.lastFileListState$))?4:-1,e)}}function Gn(i,t){if(i&1&&(l(0,"div",24)(1,"label",8),s(2),l(3,"select",40),N(4,jn,2,3,"option",17,L),r()(),d(6,zn,4,2,"ya-breadcrumb-trail",18),u(7,"async"),d(8,Yn,11,9),r()),i&2){let e,n=c();m("ngClass",Le(7,yi,!n.service.capabilities.fileList)),o(2),h(" Remote ",n.service.remoteEntities&&n.service.remoteEntities.length?"Entity":""," "),o(),m("ngStyle",!(n.service.remoteEntities&&n.service.remoteEntities.length)&&k(9,xi)),o(),R(n.service.remoteEntities),o(2),f((e=_(7,5,n.remoteBreadcrumb$))?6:-1,e),o(2),f(n.service.capabilities.fileList?8:-1)}}function Wn(i,t){if(i&1){let e=b();l(0,"div",44),g("click",function(a){v(e);let p=X(2),w=c();return S(w.clearSelection(a,p))}),l(1,"app-remote-file-selector",45,2),g("prefixChange",function(a){v(e);let p=c();return S(p.updateRemoteBreadcrumb(a))})("onAction",function(a){v(e);let p=c();return S(p.onActionRequest(a))}),r()()}if(i&2){let e=c();o(),m("isMultiSelect",!0)("foldersOnly",!1)("noSelect",!0)("allowFolderSelection",!0)("fileListExtraColumns",e.service.capabilities.fileListExtraColumns||k(6,Si))("fileActions",e.service.capabilities.fileActions||k(7,Si))}}function qn(i,t){if(i&1){let e=b();l(0,"ya-button",46),g("click",function(){v(e);let a=c();return S(a.startDownload())}),s(1," DOWNLOAD "),r()}if(i&2){let e=c();m("disabled",!e.isDownloadEnabled)}}function Kn(i,t){if(i&1&&T(0,"input",28),i&2){let e,n=c();m("value",(e=n.form.get("remoteFilenames"))==null?null:e.value)}}function Qn(i,t){if(i&1&&(l(0,"label",47),T(1,"input",51),s(2),r()),i&2){let e=c(),n=e.$implicit,a=e.$index,p=c();o(),m("formControlName",p.getControlName(n,a)),o(),h(" ",n.associatedText," ")}}function Xn(i,t){if(i&1&&(l(0,"option",17),s(1,"Custom"),r()),i&2){let e=c(3);m("value",e.CUSTOM_OPTION_VALUE)}}function Jn(i,t){if(i&1&&(l(0,"option",17),s(1),r()),i&2){let e=t.$implicit;m("value",e.value),o(),h(" ",e.verboseName!=null?e.verboseName:e.value," ")}}function Zn(i,t){if(i&1&&(l(0,"select",49),d(1,Xn,2,1,"option",17),N(2,Jn,2,2,"option",17,L),r()),i&2){let e=c(),n=e.$implicit,a=e.$index,p=c();m("formControlName",p.getControlName(n,a)+p.DROPDOWN_SUFFIX),o(),f(n.allowCustomOption?1:-1),o(),R(n.values)}}function ea(i,t){if(i&1&&T(0,"input",50),i&2){let e=c(),n=e.$implicit,a=e.$index,p=c();m("formControlName",p.getControlName(n,a))("type",n.type==="DOUBLE"?"number":"text")("placeholder",n.associatedText||"")}}function ta(i,t){if(i&1&&(l(0,"div",30)(1,"label"),s(2),r(),d(3,Qn,3,2,"label",47),l(4,"div",48),d(5,Zn,4,2,"select",49)(6,ea,1,3,"input",50),r()()),i&2){let e,n=t.$implicit,a=t.$index,p=c();m("title",n.description||""),o(2),$(n.title||n.name),o(),f(n.type==="BOOLEAN"?3:-1),o(2),f((n.type==="DOUBLE"||n.type==="STRING")&&n.values?5:-1),o(),f((n.type==="DOUBLE"||n.type==="STRING")&&(n.allowCustomOption&&((e=p.form.get(p.getControlName(n,a)+p.DROPDOWN_SUFFIX))==null?null:e.value)===p.CUSTOM_OPTION_VALUE||!n.values)?6:-1)}}var ct=class i{constructor(t,e,n,a,p,w,B){this.dialogRef=t;this.yamcs=e;this.messageService=a;this.preferenceStore=p;this.snackBar=w;this.data=B;this.isDownloadEnabled=!1;this.isUploadEnabled=!1;this.dataSource=new ne;this.displayedColumns=["name"];this.prefPrefix="filetransfer.";this.selectedBucket$=new D(null);this.breadcrumb$=new D([]);this.remoteBreadcrumb$=new D([]);this.lastFileListTime$=new D("");this.lastFileListState$=new D(void 0);this.optionsMapping=new Map;this.DROPDOWN_SUFFIX="_Dropdown";this.CUSTOM_OPTION_VALUE="_CUSTOM_OPTION_";this.service=B.service,this.prefPrefix+=this.service.name+".",this.showBucketSize$=this.addPreference$("showBucketSize",!1),this.localDirectory$=this.addPreference$("localDirectory","");let V=this.service.localEntities&&this.service.localEntities.length?this.service.localEntities[0].name:"",re=this.service.remoteEntities&&this.service.remoteEntities.length?this.service.remoteEntities[0].name:"",be=this.addPreference$("localEntity",V),le=this.addPreference$("remoteEntity",re);this.storageClient=e.createStorageClient(),this.storageClient.getBuckets().then(C=>{if(this.dataSource.data=C||[],C){let Q=this.addPreference$("selectedBucket",C[0].name),z=C.find(j=>j.name===Q.value);this.selectBucket(z||C[0])}}),this.fileListSubscription=this.yamcs.yamcsClient.createRemoteFileListSubscription({instance:this.yamcs.instance,serviceName:this.service.name},C=>{if(C.destination==this.form.get("remoteEntity").value){let Q=this.remoteSelector.currentPrefix$.value||"";C.remotePath==Q&&(this.remoteSelector.setFolderContent(Q,C),this.lastFileListTime$.next(C.listTime),this.lastFileListState$.next(C.state))}});let J={};this.service.transferOptions?.forEach((C,Q)=>{let z=this.getControlName(C,Q);if(this.optionsMapping.set(C,z),C.type==="BOOLEAN"){let j=this.addPreference$("options."+C.name,C.default?.toLowerCase()==="true");J[z]=[j.value,[]]}else{let j=this.addPreference$("options."+C.name,C.default||""),se=C.values&&C.values.find(Fi=>Fi.value===j.value);J[z]=[se==null?j.value:"",[]],J[z+this.DROPDOWN_SUFFIX]=[se!=null?j.value:this.CUSTOM_OPTION_VALUE,[]]}}),this.form=n.group(Fe({localFilenames:["",[]],remoteFilenames:["",[]],localEntity:[be.value,this.service.localEntities&&this.service.localEntities.length&&St.required],remoteEntity:[le.value,this.service.remoteEntities&&this.service.remoteEntities.length&&St.required]},J)),this.form.get("localFilenames")?.valueChanges.subscribe(C=>{this.updateButtonStates(C,this.form.get("remoteFilenames")?.value,this.form.get("remoteFilenames")?.value)}),this.form.get("remoteFilenames")?.valueChanges.subscribe(C=>{this.updateButtonStates(this.form.get("localFilenames")?.value,C,this.form.get("remoteFilenames")?.value)}),this.form.get("localEntity")?.valueChanges.subscribe(C=>{this.setPreferenceValue("localEntity",C)}),this.form.get("remoteEntity")?.valueChanges.subscribe(C=>{this.setPreferenceValue("remoteEntity",C),this.getFileList(C,"")}),this.form.valueChanges.subscribe(async C=>{this.optionsMapping.forEach((Q,z)=>{let j=this.form.get(Q+this.DROPDOWN_SUFFIX)?.value,se=j==null||j===this.CUSTOM_OPTION_VALUE?this.form.get(Q)?.value:j;switch(z.type){case"BOOLEAN":this.setPreferenceValue("options."+z.name,String(se)==="true");break;case"DOUBLE":case"STRING":this.setPreferenceValue("options."+z.name,se??"")}})});let K=this.addPreference$("remoteDirectory","");this.getFileList(le.value,K.value||"")}set content(t){if(!this.objectSelector){if(!t)return;this.objectSelector=t}this.changeLocalPrefix(this.localDirectory$.value)}getControlName(t,e){return"option"+e+t.name.replace(/\s/g,"")}selectBucket(t){this.selectedBucket$.next(t),this.setPreferenceValue("selectedBucket",t.name)}updateButtonStates(t,e,n){this.isDownloadEnabled=this.service.capabilities.download&&this.selectedBucket$.value&&e!=""&&this.form.valid,this.isUploadEnabled=this.service.capabilities.upload&&t!=""&&this.form.valid}getSelectedRemoteFolderPath(){let t=this.remoteBreadcrumb$.value;return t.length!=0?t[t.length-1].prefix+"/":""}getSelectedLocalFolderPath(){let t=this.breadcrumb$.value;return t.length!=0?t[t.length-1].prefix+"/":""}async startDownload(){return this.startTransfer(this.form.get("remoteEntity")?.value,this.form.get("localEntity")?.value,this.form.get("remoteFilenames")?.value,this.form.get("localFilenames")?.value,this.getSelectedRemoteFolderPath(),this.getSelectedLocalFolderPath(),"DOWNLOAD")}async startUpload(){return this.startTransfer(this.form.get("localEntity")?.value,this.form.get("remoteEntity")?.value,this.form.get("localFilenames")?.value,this.form.get("remoteFilenames")?.value,this.getSelectedLocalFolderPath(),this.getSelectedRemoteFolderPath(),"UPLOAD")}async startTransfer(t,e,n,a,p,w,B){let V=n.trim().split("|");if(!V[0])return;let re=V.map(J=>{let K;try{K=this.getTransferPaths(J,a,p,w,B)}catch(C){throw this.messageService.showError(C),C}return B=="DOWNLOAD"&&(K=K.reverse()),this.yamcs.yamcsClient.createFileTransfer(this.yamcs.instance,this.service.name,{direction:B,bucket:this.selectedBucket$.value.name,objectName:K[0],remotePath:K[1],source:t,destination:e,options:this.getTransferOptions()})}),be,le=0;for(let J of re)try{await J}catch(K){be=K,le++}be&&(le===1?this.messageService.showError(be):le===re.length?this.messageService.showError("Failed to start any of the selected transfers. See server log."):this.messageService.showError("Some of the transfers failed to start. See server log.")),this.dialogRef.close()}getTransferPaths(t,e,n,a,p){t=t.trim(),t=t.startsWith(n)?t.replace(n,""):t;let w=n+t,B=t;if(p==="UPLOAD"&&this.service.capabilities.remotePath||p==="DOWNLOAD"){if(e=e.trim(),e.includes("|"))throw console.error(`Cannot ${p.toLowerCase()} file "${w}" to multiple destination filenames: ${e}`),new Error(`Cannot ${p.toLowerCase()} file "${w}" to multiple destination filenames: ${e}`);let V=e.startsWith(a)?e.replace(a,""):e;B=a+(V||t)}return[w,B]}requestFileList(){let t=this.remoteSelector.currentPrefix$.value||"";this.yamcs.yamcsClient.requestFileList(this.yamcs.instance,this.service.name,{source:this.form.value.localEntity,destination:this.form.value.remoteEntity,remotePath:t,options:this.getTransferOptions()})}getFileList(t,e){this.service.capabilities.fileList&&this.yamcs.yamcsClient.getFileList(this.yamcs.instance,this.service.name,{source:this.form.value.localEntity,destination:t,remotePath:e,options:this.getTransferOptions()}).then(n=>{this.remoteSelector.setFolderContent(e,n),this.setPreferenceValue("remoteDirectory",e),this.lastFileListTime$.next(n.listTime),this.lastFileListState$.next(n.state)})}getTransferOptions(){return this.service.transferOptions?.reduce((t,e)=>{let n=this.optionsMapping.get(e);if(!n)return t;let a=this.form.get(n+this.DROPDOWN_SUFFIX)?.value,p=a==null||a===this.CUSTOM_OPTION_VALUE?this.form.get(n)?.value:a;return e.type==="BOOLEAN"&&typeof p!="boolean"?p=String(p).toLowerCase()==="true":e.type==="DOUBLE"&&typeof p!="number"?p=Number(p):e.type==="STRING"&&typeof p!="string"&&(p=String(p)),Ee(Fe({},t),{[e.name]:p})},{})}updateLocalBreadcrumb(t){if(!t){this.breadcrumb$.next([]),this.setPreferenceValue("localDirectory","");return}t.endsWith("/")&&(t=t.substring(0,t.length-1));let e=[],n=t.split("/");for(let a=0;a<n.length;a++)e.push({name:n[a],prefix:n.slice(0,a+1).join("/")});this.breadcrumb$.next(e),this.setPreferenceValue("localDirectory",t)}changeLocalPrefix(t){t&&(t=t+"/"),this.objectSelector.changePrefix(t)}updateRemoteBreadcrumb(t){if(!t){this.remoteBreadcrumb$.next([]),this.getFileList(this.form.value.remoteEntity,"");return}let e=t.endsWith("/")?t.slice(0,-1):t,n=[],a=e.split("/");for(let p=0;p<a.length;p++)n.push({name:a[p],prefix:a.slice(0,p+1).join("/")});this.remoteBreadcrumb$.next(n),this.getFileList(this.form.value.remoteEntity,t)}changeRemotePrefix(t){t&&(t=t+"/"),this.remoteSelector.changePrefix(t)}clearSelection(t,e){t.currentTarget===t.target&&e.clearSelection()}onActionRequest(t){this.snackBar.open(`Running '${t.action.label}' ...`,void 0,{horizontalPosition:"end"});let e=this.form.value.remoteEntity;this.yamcs.yamcsClient.runFileAction(this.yamcs.instance,this.service.name,{remoteEntity:e,file:t.file,action:t.action.id}).then(()=>{this.snackBar.open(`'${t.action.label}' successful`,void 0,{duration:3e3,horizontalPosition:"end"})}).catch(n=>{this.messageService.showError(n),this.snackBar.open(`'${t.action.label}' failed`,void 0,{duration:3e3,horizontalPosition:"end"})})}toggleBucketSize(){this.setPreferenceValue("showBucketSize",!this.showBucketSize$.value)}addPreference$(t,e){return this.preferenceStore.addPreference$(this.prefPrefix+t,e)}setPreferenceValue(t,e){this.preferenceStore.setValue(this.prefPrefix+t,e)}ngOnDestroy(){this.fileListSubscription?.cancel()}static{this.\u0275fac=function(e){return new(e||i)(F(Vt),F(A),F($t),F(Se),F(ei),F(Ht),F(jt))}}static{this.\u0275cmp=O({type:i,selectors:[["app-transfer-file-dialog"]],viewQuery:function(e,n){if(e&1&&(_t(On,5),_t(Mn,5)),e&2){let a;ht(a=Ct())&&(n.content=a.first),ht(a=Ct())&&(n.remoteSelector=a.first)}},standalone:!0,features:[M],decls:40,vars:23,consts:[["objectSelector",""],["remoteMenu","matMenu"],["remoteSelector",""],[1,"transfer-files"],[1,"ya-form",3,"formGroup"],["mat-icon-button","","mat-dialog-close","",1,"close-button"],[1,"grid-container"],[1,"buckets-column","header"],[1,"table-caption"],[1,"column-action",3,"click"],[1,"buckets-column","table-wrapper"],["mat-table","",1,"ya-data-table","no-frame",3,"dataSource"],["cdkColumnDef","name"],["mat-cell","",3,"title",4,"cdkCellDef"],["mat-row","",3,"ngClass","click",4,"cdkRowDef","cdkRowDefColumns"],[1,"local-column","header"],["formControlName","localEntity",3,"ngStyle"],[3,"value"],[3,"showMargin"],[1,"local-column","table-wrapper",3,"click","ngClass"],["formControlName","localFilenames",3,"bucket","isMultiSelect","foldersOnly","noSelect","noFrame","allowFolderSelection"],[1,"local-column","footer"],["type","text","formControlName","localFilenames","placeholder","Local filename",3,"value"],["appearance","primary","icon","chevron_right",3,"disabled"],[1,"remote-column","header",3,"ngClass"],[1,"remote-column","table-wrapper"],[1,"remote-column","footer"],["appearance","primary","icon","chevron_left",3,"disabled"],["type","text","formControlName","remoteFilenames","placeholder","Remote filename",3,"value"],[1,"options-footer"],[3,"title"],["mat-cell","",3,"title"],[2,"vertical-align","middle"],[3,"value","total"],["mat-row","",3,"click","ngClass"],["icon","account_tree",3,"click","action"],[3,"label","action"],[3,"click","label","action"],["formControlName","localFilenames",3,"prefixChange","bucket","isMultiSelect","foldersOnly","noSelect","noFrame","allowFolderSelection"],["appearance","primary","icon","chevron_right",3,"click","disabled"],["formControlName","remoteEntity",3,"ngStyle"],["matTooltip","Last refresh. Click for actions",1,"lastFileListTime","column-action",3,"matMenuTriggerFor"],["overlapTrigger","false","xPosition","before","yPosition","below",1,"ya-menu"],["mat-menu-item","",3,"click"],[1,"remote-column","table-wrapper",3,"click"],["formControlName","remoteFilenames",3,"prefixChange","onAction","isMultiSelect","foldersOnly","noSelect","allowFolderSelection","fileListExtraColumns","fileActions"],["appearance","primary","icon","chevron_left",3,"click","disabled"],[1,"checkbox-label"],[2,"display","flex","column-gap","8px","flex-wrap","wrap"],[3,"formControlName"],[2,"width","120px",3,"formControlName","type","placeholder"],["type","checkbox",3,"formControlName"]],template:function(e,n){if(e&1&&(l(0,"div",3)(1,"form",4)(2,"h2")(3,"button",5)(4,"mat-icon"),s(5,"close"),r()(),s(6),r(),l(7,"div",6)(8,"div",7)(9,"label",8),s(10," Buckets "),l(11,"a",9),g("click",function(){return n.toggleBucketSize()}),s(12),r()()(),l(13,"div",10)(14,"table",11),x(15,12),d(16,Ln,8,6,"td",13),y(),d(17,Nn,2,5,"tr",14),r()(),l(18,"div",15)(19,"label",8),s(20),l(21,"select",16),N(22,Rn,2,3,"option",17,L),r()(),d(24,An,4,2,"ya-breadcrumb-trail",18),u(25,"async"),r(),l(26,"div",19),g("click",function(p){return n.clearSelection(p,n.objectSelector)}),d(27,Bn,2,6,"app-object-selector",20),u(28,"async"),r(),l(29,"div",21),T(30,"input",22),d(31,Vn,2,1,"ya-button",23),r(),d(32,Gn,9,10,"div",24)(33,Wn,3,8,"div",25),l(34,"div",26),d(35,qn,2,1,"ya-button",27)(36,Kn,1,1,"input",28),r(),l(37,"div",29),N(38,ta,7,5,"div",30,L),r()()()()),e&2){let a,p,w;o(),m("formGroup",n.form),o(5),h(" New ",n.service.capabilities.download&&n.service.capabilities.upload?"Transfer":n.service.capabilities.upload?"Upload":"Download"," "),o(6),h(" ",n.showBucketSize$.value?"hide":"show"," size "),o(2),m("dataSource",n.dataSource),o(3),m("cdkRowDefColumns",n.displayedColumns),o(3),h(" Local ",n.service.localEntities&&n.service.localEntities.length?"Entity":""," "),o(),m("ngStyle",!(n.service.localEntities&&n.service.localEntities.length)&&k(20,xi)),o(),R(n.service.localEntities),o(2),f((a=_(25,16,n.breadcrumb$))?24:-1,a),o(2),m("ngClass",Le(21,yi,!n.service.capabilities.fileList)),o(),f((p=_(28,18,n.selectedBucket$))?27:-1,p),o(3),m("value",(w=n.form.get("localFilenames"))==null?null:w.value),o(),f(n.service.capabilities.upload?31:-1),o(),f(n.service.remoteEntities&&n.service.remoteEntities.length||n.service.capabilities.fileList?32:-1),o(),f(n.service.capabilities.fileList?33:-1),o(2),f(n.service.capabilities.download?35:-1),o(),f(n.service.capabilities.download||n.service.capabilities.remotePath?36:-1),o(2),R(n.service.transferOptions)}},dependencies:[rt,P,ce,wt,Z,de,Nt,Rt,kt,Mt,Lt,me,pe,fe,ue,ge,he,Ce,Bt,zt,H,Ue,_e,ze,Y,G,W,He,Zt,Jt,ve,et,q,ae,st],styles:[".mat-mdc-dialog-container{border-radius:0;position:relative}.transfer-files[_ngcontent-%COMP%]{height:100%}.close-button[_ngcontent-%COMP%]{float:right}.ya-form[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.grid-container[_ngcontent-%COMP%]{display:grid;grid-auto-flow:column;grid-template-rows:[header] min-content [tables] auto [footer] min-content [options-footer] min-content;grid-template-columns:[buckets] 140px [local] auto [remote] auto;column-gap:8px;flex:1;min-height:0}.header[_ngcontent-%COMP%]{grid-row:header;position:relative;overflow:hidden;font-family:Roboto,sans-serif}.table-wrapper[_ngcontent-%COMP%]{grid-row:tables;overflow:auto;border:1px solid #d3d3d3}.footer[_ngcontent-%COMP%]{grid-row:footer;margin-top:8px;display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:stretch;gap:8px;height:fit-content;font-family:Roboto,sans-serif}.options-footer[_ngcontent-%COMP%]{grid-row:options-footer;grid-column:local / span 2;margin-top:8px;display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:stretch;gap:8px;height:fit-content;font-family:Roboto,sans-serif}.buckets-column[_ngcontent-%COMP%]{grid-column:buckets}.local-column[_ngcontent-%COMP%]{grid-column:local}.remote-column[_ngcontent-%COMP%]{grid-column:remote}.buckets-column.header[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{position:absolute;bottom:0;line-height:24px}.buckets-column.header[_ngcontent-%COMP%] > label[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{float:right}.buckets-column[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;display:flex;column-gap:10px;flex-wrap:wrap;justify-content:space-between}a.column-action[_ngcontent-%COMP%]{font-weight:400;font-size:11px;color:#707070;-webkit-user-select:none;user-select:none;cursor:pointer}a.column-action[_ngcontent-%COMP%]:hover{text-decoration:underline}.local-column.table-wrapper.no-filelist[_ngcontent-%COMP%]{grid-column:local / span 2}.local-column.footer[_ngcontent-%COMP%]{flex-wrap:wrap-reverse;align-items:flex-end}.remote-column.header.no-filelist[_ngcontent-%COMP%] > ya-breadcrumb-trail[_ngcontent-%COMP%]{visibility:hidden}label.table-caption[_ngcontent-%COMP%]{margin:0;bottom:0}label.table-caption[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{display:inline-block;width:auto;margin:0 4px}ya-breadcrumb-trail[_ngcontent-%COMP%]{display:inline-block}.lastFileListTime[_ngcontent-%COMP%]{min-width:0;line-height:24px;float:right}.footer[_ngcontent-%COMP%] > button[_ngcontent-%COMP%], .footer[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{flex-shrink:1}.footer[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{flex-grow:1}.footer[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{flex-grow:5}table.ya-data-table[_ngcontent-%COMP%]{width:100%}.ya-data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:none}.checkbox-label[_ngcontent-%COMP%]{font-weight:unset;font-size:unset;letter-spacing:unset;line-height:unset;color:unset;text-transform:unset;cursor:unset;position:unset;display:inline-block;margin:3px 0 0;-webkit-user-select:none;user-select:none}.checkbox-label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 3px 0 4px}"]})}};function ia(i,t){if(i&1&&(l(0,"mat-icon",0),s(1,"check_circle"),r()),i&2){let e=c();m("matTooltip",e.state)}}function na(i,t){if(i&1&&(l(0,"mat-icon",1),s(1,"cached"),r()),i&2){let e=c();m("matTooltip",e.state)}}function aa(i,t){if(i&1&&(l(0,"mat-icon",2),s(1,"highlight_off"),r()),i&2){let e=c();m("matTooltip",e.state)}}function oa(i,t){if(i&1&&(l(0,"mat-icon",3),s(1,"cached"),r()),i&2){let e=c();m("matTooltip",e.state)}}function ra(i,t){if(i&1&&(l(0,"mat-icon",4),s(1,"pause_circle"),r()),i&2){let e=c();m("matTooltip",e.state)}}function la(i,t){if(i&1&&(l(0,"mat-icon",5),s(1,"pending"),r()),i&2){let e=c();m("matTooltip",e.state)}}function sa(i,t){if(i&1&&d(0,ia,2,1,"mat-icon",0)(1,na,2,1,"mat-icon",1)(2,aa,2,1,"mat-icon",2)(3,oa,2,1,"mat-icon",3)(4,ra,2,1,"mat-icon",4)(5,la,2,1,"mat-icon",5),i&2){let e=t;f(e.state==="COMPLETED"?0:-1),o(),f(e.state==="RUNNING"?1:-1),o(),f(e.state==="FAILED"?2:-1),o(),f(e.state==="CANCELLING"?3:-1),o(),f(e.state==="PAUSED"?4:-1),o(),f(e.state==="QUEUED"?5:-1)}}var mt=class i{constructor(){this.transfer=U.required()}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=O({type:i,selectors:[["app-file-transfer-icon"]],inputs:{transfer:[1,"transfer"]},standalone:!0,features:[M],decls:1,vars:1,consts:[[1,"success",3,"matTooltip"],[1,"spin",3,"matTooltip"],[1,"alert",3,"matTooltip"],[1,"warning","spin",3,"matTooltip"],[1,"blink",3,"matTooltip"],[3,"matTooltip"]],template:function(e,n){if(e&1&&d(0,sa,6,6),e&2){let a;f((a=n.transfer())?0:-1,a)}},dependencies:[P,H,He],encapsulation:2,changeDetection:0})}};var pt=class{constructor(t){this.watermarkObserver=t;this.dirty=!1;this.archiveTransfers=[];this.bufferSize=500;this.bufferWatermark=400;this.pointer=0;this.alreadyWarned=!1;this.realtimeBuffer=Array(this.bufferSize).fill(void 0)}addArchiveData(t){this.archiveTransfers=this.archiveTransfers.concat(t),this.dirty=!0}addRealtimeTransfer(t){this.pointer<this.bufferSize&&(this.realtimeBuffer[this.pointer]=t,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.alreadyWarned=!0,this.watermarkObserver()),this.pointer=this.pointer+1),this.dirty=!0}reset(){this.archiveTransfers=[],this.realtimeBuffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.dirty=!0}snapshot(){let t=[...this.archiveTransfers];return this.realtimeBuffer.map(e=>{if(!e)return;let n=t.findIndex(a=>a.id===e.id);n===-1?t.push(e):t[n]=e}),t.sort((e,n)=>{let a=e.creationTime||e.startTime||"";return(n.creationTime||n.startTime||"").localeCompare(a)}),t}compact(t){let e=this.snapshot();e.length=Math.min(t,e.length),this.reset(),this.archiveTransfers=e,this.dirty=!0}};var dt=class{constructor(t,e){this.transfer=t;this.objectUrl=e}get id(){return this.transfer.id}get creationTime(){return this.transfer.creationTime}get startTime(){return this.transfer.startTime}get direction(){return this.transfer.direction}get localEntity(){return this.transfer.localEntity}get remoteEntity(){return this.transfer.remoteEntity}get state(){return this.transfer.state}get bucket(){return this.transfer.bucket}get objectName(){return this.transfer.objectName}get remotePath(){return this.transfer.remotePath}get totalSize(){return this.transfer.totalSize}get sizeTransferred(){return this.transfer.sizeTransferred}get failureReason(){return this.transfer.failureReason}get transferType(){return this.transfer.transferType}};var ft=class extends At{constructor(e,n,a){super();this.yamcs=e;this.storageClient=a;this.pageSize=100;this.transfers$=new D([]);this.loading$=new D(!1);this.streaming$=new D(!1);this.syncSubscription=n.sync(()=>{this.buffer.dirty&&!this.loading$.getValue()&&(this.emitTransfers(),this.buffer.dirty=!1)}),this.buffer=new pt(()=>{this.buffer.compact(500)})}connect(e){return this.transfers$}emitTransfers(){let e=this.buffer.snapshot();this.transfers$.next(e)}loadTransfers(e,n){return this.loading$.next(!0),Promise.all([this.loadPage(e,Ee(Fe({},n),{limit:this.pageSize}))]).then(a=>{let p=a[0].map(w=>this.toItem(w));return this.loading$.next(!1),this.buffer.reset(),this.buffer.addArchiveData(p),this.emitTransfers(),p})}loadPage(e,n){return this.options=n,this.yamcs.yamcsClient.getFileTransfers(this.yamcs.instance,e.name,n).then(a=>a.transfers||[])}startStreaming(e){this.streaming$.next(!0),this.realtimeSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:e.name,ongoingOnly:!0},n=>{!this.loading$.getValue()&&this.matchesFilter(n)&&this.buffer.addRealtimeTransfer(this.toItem(n))})}toItem(e){let n=e.objectName?this.storageClient.getObjectURL(e.bucket,e.objectName):"";return new dt(e,n)}matchesFilter(e){return!(this.options&&(this.options.direction&&e.direction!==this.options.direction||this.options.localEntityId&&e.localEntity.id!==this.options.localEntityId||this.options.remoteEntityId&&e.remoteEntity.id!==this.options.remoteEntityId||this.options.state?.length&&this.options.state.indexOf(e.state)===-1))}stopStreaming(){this.realtimeSubscription?.cancel(),this.streaming$.next(!1)}disconnect(e){this.stopStreaming(),this.syncSubscription?.unsubscribe(),this.transfers$.complete(),this.loading$.complete(),this.streaming$.complete()}};var ca=()=>["detail"];function ma(i,t){if(i&1){let e=b();l(0,"button",38),g("click",function(){let a=v(e).$implicit,p=c(2);return S(p.switchService(a))}),s(1),r()}if(i&2){let e=t.$implicit;o(),h(" ",e.name," ")}}function pa(i,t){if(i&1&&(l(0,"ya-page-button",35),s(1),r(),l(2,"mat-menu",36,0),N(4,ma,2,1,"button",37,L),r()),i&2){let e,n=X(3),a=c();m("matMenuTriggerFor",n),o(),h(" ",((e=a.service())==null?null:e.name)||"select service"," "),o(3),R(a.services())}}function da(i,t){if(i&1){let e=b();l(0,"ya-page-button",40),g("click",function(){v(e);let a=c(),p=c();return S(p.showCreateTransferDialog(a))}),s(1),r()}if(i&2){let e=c();m("icon",e.capabilities.download&&e.capabilities.upload?"cloud":e.capabilities.upload?"cloud_upload":"cloud_download"),o(),h(" New ",e.capabilities.download&&e.capabilities.upload?"transfer":e.capabilities.upload?"upload":"download"," ")}}function fa(i,t){if(i&1&&d(0,da,2,2,"ya-page-button",39),i&2){let e=t,n=c();f(n.mayControlFileTransfers()&&(e.capabilities.download||e.capabilities.upload)?0:-1)}}function ua(i,t){if(i&1){let e=b();T(0,"ya-date-time-input",41)(1,"ya-date-time-input",42),l(2,"ya-button",43),g("click",function(){v(e);let a=c();return S(a.applyCustomDates())}),s(3," Apply "),r()}if(i&2){let e=c();o(2),m("disabled",e.filterForm.invalid)}}function _a(i,t){if(i&1){let e=b();l(0,"ya-button",44),g("click",function(){v(e);let a=c();return S(a.jumpToNow())}),s(1,"Jump to now"),r()}}function ha(i,t){i&1&&(l(0,"th",45),s(1,"Started"),r())}function Ca(i,t){if(i&1&&(l(0,"td",46),s(1),u(2,"datetime"),r()),i&2){let e=t.$implicit;o(),h(" ",_(2,1,e.startTime)," ")}}function ga(i,t){i&1&&(l(0,"th",45),s(1,"Local entity"),r())}function va(i,t){if(i&1&&(l(0,"td",47),s(1),r()),i&2){let e,n=t.$implicit;o(),h(" ",(e=(e=n.localEntity==null?null:n.localEntity.name)!==null&&e!==void 0?e:n.localEntity==null?null:n.localEntity.id)!==null&&e!==void 0?e:"-"," ")}}function Sa(i,t){i&1&&(l(0,"th",45),s(1,"Local file"),r())}function xa(i,t){if(i&1&&(l(0,"span"),s(1),u(2,"storageUrl"),r()),i&2){let e=c().$implicit;o(),h(" ",vt(2,1,e.objectName,e.bucket)||"-"," ")}}function ya(i,t){if(i&1&&(l(0,"a",49),s(1),u(2,"storageUrl"),r()),i&2){let e=c().$implicit;m("href",e.objectUrl,bt),o(),h(" ",vt(2,2,e.objectName,e.bucket)||"-"," ")}}function Ta(i,t){if(i&1&&(l(0,"td",48),d(1,xa,3,4,"span")(2,ya,3,5,"a",49),r()),i&2){let e=t.$implicit;o(),f(e.direction==="DOWNLOAD"&&e.state!=="COMPLETED"||!e.objectUrl?1:2)}}function ba(i,t){i&1&&(l(0,"th",45),s(1,"Direction"),r())}function Fa(i,t){i&1&&(l(0,"mat-icon"),s(1,"west"),r())}function wa(i,t){i&1&&(l(0,"mat-icon",51),s(1,"east"),r())}function Da(i,t){if(i&1&&(l(0,"td",50),d(1,Fa,2,0,"mat-icon")(2,wa,2,0,"mat-icon",51),r()),i&2){let e=t.$implicit;o(),f(e.direction==="DOWNLOAD"?1:-1),o(),f(e.direction==="UPLOAD"?2:-1)}}function Ea(i,t){i&1&&(l(0,"th",45),s(1,"Remote entity"),r())}function Oa(i,t){if(i&1&&(l(0,"td",47),s(1),r()),i&2){let e,n=t.$implicit;o(),h(" ",(e=(e=n.remoteEntity==null?null:n.remoteEntity.name)!==null&&e!==void 0?e:n.remoteEntity==null?null:n.remoteEntity.id)!==null&&e!==void 0?e:"-"," ")}}function Ma(i,t){i&1&&(l(0,"th",45),s(1,"Remote file"),r())}function ka(i,t){if(i&1&&(l(0,"td",48),s(1),r()),i&2){let e=t.$implicit;o(),h(" ",e.remotePath||"-"," ")}}function Pa(i,t){i&1&&(l(0,"th",45),s(1,"Size"),r())}function Ia(i,t){if(i&1&&(l(0,"td",47),s(1),u(2,"formatBytes"),r()),i&2){let e,n=t.$implicit;o(),h(" ",(e=_(2,1,n.totalSize))!==null&&e!==void 0?e:"-"," ")}}function La(i,t){i&1&&T(0,"th",52)}function Na(i,t){if(i&1&&(l(0,"td",53),T(1,"app-file-transfer-icon",54),r()),i&2){let e=t.$implicit;o(),m("transfer",e)}}function Ra(i,t){i&1&&(l(0,"th",45),s(1,"Transferred"),r())}function $a(i,t){if(i&1&&(l(0,"td",47),s(1),u(2,"formatBytes"),r()),i&2){let e,n=t.$implicit;o(),h(" ",(e=_(2,1,n.sizeTransferred))!==null&&e!==void 0?e:"-"," ")}}function Aa(i,t){i&1&&(l(0,"th",45),s(1,"Transfer type"),r())}function Ba(i,t){if(i&1&&(l(0,"td",47),s(1),r()),i&2){let e=t.$implicit;o(),$(e.transferType||"-")}}function Va(i,t){i&1&&T(0,"th",55)}function ja(i,t){if(i&1){let e=b();l(0,"ya-text-action",59),g("click",function(){v(e);let a=c(2).$implicit,p=c();return S(p.pauseTransfer(a))}),s(1," PAUSE "),r()}}function Ua(i,t){if(i&1){let e=b();l(0,"ya-text-action",60),g("click",function(){v(e);let a=c(2).$implicit,p=c();return S(p.resumeTransfer(a))}),s(1," RESUME "),r()}}function za(i,t){if(i&1&&d(0,ja,2,0,"ya-text-action",57)(1,Ua,2,0,"ya-text-action",58),i&2){let e=c().$implicit;f(e.state==="RUNNING"?0:-1),o(),f(e.state==="PAUSED"?1:-1)}}function Ha(i,t){if(i&1){let e=b();l(0,"ya-text-action",61),g("click",function(){v(e);let a=c().$implicit,p=c();return S(p.cancelTransfer(a))}),s(1," CANCEL "),r()}}function Ya(i,t){if(i&1&&(l(0,"td",47),d(1,za,2,2)(2,Ha,2,0,"ya-text-action",56),r()),i&2){let e,n=t.$implicit,a=c();o(),f(!((e=a.service())==null||e.capabilities==null)&&e.capabilities.pauseResume?1:-1),o(),f(n.state!=="COMPLETED"&&n.state!=="FAILED"?2:-1)}}function Ga(i,t){if(i&1&&T(0,"ya-progress",63),i&2){let e=c().$implicit,n=c();m("value",n.transferPercent(e))("total",1)}}function Wa(i,t){if(i&1&&(l(0,"span",64),s(1),r()),i&2){let e=c().$implicit;o(),h(" ",e.failureReason," ")}}function qa(i,t){if(i&1&&(l(0,"td",47),u(1,"async"),l(2,"div",62),d(3,Ga,1,2,"ya-progress",63),l(4,"span"),s(5),u(6,"formatBytes"),r(),d(7,Wa,2,1,"span",64),r()()),i&2){let e=t.$implicit,n=c();oe("colspan",_(1,4,n.displayedColumns$).length),o(3),f(e.state==="RUNNING"||e.state==="PAUSED"||e.state==="CANCELLING"?3:-1),o(2),$(_(6,6,e.sizeTransferred)),o(2),f(e.failureReason?7:-1)}}function Ka(i,t){i&1&&T(0,"tr",65)}function Qa(i,t){if(i&1&&T(0,"tr",66),i&2){let e=t.$implicit;I("upload",e.direction==="UPLOAD")("nodetail",e.state==="COMPLETED")}}function Xa(i,t){if(i&1&&T(0,"tr",67),i&2){let e=t.$implicit;I("upload",e.direction==="UPLOAD")}}function Ja(i,t){i&1&&(l(0,"ya-empty-message",34)(1,"p"),s(2,"This instance has no file transfer services configured."),r()())}var Ti="NO_LIMIT",ut=class i{constructor(t,e,n,a,p,w,B,V){this.yamcs=e;this.router=n;this.route=a;this.messageService=p;this.authService=w;this.dialog=B;this.services=U.required();this.requestedServiceName=U(null,{alias:"service"});this.requestedService=Re(()=>{let t=null,e=this.services();for(let n of e)if(this.requestedServiceName()===n.name){t=n;break}return!t&&!this.requestedServiceName()&&(t=e.length?e[0]:null),t});this.service=ke(null);this.localEntityOptions=Re(()=>{let t=[{id:"ANY",label:"Any local entity"}];for(let e of this.service()?.localEntities||[])t.push({id:String(e.id),label:e.name});return t});this.remoteEntityOptions=Re(()=>{let t=[{id:"ANY",label:"Any remote entity"}];for(let e of this.service()?.remoteEntities||[])t.push({id:String(e.id),label:e.name});return t});this.isIncomplete=(t,e)=>e.state!=="COMPLETED";this.filterForm=new It({interval:new ee(Ti),customStart:new ee(null),customStop:new ee(null),direction:new ee("ANY"),state:new ee([]),localEntityId:new ee("ANY"),remoteEntityId:new ee("ANY")});this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.directionOptions=[{id:"ANY",label:"Any direction"},{id:"DOWNLOAD",label:"Download"},{id:"UPLOAD",label:"Upload"}];this.stateOptions=[{id:"QUEUED",label:"Queued"},{id:"RUNNING",label:"Running"},{id:"PAUSED",label:"Paused"},{id:"CANCELLING",label:"Cancelling"},{id:"FAILED",label:"Failed"},{id:"COMPLETED",label:"Completed"}];this.defaultColumns=["status","startTime","localEntity","localFile","direction","remoteEntity","remoteFile","size","actions"];this.displayedColumns$=new D([]);this.state=[];t.setTitle("File transfer");let re=e.createStorageClient();this.dataSource=new ft(e,V,re)}ngOnInit(){let t=this.requestedService();this.switchService(t)}switchService(t){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{service:t?.name||null},queryParamsHandling:"merge"}),this.dataSource.stopStreaming(),this.service.set(t),t&&this.dataSource.startStreaming(t);let e=[...this.defaultColumns];t?.capabilities?.hasTransferType&&e.splice(e.length-1,0,"transferType"),this.displayedColumns$.next(e),this.initializeOptions(),this.loadData(),this.filterForm.get("direction").valueChanges.forEach(n=>{this.direction=n!=="ANY"?n:null,this.loadData()}),this.filterForm.get("state").valueChanges.forEach(n=>{this.state=n,this.loadData()}),this.filterForm.get("localEntityId").valueChanges.forEach(n=>{this.localEntityId=n!=="ANY"?n:null,this.loadData()}),this.filterForm.get("remoteEntityId").valueChanges.forEach(n=>{this.remoteEntityId=n!=="ANY"?n:null,this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(n=>{if(n==="CUSTOM"){let a=this.validStart||this.yamcs.getMissionTime(),p=this.validStop||this.yamcs.getMissionTime();this.filterForm.get("customStart").setValue(E.toISOString(a)),this.filterForm.get("customStop").setValue(E.toISOString(p))}else n==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=n,this.loadData()):(this.validStop=this.yamcs.getMissionTime(),this.validStart=E.subtractDuration(this.validStop,n),this.appliedInterval=n,this.loadData())})}initializeOptions(){let t=this.route.snapshot.queryParamMap;if(t.has("direction")&&(this.direction=t.get("direction"),this.filterForm.get("direction").setValue(this.direction)),t.has("state")&&(this.state=t.getAll("state"),this.filterForm.get("state").setValue(this.state)),t.has("localEntityId")&&(this.localEntityId=t.get("localEntityId"),this.filterForm.get("localEntityId").setValue(this.localEntityId)),t.has("remoteEntityId")&&(this.remoteEntityId=t.get("remoteEntityId"),this.filterForm.get("remoteEntityId").setValue(this.remoteEntityId)),t.has("interval"))if(this.appliedInterval=t.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let e=t.get("customStart");this.filterForm.get("customStart").setValue(e),this.validStart=E.toDate(e);let n=t.get("customStop");this.filterForm.get("customStop").setValue(n),this.validStop=E.toDate(n)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=this.yamcs.getMissionTime(),this.validStart=E.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval=Ti,this.validStop=null,this.validStart=null}mayControlFileTransfers(){return this.authService.getUser().hasSystemPrivilege("ControlFileTransfers")}showCreateTransferDialog(t){this.dialog.open(ct,{width:"70%",height:"100%",autoFocus:!1,position:{right:"0"},panelClass:"dialog-full-size",data:{service:t}})}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){this.validStart=E.toDate(this.filterForm.value.customStart),this.validStop=E.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let t={};this.validStart&&(t.start=this.validStart.toISOString()),this.validStop&&(t.stop=this.validStop.toISOString()),this.direction&&(t.direction=this.direction),this.localEntityId&&(t.localEntityId=this.localEntityId),this.remoteEntityId&&(t.remoteEntityId=this.remoteEntityId),this.state.length&&(t.state=this.state);let e=this.service();e&&this.dataSource.loadTransfers(e,t).catch(n=>this.messageService.showError(n))}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{direction:this.direction||null,state:this.state.length?this.state:null,localEntityId:this.localEntityId||null,remoteEntityId:this.remoteEntityId||null,interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStart:null,customStop:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}transferPercent(t){return t.totalSize!=0?t.sizeTransferred/t.totalSize:0}pauseTransfer(t){let e=t.id,n=this.service().name;this.yamcs.yamcsClient.pauseFileTransfer(this.yamcs.instance,n,e).catch(a=>{this.messageService.showError(a)})}resumeTransfer(t){let e=t.id,n=this.service().name;this.yamcs.yamcsClient.resumeFileTransfer(this.yamcs.instance,n,e).catch(a=>{this.messageService.showError(a)})}cancelTransfer(t){let e=t.id,n=this.service().name;this.yamcs.yamcsClient.cancelFileTransfer(this.yamcs.instance,n,e).catch(a=>{this.messageService.showError(a)})}static{this.\u0275fac=function(e){return new(e||i)(F($e),F(A),F(Be),F(Ae),F(Se),F(mi),F(Ut),F(ci))}}static{this.\u0275cmp=O({type:i,selectors:[["app-file-transfer-list"]],inputs:{services:[1,"services"],requestedServiceName:[1,"service","requestedServiceName"]},standalone:!0,features:[M],decls:59,vars:21,consts:[["serviceMenu","matMenu"],[1,"table-wrapper"],[1,"panel-content"],[2,"margin-top","16px",3,"formGroup"],[1,"filter-bar"],["formControlName","direction",3,"options"],["formControlName","state","emptyOption","Any status",3,"options"],["formControlName","localEntityId",3,"options"],["formControlName","remoteEntityId",3,"options"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","","multiTemplateDataRows","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","startTime"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","style","white-space: nowrap",4,"matCellDef"],["matColumnDef","localEntity"],["mat-cell","",4,"matCellDef"],["matColumnDef","localFile"],["mat-cell","","class","file-column",4,"matCellDef"],["matColumnDef","direction"],["mat-cell","","style","text-align: center",4,"matCellDef"],["matColumnDef","remoteEntity"],["matColumnDef","remoteFile"],["matColumnDef","size"],["matColumnDef","status"],["mat-header-cell","","class","status",4,"matHeaderCellDef"],["mat-cell","","class","status",4,"matCellDef"],["matColumnDef","transferred"],["matColumnDef","transferType"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["matColumnDef","detail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","item-row",3,"upload","nodetail",4,"matRowDef","matRowDefColumns"],["mat-row","","class","item-detail",3,"upload",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["headerTitle","File Transfer"],["dropdown","true",3,"matMenuTriggerFor"],[1,"ya-menu"],["mat-menu-item",""],["mat-menu-item","",3,"click"],[3,"icon"],[3,"click","icon"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["mat-header-cell",""],["mat-cell","",2,"white-space","nowrap"],["mat-cell",""],["mat-cell","",1,"file-column"],["download","",3,"href"],["mat-cell","",2,"text-align","center"],[1,"upload"],["mat-header-cell","",1,"status"],["mat-cell","",1,"status"],[3,"transfer"],["mat-header-cell","",1,"expand"],["icon","not_interested"],["icon","pause_circle_outline"],["icon","play_circle_outline"],["icon","pause_circle_outline",3,"click"],["icon","play_circle_outline",3,"click"],["icon","not_interested",3,"click"],[1,"detail-layout"],["width","200px",3,"value","total"],[1,"error"],["mat-header-row",""],["mat-row","",1,"item-row"],["mat-row","",1,"item-detail"]],template:function(e,n){if(e&1&&(l(0,"app-instance-page")(1,"app-instance-toolbar"),s(2," File transfer\xA0\xA0\xA0\xA0 "),d(3,pa,6,2)(4,fa,1,1),r(),l(5,"div",1)(6,"div",2),T(7,"app-file-transfer-tabs"),l(8,"form",3)(9,"div",4),T(10,"ya-select",5)(11,"ya-multi-select",6)(12,"ya-select",7)(13,"ya-select",8)(14,"ya-select",9),d(15,ua,4,1)(16,_a,2,0,"ya-button"),r()(),l(17,"table",10),x(18,11),d(19,ha,2,0,"th",12)(20,Ca,3,3,"td",13),y(),x(21,14),d(22,ga,2,0,"th",12)(23,va,2,1,"td",15),y(),x(24,16),d(25,Sa,2,0,"th",12)(26,Ta,3,1,"td",17),y(),x(27,18),d(28,ba,2,0,"th",12)(29,Da,3,2,"td",19),y(),x(30,20),d(31,Ea,2,0,"th",12)(32,Oa,2,1,"td",15),y(),x(33,21),d(34,Ma,2,0,"th",12)(35,ka,2,1,"td",17),y(),x(36,22),d(37,Pa,2,0,"th",12)(38,Ia,3,3,"td",15),y(),x(39,23),d(40,La,1,0,"th",24)(41,Na,2,1,"td",25),y(),x(42,26),d(43,Ra,2,0,"th",12)(44,$a,3,3,"td",15),y(),x(45,27),d(46,Aa,2,0,"th",12)(47,Ba,2,1,"td",15),y(),x(48,28),d(49,Va,1,0,"th",29)(50,Ya,3,2,"td",15),y(),x(51,30),d(52,qa,8,8,"td",15),y(),d(53,Ka,1,0,"tr",31),u(54,"async"),d(55,Qa,1,4,"tr",32),u(56,"async"),d(57,Xa,1,2,"tr",33),r(),d(58,Ja,3,0,"ya-empty-message",34),r()()()),e&2){let a;o(3),f(n.services().length?3:-1),o(),f((a=n.service())?4:-1,a),o(4),m("formGroup",n.filterForm),o(2),m("options",n.directionOptions),o(),m("options",n.stateOptions),o(),m("options",n.localEntityOptions()),o(),m("options",n.remoteEntityOptions()),o(),m("options",n.intervalOptions),o(),f(n.filterForm.value.interval==="CUSTOM"?15:-1),o(),f(n.filterForm.value.interval!=="CUSTOM"?16:-1),o(),m("dataSource",n.dataSource),o(36),m("matHeaderRowDef",_(54,16,n.displayedColumns$)),o(2),m("matRowDefColumns",_(56,18,n.displayedColumns$)),o(2),m("matRowDefColumns",k(20,ca))("matRowDefWhen",n.isIncomplete),o(),f(n.services().length?-1:58)}},dependencies:[mt,xe,it,nt,P,Z,de,me,pe,fe,ue,H,Ue,_e,ze,Y,qe,Qe,Ke,We,Xe,te,G,ie,W,ve,Je,ii,oi,ri,et,Ze,ni,q,ae,si],styles:["tr.item-row[_ngcontent-%COMP%]:not(.nodetail)   td[_ngcontent-%COMP%]{border-bottom-width:0}tr.item-detail[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:40px!important}.detail-layout[_ngcontent-%COMP%]{display:flex;align-items:center}.detail-layout[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-left:20px}.error[_ngcontent-%COMP%]{color:#dc143c}.file-column[_ngcontent-%COMP%]{white-space:normal!important;min-width:250px!important;max-width:250px!important;overflow-wrap:break-word}tr.upload[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#f7f7f7}"],changeDetection:0})}};var bi=(i,t)=>{let e=yt(A);return e.yamcsClient.getFileTransferServices(e.instance).then(n=>n.services)};var Ol=[{path:"",canActivate:[di,pi],canActivateChild:[fi],runGuardsAndResolvers:"always",component:ui,children:[{path:"",pathMatch:"full",component:ut,resolve:{services:bi}},{path:"log",component:at}]}];export{Ol as ROUTES};
