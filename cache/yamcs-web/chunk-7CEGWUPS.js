import{a as Qe}from"./chunk-TBQBLT67.js";import{a as ve}from"./chunk-FLUSJCAZ.js";import{a as Nt}from"./chunk-SM6BVRIH.js";import"./chunk-H5AEFDX2.js";import{b as fe,d as Ce,e as Vt,f as Ht}from"./chunk-WVE4Y3TR.js";import{$b as Ee,Ae as ht,Ba as he,Bb as we,Ca as o,Da as Y,E as w,Ea as f,Ed as ke,Ef as ue,Fa as O,Fb as L,Fd as Me,Gb as H,Gd as ft,Hb as st,Hd as Ve,Ia as D,Ib as De,Id as Oe,Ie as P,J as x,Ja as lt,Jb as Ie,Jd as Le,Jf as Dt,K as g,Ka as V,Kb as X,Kd as He,Lb as N,O as B,Oa as v,Pa as h,Pb as F,Pe as T,Pf as W,Q as Se,Qa as Ae,Ra as rt,Sb as $,Se as Fe,Sf as It,Te as xt,U as ot,Ue as gt,X as r,Y as C,Ze as q,aa as p,bc as j,bf as St,ca as _,cb as ye,da as Ke,dc as pt,df as At,e as G,ea as Je,eb as Te,ff as yt,ga as s,gc as dt,ge as ae,he as ne,ib as Z,ie as oe,j as ge,ka as a,ke as le,la as n,le as re,lg as k,ma as u,mb as be,na as A,ne as me,oa as y,oc as ie,oe as ce,of as _e,og as Et,pg as kt,q as nt,qa as b,qb as ee,qe as se,qf as Tt,ra as S,rb as mt,re as pe,rg as I,sa as c,sb as te,sf as bt,sg as Mt,tb as U,tc as _t,te as de,tg as Ot,ub as ct,uc as ut,ue as Ne,ug as Lt,vf as wt,ye as Ct,ze as vt}from"./chunk-SAZ6MTOG.js";var Rt=()=>({matrixParams:"exact",paths:"exact",queryParams:"ignored"}),Xe=t=>({c:t}),z=class t{constructor(i){this.yamcs=i}static{this.\u0275fac=function(e){return new(e||t)(C(k))}}static{this.\u0275cmp=w({type:t,selectors:[["app-alarms-page-tabs"]],standalone:!0,features:[D],decls:13,vars:16,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["rlc","routerLinkActive"],["tabPanel",""],["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","/alarms","routerLinkActive","",3,"routerLinkActiveOptions","active","queryParams"],["mat-tab-link","","routerLink","/alarms/history","routerLinkActive","",3,"active","queryParams"],["mat-tab-link","","routerLink","/alarms/log","routerLinkActive","",3,"active","queryParams"]],template:function(e,l){if(e&1&&(a(0,"nav",4)(1,"a",5,0),o(3," Active "),n(),a(4,"a",6,1),o(6," History "),n(),a(7,"a",7,2),o(9," Action log "),n()(),a(10,"mat-tab-nav-panel",null,3),u(12,"router-outlet"),n()),e&2){let m=he(2),d=he(5),M=he(8),R=he(11);_("mat-stretch-tabs",!1)("tabPanel",R),r(),_("routerLinkActiveOptions",lt(9,Rt))("active",m.isActive)("queryParams",V(10,Xe,l.yamcs.context)),r(3),_("active",d.isActive)("queryParams",V(12,Xe,l.yamcs.context)),r(3),_("active",M.isActive)("queryParams",V(14,Xe,l.yamcs.context))}},dependencies:[I,mt,U,ct,Ct,ht,vt],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}"],changeDetection:0})}};function Bt(t,i){if(t&1){let e=b();u(0,"ya-date-time-input",14)(1,"ya-date-time-input",15),a(2,"ya-button",16),S("click",function(){x(e);let m=c();return g(m.applyCustomDates())}),o(3,"Apply"),n()}if(t&2){let e=c();r(2),_("disabled",e.filterForm.invalid)}}function Yt(t,i){if(t&1){let e=b();a(0,"ya-button",17),S("click",function(){x(e);let m=c();return g(m.jumpToNow())}),o(1,"Jump to now"),n()}}function Ut(t,i){t&1&&(a(0,"th",18),o(1,"Time"),n())}function jt(t,i){if(t&1&&(a(0,"td",19),o(1),v(2,"datetime"),n()),t&2){let e=i.$implicit;r(),Y(h(2,1,e.time))}}function qt(t,i){t&1&&(a(0,"th",18),o(1,"User"),n())}function Wt(t,i){if(t&1&&(a(0,"td",19),o(1),n()),t&2){let e=i.$implicit;r(),Y(e.user||"-")}}function zt(t,i){t&1&&(a(0,"th",18),o(1,"Action"),n())}function Kt(t,i){if(t&1&&(a(0,"td",19),u(1,"span",20),v(2,"actionLogFormat"),n()),t&2){let e=i.$implicit;r(),_("innerHTML",h(2,1,e.summary)||"-",ot)}}function Jt(t,i){t&1&&u(0,"th",21)}function Qt(t,i){t&1&&u(0,"td",19)}function Xt(t,i){t&1&&u(0,"tr",22)}function Zt(t,i){t&1&&u(0,"tr",23)}var $e=class t{constructor(i,e,l,m,d){this.yamcs=e;this.messageService=l;this.router=m;this.route=d;this.interval=Se();this.customStart=Se();this.customStop=Se();this.filterForm=new st({interval:new Ie("NO_LIMIT"),customStart:new Ie(null),customStop:new Ie(null)});this.displayedColumns=["time","user","summary","actions"];this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.dataSource=new Ne;i.setTitle("Alarms")}ngOnInit(){this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(i=>{if(i==="CUSTOM"){let e=new Date,l=this.validStart||e,m=this.validStop||e;this.filterForm.get("customStart").setValue(T.toISOString(l)),this.filterForm.get("customStop").setValue(T.toISOString(m))}else i==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=i,this.loadData()):i&&(this.validStop=new Date,this.validStart=T.subtractDuration(this.validStop,i),this.appliedInterval=i,this.loadData())})}initializeOptions(){if(this.interval())if(this.appliedInterval=this.interval(),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let i=this.customStart();this.filterForm.get("customStart").setValue(i),this.validStart=T.toDate(i);let e=this.customStop();this.filterForm.get("customStop").setValue(e),this.validStop=T.toDate(e)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=T.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){let{controls:i}=this.filterForm;this.validStart=T.toDate(i.customStart.value),this.validStop=T.toDate(i.customStop.value),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let i={service:"AlarmsApi"};this.validStart&&(i.start=this.validStart.toISOString()),this.validStop&&(i.stop=this.validStop.toISOString()),this.yamcs.yamcsClient.getAuditRecords(this.yamcs.instance,i).then(e=>this.dataSource.data=e.records||[]).catch(e=>this.messageService.showError(e))}updateURL(){let{controls:i}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?i.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?i.customStop.value:null},queryParamsHandling:"merge"})}static{this.\u0275fac=function(e){return new(e||t)(C(be),C(k),C(_e),C(te),C(ee))}}static{this.\u0275cmp=w({type:t,selectors:[["app-alarms-action-log-tab"]],inputs:{interval:[1,"interval"],customStart:[1,"customStart"],customStop:[1,"customStop"]},standalone:!0,features:[D],decls:25,vars:7,consts:[[1,"panel-content"],[2,"margin-top","16px",3,"formGroup"],[1,"filter-bar"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","user"],["matColumnDef","summary"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"innerHTML"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(e,l){e&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),o(2,"Alarms"),n(),a(3,"div",0),u(4,"app-alarms-page-tabs"),a(5,"form",1)(6,"div",2),u(7,"ya-select",3),p(8,Bt,4,1)(9,Yt,2,0,"ya-button"),n()(),a(10,"table",4),A(11,5),p(12,Ut,2,0,"th",6)(13,jt,3,3,"td",7),y(),A(14,8),p(15,qt,2,0,"th",6)(16,Wt,2,1,"td",7),y(),A(17,9),p(18,zt,2,0,"th",6)(19,Kt,3,3,"td",7),y(),A(20,10),p(21,Jt,1,0,"th",11)(22,Qt,1,0,"td",7),y(),p(23,Xt,1,0,"tr",12)(24,Zt,1,0,"tr",13),n()()()),e&2&&(r(5),_("formGroup",l.filterForm),r(2),_("options",l.intervalOptions),r(),s(l.filterForm.value.interval==="CUSTOM"?8:-1),r(),s(l.filterForm.value.interval!=="CUSTOM"?9:-1),r(),_("dataSource",l.dataSource),r(13),_("matHeaderRowDef",l.displayedColumns),r(),_("matRowDefColumns",l.displayedColumns))},dependencies:[z,Ce,fe,I,N,L,H,F,$,ae,oe,ce,le,ne,se,re,me,pe,de,P,Fe,q,Dt,W],encapsulation:2,changeDetection:0})}};var et=t=>({c:t});function ei(t,i){if(t&1){let e=b();u(0,"ya-date-time-input",8)(1,"ya-date-time-input",9),a(2,"ya-button",10),S("click",function(){x(e);let m=c();return g(m.applyCustomDates())}),o(3," Apply "),n()}if(t&2){let e=c();r(2),_("disabled",e.filterForm.invalid)}}function ti(t,i){if(t&1){let e=b();a(0,"ya-button",11),S("click",function(){x(e);let m=c();return g(m.jumpToNow())}),o(1,"Jump to now"),n()}}function ii(t,i){t&1&&(a(0,"th",29),o(1,"Severity"),n())}function ai(t,i){if(t&1&&(a(0,"td",30),u(1,"app-alarm-level",31),n()),t&2){let e=i.$implicit;r(),_("level",e.severity)("grayscale",!0)}}function ni(t,i){t&1&&(a(0,"th",29),o(1,"Alarm type"),n())}function oi(t,i){t&1&&(a(0,"mat-icon",32),o(1,"event_note"),n())}function li(t,i){t&1&&(a(0,"mat-icon",32),o(1,"toll"),n())}function ri(t,i){if(t&1&&(a(0,"td",30),p(1,oi,2,0,"mat-icon",32)(2,li,2,0,"mat-icon",32),o(3),v(4,"titlecase"),n()),t&2){let e=i.$implicit;r(),s(e.type==="EVENT"?1:-1),r(),s(e.type==="PARAMETER"?2:-1),r(),f(" ",h(4,3,e.type||"-")," ")}}function mi(t,i){t&1&&(a(0,"th",29),o(1,"Start"),n())}function ci(t,i){if(t&1&&(a(0,"td",30),o(1),v(2,"datetime"),n()),t&2){let e=i.$implicit;r(),Y(h(2,1,e.triggerTime)||"-")}}function si(t,i){t&1&&(a(0,"th",29),o(1,"Stop"),n())}function pi(t,i){if(t&1&&(a(0,"td",30),o(1),v(2,"datetime"),n()),t&2){let e=i.$implicit;r(),f(" ",h(2,1,e.updateTime)||"-"," ")}}function di(t,i){t&1&&(a(0,"th",29),o(1,"Trip value"),n())}function _i(t,i){t&1&&(a(0,"span"),o(1,"\u2193"),n())}function ui(t,i){t&1&&(a(0,"span"),o(1,"\u2191"),n())}function fi(t,i){if(t&1&&(o(0),v(1,"value"),p(2,_i,2,0,"span")(3,ui,2,0,"span")),t&2){let e=i;f(" ",h(1,3,e.triggerValue.engValue)," "),r(2),s(e.triggerValue.rangeCondition==="LOW"?2:-1),r(),s(e.triggerValue.rangeCondition==="HIGH"?3:-1)}}function Ci(t,i){t&1&&o(0),t&2&&f(" ",i.triggerEvent.message||"-"," ")}function vi(t,i){if(t&1&&(a(0,"td",33),p(1,fi,4,5)(2,Ci,1,1),n()),t&2){let e,l,m=i.$implicit;r(),s((e=m.parameterDetail)?1:-1,e),r(),s((l=m.eventDetail)?2:-1,l)}}function hi(t,i){t&1&&(a(0,"th",29),o(1,"Alarm name"),n())}function xi(t,i){if(t&1&&(a(0,"a",34),o(1),n()),t&2){let e=c(2).$implicit,l=c(2);_("routerLink","/telemetry/parameters"+e.id.namespace+"/"+e.id.name)("queryParams",V(4,et,l.yamcs.context)),r(),O(" ",e.id.namespace,"/",e.id.name," ")}}function gi(t,i){if(t&1&&o(0),t&2){let e=c(2).$implicit;O(" ",e.id.namespace,"/",e.id.name," ")}}function Si(t,i){if(t&1&&p(0,xi,2,6,"a",34)(1,gi,1,2),t&2){let e=c().$implicit;s(e.parameterDetail?0:1)}}function Ai(t,i){if(t&1&&(a(0,"a",34),o(1),n()),t&2){let e=c(2).$implicit,l=c(2);_("routerLink","/telemetry/parameters"+e.id.namespace)("queryParams",V(3,et,l.yamcs.context)),r(),f(" ",e.id.namespace," ")}}function yi(t,i){if(t&1&&o(0),t&2){let e=c(2).$implicit;f(" ",e.id.namespace," ")}}function Ti(t,i){if(t&1&&p(0,Ai,2,5,"a",34)(1,yi,1,1),t&2){let e=c().$implicit;s(e.parameterDetail?0:1)}}function bi(t,i){if(t&1&&(a(0,"a",34),o(1),n()),t&2){let e=c(2).$implicit,l=c(2);_("routerLink","/telemetry/parameters"+e.id.name)("queryParams",V(3,et,l.yamcs.context)),r(),f(" ",e.id.name," ")}}function wi(t,i){if(t&1&&o(0),t&2){let e=c(2).$implicit;f(" ",e.id.name," ")}}function Di(t,i){if(t&1&&p(0,bi,2,5,"a",34)(1,wi,1,1),t&2){let e=c().$implicit;s(e.parameterDetail?0:1)}}function Ii(t,i){if(t&1&&(a(0,"td",30),p(1,Si,2,1)(2,Ti,2,1)(3,Di,2,1),n()),t&2){let e=i.$implicit;r(),s(e.id.namespace&&e.id.name?1:-1),r(),s(e.id.namespace&&!e.id.name?2:-1),r(),s(!e.id.namespace&&e.id.name?3:-1)}}function Ei(t,i){t&1&&(a(0,"th",29),o(1,"Duration"),n())}function ki(t,i){if(t&1&&(o(0),v(1,"duration")),t&2){let e=c().$implicit,l=c(2);f(" ",h(1,1,l.durationFor(e))||"-"," ")}}function Mi(t,i){if(t&1&&(a(0,"mat-icon",35),o(1,"comment"),n()),t&2){let e=c(2).$implicit;_("matTooltip",e.clearInfo==null?null:e.clearInfo.clearMessage)}}function Vi(t,i){if(t&1&&(o(0),p(1,Mi,2,1,"mat-icon",35)),t&2){let e=c().$implicit;f(" (cleared by ",e.clearInfo==null?null:e.clearInfo.clearedBy,") "),r(),s(e.clearInfo!=null&&e.clearInfo.clearMessage?1:-1)}}function Oi(t,i){if(t&1&&(a(0,"td",30),p(1,ki,2,3)(2,Vi,2,2),n()),t&2){let e=i.$implicit;r(),s(e.updateTime?1:-1),r(),s(e.clearInfo!=null&&e.clearInfo.clearedBy?2:-1)}}function Li(t,i){t&1&&(a(0,"th",36),o(1,"Violations"),n())}function Hi(t,i){if(t&1&&(o(0),v(1,"number"),v(2,"number")),t&2){let e=c().$implicit;O(" ",h(1,2,e.violations)," (",Ae(2,4,e.violations/e.count*100,"1.2-2"),"%) ")}}function Ni(t,i){t&1&&o(0," - ")}function Fi(t,i){if(t&1&&(a(0,"td",37),p(1,Hi,3,7)(2,Ni,1,0),n()),t&2){let e=i.$implicit;r(),s(e.violations?1:2)}}function $i(t,i){t&1&&u(0,"th",38)}function Pi(t,i){if(t&1){let e=b();a(0,"ya-text-action",41),S("click",function(){x(e);let m=c().$implicit,d=c(2);return g(d.showChart(m))}),o(1," SHOW CHART "),n()}}function Ri(t,i){if(t&1){let e=b();a(0,"ya-text-action",42),S("click",function(){x(e);let m=c().$implicit,d=c(2);return g(d.showData(m))}),o(1," SHOW DATA "),n()}}function Gi(t,i){if(t&1&&(a(0,"td",30),p(1,Pi,2,0,"ya-text-action",39)(2,Ri,2,0,"ya-text-action",40),n()),t&2){let e=i.$implicit;r(),s(e.parameterDetail?1:-1),r(),s(e.parameterDetail?2:-1)}}function Bi(t,i){t&1&&u(0,"tr",43)}function Yi(t,i){t&1&&u(0,"tr",44)}function Ui(t,i){if(t&1&&(a(0,"table",5),A(1,12),p(2,ii,2,0,"th",13)(3,ai,2,2,"td",14),y(),A(4,15),p(5,ni,2,0,"th",13)(6,ri,5,5,"td",14),y(),A(7,16),p(8,mi,2,0,"th",13)(9,ci,3,3,"td",14),y(),A(10,17),p(11,si,2,0,"th",13)(12,pi,3,3,"td",14),y(),A(13,18),p(14,di,2,0,"th",13)(15,vi,3,2,"td",19),y(),A(16,20),p(17,hi,2,0,"th",13)(18,Ii,4,3,"td",14),y(),A(19,21),p(20,Ei,2,0,"th",13)(21,Oi,3,2,"td",14),y(),A(22,22),p(23,Li,2,0,"th",23)(24,Fi,3,1,"td",24),y(),A(25,25),p(26,$i,1,0,"th",26)(27,Gi,3,2,"td",14),y(),p(28,Bi,1,0,"tr",27)(29,Yi,1,0,"tr",28),n()),t&2){let e=c();_("dataSource",e.dataSource),r(28),_("matHeaderRowDef",e.displayedColumns),r(),_("matRowDefColumns",e.displayedColumns)}}var Re=class t{constructor(i,e,l,m){this.yamcs=i;this.router=e;this.route=l;this.messageService=m;this.filterForm=new De({interval:new X("NO_LIMIT"),customStart:new X(null),customStop:new X(null)});this.displayedColumns=["severity","start","stop","duration","alarm","type","triggerValue","violations","actions"];this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}];this.dataSource=new Ne;this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(d=>{if(d==="CUSTOM"){let M=new Date,R=this.validStart||M,E=this.validStop||M;this.filterForm.get("customStart").setValue(T.toISOString(R)),this.filterForm.get("customStop").setValue(T.toISOString(E))}else d==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=d,this.loadData()):(this.validStop=new Date,this.validStart=T.subtractDuration(this.validStop,d),this.appliedInterval=d,this.loadData())})}initializeOptions(){let i=this.route.snapshot.queryParamMap;if(i.has("interval"))if(this.appliedInterval=i.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let e=i.get("customStart");this.filterForm.get("customStart").setValue(e),this.validStart=T.toDate(e);let l=i.get("customStop");this.filterForm.get("customStop").setValue(l),this.validStop=T.toDate(l)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=T.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){this.validStart=T.toDate(this.filterForm.value.customStart),this.validStop=T.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(i){this.updateURL();let e={};this.validStart&&(e.start=this.validStart.toISOString()),this.validStop&&(e.stop=this.validStop.toISOString()),this.yamcs.yamcsClient.getAlarms(this.yamcs.instance,e).then(l=>this.dataSource.data=l).catch(l=>this.messageService.showError(l))}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStart:null,customStop:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}durationFor(i){if(i.updateTime)return T.toDate(i.updateTime).getTime()-T.toDate(i.triggerTime).getTime()}showChart(i){let e=i.triggerTime,l=i.updateTime||i.clearInfo?.clearTime,m,d;l?(m=e,d=l):(m=e,d=Qe(T.toDate(e),1).toISOString()),this.router.navigate(["/telemetry/parameters"+i.parameterDetail?.triggerValue.id.name,"-","chart"],{queryParams:{c:this.yamcs.context,interval:"CUSTOM",customStart:m,customStop:d}})}showData(i){let e=i.triggerTime,l=i.updateTime||i.clearInfo?.clearTime,m,d;l?(m=e,d=l):(m=e,d=Qe(T.toDate(e),1).toISOString()),this.router.navigate(["/telemetry/parameters"+i.parameterDetail?.triggerValue.id.name,"-","data"],{queryParams:{c:this.yamcs.context,interval:"CUSTOM",customStart:m,customStop:d}})}static{this.\u0275fac=function(e){return new(e||t)(C(k),C(te),C(ee),C(_e))}}static{this.\u0275cmp=w({type:t,selectors:[["ng-component"]],standalone:!0,features:[D],decls:17,vars:6,consts:[[1,"table-wrapper"],[1,"panel-content"],[2,"margin-top","16px",3,"formGroup"],[1,"filter-bar"],["icon","access_time","formControlName","interval",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],[2,"flex","1 1 auto"],[3,"disabled"],["formControlName","customStart"],["formControlName","customStop"],[3,"click","disabled"],[3,"click"],["matColumnDef","severity"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","start"],["matColumnDef","stop"],["matColumnDef","triggerValue"],["mat-cell","","class","wrap200",4,"matCellDef"],["matColumnDef","alarm"],["matColumnDef","duration"],["matColumnDef","violations"],["mat-header-cell","","style","text-align: right",4,"matHeaderCellDef"],["mat-cell","","style","text-align: right",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"level","grayscale"],[2,"vertical-align","middle"],["mat-cell","",1,"wrap200"],[3,"routerLink","queryParams"],[3,"matTooltip"],["mat-header-cell","",2,"text-align","right"],["mat-cell","",2,"text-align","right"],["mat-header-cell","",1,"expand"],["icon","show_chart"],["icon","view_headline"],["icon","show_chart",3,"click"],["icon","view_headline",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(e,l){e&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),o(2,"Alarms"),n(),a(3,"div",0)(4,"div",1),u(5,"app-alarms-page-tabs"),a(6,"form",2)(7,"div",3),u(8,"ya-select",4),p(9,ei,4,1)(10,ti,2,0,"ya-button"),n()(),p(11,Ui,30,3,"table",5),a(12,"mat-toolbar"),u(13,"span",6),a(14,"ya-button",7),o(15,"Load more"),n(),u(16,"span",6),n()()()()),e&2&&(r(6),_("formGroup",l.filterForm),r(2),_("options",l.intervalOptions),r(),s(l.filterForm.value.interval==="CUSTOM"?9:-1),r(),s(l.filterForm.value.interval!=="CUSTOM"?10:-1),r(),s(l.dataSource?11:-1),r(3),_("disabled",!0))},dependencies:[ve,z,Ce,fe,I,Z,Te,N,L,H,F,$,U,j,ae,oe,ce,le,ne,se,re,me,pe,de,_t,ie,P,Fe,q,At,W,It,ue],encapsulation:2,changeDetection:0})}};function ji(t,i){if(t&1&&o(0),t&2){let e=c(2);f(" /",e.data.alarms[0].id.name," ")}}function qi(t,i){if(t&1&&(o(0),p(1,ji,1,1)),t&2){let e=c();f(" ",e.data.alarms[0].id.namespace," "),r(),s(e.data.alarms[0].id.name?1:-1)}}function Wi(t,i){if(t&1&&o(0),t&2){let e=c();f(" ",e.data.alarms.length," selected alarms. ")}}var Be=class t{constructor(i,e,l,m){this.dialogRef=i;this.yamcs=l;this.data=m;this.formGroup=e.group({comment:void 0})}async acknowledge(){let i=this.data.alarms,e=this.formGroup.get("comment").value;for(let l of i){let m={};e&&(m.comment=e);let d=l.id.namespace+(l.id.name?"/"+l.id.name:"");this.yamcs.yamcsClient.acknowledgeAlarm(this.yamcs.instance,this.yamcs.processor,d,l.seqNum,m)}this.dialogRef.close()}static{this.\u0275fac=function(e){return new(e||t)(C(ke),C(Ee),C(k),C(Me))}}static{this.\u0275cmp=w({type:t,selectors:[["app-acknowledge-alarm-dialog"]],standalone:!0,features:[D],decls:15,vars:4,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["formControlName","comment","rows","5",2,"resize","none"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,l){e&1&&(a(0,"h2",0),o(1,"Acknowledge"),n(),a(2,"mat-dialog-content")(3,"p"),p(4,qi,2,2)(5,Wi,1,1),n(),a(6,"form",1)(7,"label"),o(8," Comment "),u(9,"textarea",2),n()()(),a(10,"mat-dialog-actions",3)(11,"ya-button",4),o(12,"CANCEL"),n(),a(13,"ya-button",5),S("click",function(){return l.acknowledge()}),o(14," OK "),n()()),e&2&&(r(4),s(l.data.alarms.length===1?4:-1),r(),s(l.data.alarms.length!==1?5:-1),r(),_("formGroup",l.formGroup),r(7),_("disabled",!l.formGroup.valid))},dependencies:[I,N,we,L,H,F,$,Ve,Oe,He,Le,P],encapsulation:2,changeDetection:0})}};var zi=t=>({c:t});function Ki(t,i){if(t&1&&(a(0,"div",0),o(1,"Parameter"),n(),a(2,"div",1)(3,"a",4),o(4),n()()),t&2){let e=c();r(3),_("routerLink","/telemetry/parameters/"+e.alarm.id.namespace+"/"+e.alarm.id.name)("queryParams",V(4,zi,e.yamcs.context)),r(),O(" ",e.alarm.id.namespace,"/",e.alarm.id.name," ")}}function Ji(t,i){if(t&1&&o(0),t&2){let e=c(2);O(" ",e.alarm.id.namespace,"/",e.alarm.id.name," ")}}function Qi(t,i){if(t&1&&o(0),t&2){let e=c(2);f(" ",e.alarm.id.namespace," ")}}function Xi(t,i){if(t&1&&(a(0,"div",0),o(1,"Event"),n(),a(2,"div",1),p(3,Ji,1,2)(4,Qi,1,1),n()),t&2){let e=c();r(3),s(e.alarm.id.name?3:4)}}function Zi(t,i){t&1&&(a(0,"span"),o(1,"\u2193"),n())}function ea(t,i){t&1&&(a(0,"span"),o(1,"\u2191"),n())}function ta(t,i){t&1&&(a(0,"span"),o(1,"\u2193"),n())}function ia(t,i){t&1&&(a(0,"span"),o(1,"\u2191"),n())}function aa(t,i){if(t&1&&(u(0,"br")(1,"mat-divider"),a(2,"div",0),o(3,"Trigger value"),n(),a(4,"div",1),u(5,"app-alarm-level",5),o(6),v(7,"value"),p(8,Zi,2,0,"span")(9,ea,2,0,"span"),n(),u(10,"br")(11,"mat-divider"),a(12,"div",0),o(13,"Live value"),n(),a(14,"div",1)(15,"ya-expirable",6),u(16,"app-alarm-level",5),o(17),v(18,"value"),p(19,ta,2,0,"span")(20,ia,2,0,"span"),n()()),t&2){let e=i,l=c();r(5),_("level",l.alarm.severity)("grayscale",!0),r(),f(" \xA0",h(7,11,e.triggerValue.engValue)," "),r(2),s(e.triggerValue.rangeCondition==="LOW"?8:-1),r(),s(e.triggerValue.rangeCondition==="HIGH"?9:-1),r(6),_("pval",e.currentValue),r(),_("level",e.currentValue.monitoringResult)("grayscale",!0),r(),f(" \xA0",h(18,13,e.currentValue.engValue)," "),r(2),s(e.currentValue.rangeCondition==="LOW"?19:-1),r(),s(e.currentValue.rangeCondition==="HIGH"?20:-1)}}function na(t,i){t&1&&(u(0,"br")(1,"mat-divider"),a(2,"div",0),o(3,"Trigger event"),n(),a(4,"div",1),o(5),n()),t&2&&(r(5),f(" ",i.triggerEvent.message," "))}function oa(t,i){if(t&1&&(a(0,"blockquote",7),o(1),n()),t&2){let e=c(2);r(),f(" ",e.alarm.acknowledgeInfo.acknowledgeMessage," ")}}function la(t,i){if(t&1&&(u(0,"br")(1,"mat-divider"),a(2,"div",0),o(3),n(),a(4,"div",1),o(5),v(6,"datetime"),p(7,oa,2,1,"blockquote",7),n()),t&2){let e=c();r(3),f("Acknowledged by ",e.alarm.acknowledgeInfo.acknowledgedBy,""),r(2),f(" On ",h(6,3,e.alarm.acknowledgeInfo.acknowledgeTime)," "),r(2),s(e.alarm.acknowledgeInfo.acknowledgeMessage?7:-1)}}function ra(t,i){if(t&1&&(a(0,"blockquote",7),o(1),n()),t&2){let e=c(2);r(),f(" ",e.alarm.shelveInfo.shelveMessage," ")}}function ma(t,i){if(t&1&&(a(0,"div",0),o(1,"Shelve expiration"),n(),a(2,"div",1),o(3),v(4,"datetime"),n()),t&2){let e=c(2);r(3),f(" ",h(4,1,e.alarm.shelveInfo.shelveExpiration)," ")}}function ca(t,i){if(t&1&&(u(0,"br")(1,"mat-divider"),a(2,"div",0),o(3),n(),a(4,"div",1),o(5),v(6,"datetime"),p(7,ra,2,1,"blockquote",7),n(),p(8,ma,5,3)),t&2){let e=c();r(3),f("Shelved by ",e.alarm.shelveInfo.shelvedBy,""),r(2),f(" On ",h(6,4,e.alarm.shelveInfo.shelveTime)," "),r(2),s(e.alarm.shelveInfo.shelveMessage?7:-1),r(),s(e.alarm.shelveInfo.shelveExpiration?8:-1)}}function sa(t,i){if(t&1){let e=b();a(0,"ya-button",12),S("click",function(){x(e);let m=c(2);return g(m.acknowledgeAlarm.emit(m.alarm))}),o(1," ACKNOWLEDGE "),n()}}function pa(t,i){if(t&1){let e=b();a(0,"ya-button",13),S("click",function(){x(e);let m=c(2);return g(m.shelveAlarm.emit(m.alarm))}),o(1,"SHELVE"),n()}}function da(t,i){if(t&1){let e=b();a(0,"ya-button",14),S("click",function(){x(e);let m=c(2);return g(m.unshelveAlarm.emit(m.alarm))}),o(1,"UNSHELVE"),n()}}function _a(t,i){if(t&1){let e=b();a(0,"div",3),p(1,sa,2,0,"ya-button",8)(2,pa,2,0,"ya-button",9)(3,da,2,0,"ya-button",10),a(4,"ya-button",11),S("click",function(){x(e);let m=c();return g(m.clearAlarm.emit(m.alarm))}),o(5,"CLEAR"),n()()}if(t&2){let e=c();r(),s(!e.alarm.shelveInfo&&!e.alarm.acknowledged?1:-1),r(),s(e.alarm.shelveInfo?-1:2),r(),s(e.alarm.shelveInfo?3:-1)}}var Ye=class t{constructor(i){this.yamcs=i;this.mayControl=!1;this.acknowledgeAlarm=new B;this.shelveAlarm=new B;this.unshelveAlarm=new B;this.clearAlarm=new B}static{this.\u0275fac=function(e){return new(e||t)(C(k))}}static{this.\u0275cmp=w({type:t,selectors:[["app-alarm-detail"]],inputs:{alarm:"alarm",mayControl:"mayControl"},outputs:{acknowledgeAlarm:"acknowledgeAlarm",shelveAlarm:"shelveAlarm",unshelveAlarm:"unshelveAlarm",clearAlarm:"clearAlarm"},standalone:!0,features:[D],decls:17,vars:12,consts:[[1,"block-title"],[1,"block"],[3,"level"],[1,"action-bar"],[1,"ya-link",3,"routerLink","queryParams"],[3,"level","grayscale"],[3,"pval"],[2,"border-left","4px solid #eee","padding-left","1em","font-style","italic"],["icon","notifications_off"],["icon","timer"],["icon","timer_off"],["icon","clear_all",3,"click"],["icon","notifications_off",3,"click"],["icon","timer",3,"click"],["icon","timer_off",3,"click"]],template:function(e,l){if(e&1&&(p(0,Ki,5,6)(1,Xi,5,1),a(2,"div",0),o(3,"Severity"),n(),a(4,"div",1),u(5,"app-alarm-level",2),o(6),n(),a(7,"div",0),o(8,"Violations"),n(),a(9,"div",1),o(10),v(11,"number"),n(),p(12,aa,21,15)(13,na,6,1)(14,la,8,5)(15,ca,9,6)(16,_a,6,3,"div",3)),e&2){let m,d;s(l.alarm.type==="PARAMETER"?0:-1),r(),s(l.alarm.type==="EVENT"?1:-1),r(4),_("level",l.alarm.severity),r(),f(" ",l.alarm.severity,`
`),r(4),f(" ",h(11,10,l.alarm.violations),`
`),r(2),s((m=l.alarm.parameterDetail)?12:-1,m),r(),s((d=l.alarm.eventDetail)?13:-1,d),r(),s(l.alarm.acknowledgeInfo?14:-1),r(),s(l.alarm.shelveInfo?15:-1),r(),s(l.mayControl?16:-1)}},dependencies:[ve,I,Z,U,ut,P,St,W,ue],encapsulation:2,changeDetection:0})}};function ua(t,i){t&1&&(a(0,"mat-icon",0),o(1,"timer"),n())}function fa(t,i){t&1&&(a(0,"mat-icon",1),o(1,"check_circle"),n())}function Ca(t,i){if(t&1&&(a(0,"mat-icon",5),v(1,"async"),o(2," notifications "),n()),t&2){let e=c(2);Ke("visibility",h(1,2,e.visibility$)?"visible":"hidden")}}function va(t,i){t&1&&(a(0,"mat-icon",3),o(1,"check_circle_outline"),n())}function ha(t,i){if(t&1&&(a(0,"mat-icon",6),v(1,"async"),o(2," notifications_none "),n()),t&2){let e=c(2);Ke("visibility",h(1,2,e.visibility$)?"visible":"hidden")}}function xa(t,i){if(t&1&&p(0,fa,2,0,"mat-icon",1)(1,Ca,3,4,"mat-icon",2)(2,va,2,0,"mat-icon",3)(3,ha,3,4,"mat-icon",4),t&2){let e=c();s(!e.alarm.processOK&&e.alarm.acknowledged?0:-1),r(),s(!e.alarm.processOK&&!e.alarm.acknowledged?1:-1),r(),s(e.alarm.processOK&&e.alarm.acknowledged?2:-1),r(),s(e.alarm.processOK&&!e.alarm.acknowledged?3:-1)}}var Ue=class t{constructor(i){this.visibility$=new G(!0);this.syncSubscription=i.syncFast(()=>{this.visibility$.next(!this.visibility$.value)})}ngOnDestroy(){this.syncSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||t)(C(Et))}}static{this.\u0275cmp=w({type:t,selectors:[["app-alarm-state-icon"]],inputs:{alarm:"alarm"},standalone:!0,features:[D],decls:2,vars:1,consts:[["matTooltip","Shelved"],["matTooltip","Active, acknowledged"],["matTooltip","Active, unacknowledged",3,"visibility"],["matTooltip","RTN, acknowledged"],["matTooltip","RTN, unacknowledged",3,"visibility"],["matTooltip","Active, unacknowledged"],["matTooltip","RTN, unacknowledged"]],template:function(e,l){e&1&&p(0,ua,2,0,"mat-icon",0)(1,xa,4,4),e&2&&s(l.alarm.shelveInfo?0:1)},dependencies:[I,ye,j,ie],encapsulation:2})}};var tt=t=>({c:t});function ga(t,i){t&1&&(a(0,"th",20),o(1,"Alarm type"),n())}function Sa(t,i){t&1&&(a(0,"mat-icon",22),o(1,"event_note"),n())}function Aa(t,i){t&1&&(a(0,"mat-icon",22),o(1,"toll"),n())}function ya(t,i){if(t&1&&(a(0,"td",21),p(1,Sa,2,0,"mat-icon",22)(2,Aa,2,0,"mat-icon",22),o(3),v(4,"titlecase"),n()),t&2){let e=i.$implicit;r(),s(e.type==="EVENT"?1:-1),r(),s(e.type==="PARAMETER"?2:-1),r(),f(" ",h(4,3,e.type||"-")," ")}}function Ta(t,i){t&1&&(a(0,"th",20),o(1,"Alarm name"),n())}function ba(t,i){if(t&1&&(a(0,"a",23),o(1),n()),t&2){let e=c(2).$implicit,l=c();_("routerLink","/telemetry/parameters"+e.id.namespace+"/"+e.id.name)("queryParams",V(4,tt,l.yamcs.context)),r(),O(" ",e.id.namespace,"/",e.id.name," ")}}function wa(t,i){if(t&1&&o(0),t&2){let e=c(2).$implicit;O(" ",e.id.namespace,"/",e.id.name," ")}}function Da(t,i){if(t&1&&p(0,ba,2,6,"a",23)(1,wa,1,2),t&2){let e=c().$implicit;s(e.parameterDetail?0:1)}}function Ia(t,i){if(t&1&&(a(0,"a",23),o(1),n()),t&2){let e=c(2).$implicit,l=c();_("routerLink","/telemetry/parameters"+e.id.namespace)("queryParams",V(3,tt,l.yamcs.context)),r(),f(" ",e.id.namespace," ")}}function Ea(t,i){if(t&1&&o(0),t&2){let e=c(2).$implicit;f(" ",e.id.namespace," ")}}function ka(t,i){if(t&1&&p(0,Ia,2,5,"a",23)(1,Ea,1,1),t&2){let e=c().$implicit;s(e.parameterDetail?0:1)}}function Ma(t,i){if(t&1&&(a(0,"a",23),o(1),n()),t&2){let e=c(2).$implicit,l=c();_("routerLink","/telemetry/parameters"+e.id.name)("queryParams",V(3,tt,l.yamcs.context)),r(),f(" ",e.id.name," ")}}function Va(t,i){if(t&1&&o(0),t&2){let e=c(2).$implicit;f(" ",e.id.name," ")}}function Oa(t,i){if(t&1&&p(0,Ma,2,5,"a",23)(1,Va,1,1),t&2){let e=c().$implicit;s(e.parameterDetail?0:1)}}function La(t,i){if(t&1&&(a(0,"td",21),p(1,Da,2,1)(2,ka,2,1)(3,Oa,2,1),n()),t&2){let e=i.$implicit;r(),s(e.id.namespace&&e.id.name?1:-1),r(),s(e.id.namespace&&!e.id.name?2:-1),r(),s(!e.id.namespace&&e.id.name?3:-1)}}function Ha(t,i){t&1&&(a(0,"th",24),o(1,"State"),n())}function Na(t,i){if(t&1&&(a(0,"td",25),u(1,"app-alarm-state-icon",26),n()),t&2){let e=i.$implicit;r(),_("alarm",e)}}function Fa(t,i){t&1&&(a(0,"th",20),o(1,"Alarm time"),n())}function $a(t,i){if(t&1&&(a(0,"td",21)(1,"span",27),v(2,"datetime"),u(3,"app-ago",28),n()()),t&2){let e=i.$implicit;r(),_("matTooltip",h(2,2,e.triggerTime)),r(2),_("time",e.triggerTime)}}function Pa(t,i){t&1&&(a(0,"th",24),o(1,"Severity"),n())}function Ra(t,i){if(t&1&&(a(0,"td",25),u(1,"app-alarm-level",29),n()),t&2){let e=i.$implicit;r(),_("level",e.severity)}}function Ga(t,i){t&1&&(a(0,"th",20),o(1,"Trip value"),n())}function Ba(t,i){t&1&&(a(0,"span"),o(1,"\u2193"),n())}function Ya(t,i){t&1&&(a(0,"span"),o(1,"\u2191"),n())}function Ua(t,i){if(t&1&&(o(0),v(1,"value"),p(2,Ba,2,0,"span")(3,Ya,2,0,"span")),t&2){let e=i;f(" ",h(1,3,e.triggerValue.engValue)," "),r(2),s(e.triggerValue.rangeCondition==="LOW"?2:-1),r(),s(e.triggerValue.rangeCondition==="HIGH"?3:-1)}}function ja(t,i){t&1&&o(0),t&2&&f(" ",i.triggerEvent.message||"-"," ")}function qa(t,i){if(t&1&&(a(0,"td",30),p(1,Ua,4,5)(2,ja,1,1),n()),t&2){let e,l,m=i.$implicit;r(),s((e=m.parameterDetail)?1:-1,e),r(),s((l=m.eventDetail)?2:-1,l)}}function Wa(t,i){t&1&&(a(0,"th",20),o(1,"Live value"),n())}function za(t,i){t&1&&(a(0,"span"),o(1,"\u2193"),n())}function Ka(t,i){t&1&&(a(0,"span"),o(1,"\u2191"),n())}function Ja(t,i){if(t&1&&(o(0),v(1,"value"),p(2,za,2,0,"span")(3,Ka,2,0,"span")),t&2){let e=i;f(" ",h(1,3,e.currentValue.engValue)," "),r(2),s(e.currentValue.rangeCondition==="LOW"?2:-1),r(),s(e.currentValue.rangeCondition==="HIGH"?3:-1)}}function Qa(t,i){t&1&&o(0),t&2&&f(" ",i.triggerEvent.message||"-"," ")}function Xa(t,i){if(t&1&&(a(0,"td",30),p(1,Ja,4,5)(2,Qa,1,1),n()),t&2){let e,l,m=i.$implicit;r(),s((e=m.parameterDetail)?1:-1,e),r(),s((l=m.eventDetail)?2:-1,l)}}function Za(t,i){t&1&&(a(0,"th",20),o(1,"Violations"),n())}function en(t,i){if(t&1&&(a(0,"td",31),o(1),v(2,"number"),v(3,"number"),n()),t&2){let e=i.$implicit;r(),O(" ",h(2,2,e.violations)," (",Ae(3,4,e.violations/e.count*100,"1.2-2"),"%) ")}}function tn(t,i){t&1&&u(0,"th",32)}function an(t,i){if(t&1){let e=b();a(0,"ya-more")(1,"button",33),S("click",function(){x(e);let m=c().$implicit,d=c();return g(d.acknowledgeAlarm.emit(m))}),o(2," Acknowledge... "),n(),a(3,"button",33),S("click",function(){x(e);let m=c().$implicit,d=c();return g(d.shelveAlarm.emit(m))}),o(4," Shelve... "),n(),a(5,"button",33),S("click",function(){x(e);let m=c().$implicit,d=c();return g(d.unshelveAlarm.emit(m))}),o(6," Unshelve "),n()()}if(t&2){let e=c().$implicit;r(),_("disabled",e.shelveInfo||e.acknowledged),r(2),_("disabled",e.shelveInfo),r(2),_("disabled",!e.shelveInfo)}}function nn(t,i){if(t&1&&(a(0,"td",21),p(1,an,7,3,"ya-more"),n()),t&2){let e=c();r(),s(e.mayControl?1:-1)}}function on(t,i){t&1&&u(0,"tr",34)}function ln(t,i){if(t&1){let e=b();a(0,"tr",35),S("click",function(){let m=x(e).$implicit,d=c();return g(d.toggleOne(m))}),n()}if(t&2){let e=i.$implicit,l=c();Je("selected",l.selection.isSelected(e))("hide",l.hideAlarm(e))}}function rn(t,i){t&1&&o(0,"-")}var je=class t{constructor(i){this.yamcs=i;this.displayedColumns=["state","severity","time","alarm","type","trip_value","live_value","actions"];this.view="standard";this.mayControl=!1;this.acknowledgeAlarm=new B;this.shelveAlarm=new B;this.unshelveAlarm=new B;this.tableTrackerFn=(i,e)=>`${e.triggerTime}__${e.id.namespace}__${e.id.name}__${e.seqNum}`}toggleOne(i){(!this.selection.isSelected(i)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(i)}hideAlarm(i){if(this.view==="standard")return!!i.shelveInfo;if(this.view==="all")return!1;if(this.view==="unacknowledged")return!!i.shelveInfo||i.acknowledged;if(this.view==="acknowledged")return!!i.shelveInfo||!i.acknowledged;if(this.view==="shelved")return!i.shelveInfo}static{this.\u0275fac=function(e){return new(e||t)(C(k))}}static{this.\u0275cmp=w({type:t,selectors:[["app-alarms-table"]],inputs:{dataSource:"dataSource",selection:"selection",view:"view",mayControl:"mayControl"},outputs:{acknowledgeAlarm:"acknowledgeAlarm",shelveAlarm:"shelveAlarm",unshelveAlarm:"unshelveAlarm"},standalone:!0,features:[D],decls:32,vars:6,consts:[["dash",""],["mat-table","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["matColumnDef","type"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","alarm"],["matColumnDef","state"],["mat-header-cell","","class","status",4,"matHeaderCellDef"],["mat-cell","","class","status",4,"matCellDef"],["matColumnDef","time"],["matColumnDef","severity"],["matColumnDef","trip_value"],["mat-cell","","class","wrap200",4,"matCellDef"],["matColumnDef","live_value"],["matColumnDef","violations"],["mat-cell","","style","text-align: right",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","style","width: 100%",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","hide","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[2,"vertical-align","middle"],[3,"routerLink","queryParams"],["mat-header-cell","",1,"status"],["mat-cell","",1,"status"],[3,"alarm"],[3,"matTooltip"],[3,"time"],[3,"level"],["mat-cell","",1,"wrap200"],["mat-cell","",2,"text-align","right"],["mat-header-cell","",2,"width","100%"],["mat-menu-item","",3,"click","disabled"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,l){e&1&&(a(0,"table",1),A(1,2),p(2,ga,2,0,"th",3)(3,ya,5,5,"td",4),y(),A(4,5),p(5,Ta,2,0,"th",3)(6,La,4,3,"td",4),y(),A(7,6),p(8,Ha,2,0,"th",7)(9,Na,2,1,"td",8),y(),A(10,9),p(11,Fa,2,0,"th",3)(12,$a,4,4,"td",4),y(),A(13,10),p(14,Pa,2,0,"th",7)(15,Ra,2,1,"td",8),y(),A(16,11),p(17,Ga,2,0,"th",3)(18,qa,3,2,"td",12),y(),A(19,13),p(20,Wa,2,0,"th",3)(21,Xa,3,2,"td",12),y(),A(22,14),p(23,Za,2,0,"th",3)(24,en,4,7,"td",15),y(),A(25,16),p(26,tn,1,0,"th",17)(27,nn,2,1,"td",4),y(),p(28,on,1,0,"tr",18)(29,ln,1,4,"tr",19),n(),p(30,rn,1,0,"ng-template",null,0,rt)),e&2&&(Je("hide",l.dataSource.isEmpty()),_("dataSource",l.dataSource)("trackBy",l.tableTrackerFn),r(28),_("matHeaderRowDef",l.displayedColumns),r(),_("matRowDefColumns",l.displayedColumns))},dependencies:[Nt,ve,Ue,I,Z,Te,U,j,dt,ae,oe,ce,le,ne,se,re,me,pe,de,ie,Tt,W,ue],styles:[".hide[_ngcontent-%COMP%]{display:none}"]})}};var qe=class extends pt{constructor(e){super();this.yamcs=e;this.alarms$=new G([]);this.filteredAlarms$=new G([]);this.loading$=new G(!1);this.alarmsByName={};this.filter=null;this.unacknowledgedAlarms$=this.alarms$.pipe(ge(l=>l.filter(m=>!m.shelveInfo&&!m.acknowledged))),this.acknowledgedAlarms$=this.alarms$.pipe(ge(l=>l.filter(m=>!m.shelveInfo&&m.acknowledged))),this.shelvedAlarms$=this.alarms$.pipe(ge(l=>l.filter(m=>!!m.shelveInfo)))}connect(){return this.filteredAlarms$}setFilter(e){this.filter=e||null}loadAlarms(){this.loading$.next(!0),this.yamcs.yamcsClient.getActiveAlarms(this.yamcs.instance,this.yamcs.processor).then(e=>{this.loading$.next(!1);for(let l of e)this.processAlarm(l);this.updateSubject()}),this.alarmSubscription=this.yamcs.yamcsClient.createAlarmSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor},e=>{this.processAlarm(e),this.updateSubject()})}updateSubject(){let l=[...Object.values(this.alarmsByName).sort((m,d)=>{let M=m.acknowledged===d.acknowledged?0:m.acknowledged?1:-1;if(M===0){let R=this.getNumericSeverity(m.severity),E=this.getNumericSeverity(d.severity);M=R===E?0:R<E?1:-1}if(M===0){let R=m.id.namespace+"/"+m.id.name,E=d.id.namespace+"/"+d.id.name;M=R.localeCompare(E)}return M})];if(this.alarms$.next(l),this.filter){let m=l.filter(d=>(d.id.namespace+"/"+d.id.name).toLowerCase().indexOf(this.filter)!==-1);this.filteredAlarms$.next(m)}else this.filteredAlarms$.next(l)}getNumericSeverity(e){switch(e){case"WATCH":return 0;case"WARNING":return 1;case"DISTRESS":return 2;case"CRITICAL":return 3;case"SEVERE":return 4;default:return 5}}disconnect(){this.alarms$.complete(),this.filteredAlarms$.complete(),this.loading$.complete(),this.alarmSubscription&&this.alarmSubscription.cancel()}isEmpty(){return!this.filteredAlarms$.getValue().length}processAlarm(e){let l=e.id.namespace+"/"+e.id.name;e.processOK&&!e.triggered&&e.acknowledged?delete this.alarmsByName[l]:this.alarmsByName[l]=e}};function mn(t,i){if(t&1&&o(0),t&2){let e=c(2);f(" /",e.data.alarms[0].id.name," ")}}function cn(t,i){if(t&1&&(o(0),p(1,mn,1,1)),t&2){let e=c();f(" ",e.data.alarms[0].id.namespace," "),r(),s(e.data.alarms[0].id.name?1:-1)}}function sn(t,i){if(t&1&&o(0),t&2){let e=c();f(" ",e.data.alarms.length," selected alarms. ")}}var We=class t{constructor(i,e,l,m){this.dialogRef=i;this.yamcs=l;this.data=m;this.durationOptions=[{id:"PT15M",label:"15 minutes"},{id:"PT30M",label:"30 minutes"},{id:"PT1H",label:"1 hour"},{id:"PT2H",label:"2 hours"},{id:"P1D",label:"1 day"},{id:"UNLIMITED",label:"unlimited"}];this.formGroup=e.group({duration:"PT2H",comment:void 0})}async shelve(){let i=this.data.alarms,e=this.formGroup.get("comment").value,l=null;if(this.formGroup.get("duration").value!=="UNLIMITED"){let m=this.formGroup.get("duration").value;l=T.convertDurationToMillis(m)}for(let m of i){let d={};e&&(d.comment=e),l&&(d.shelveDuration=l);let M=m.id.namespace+(m.id.name?"/"+m.id.name:"");this.yamcs.yamcsClient.shelveAlarm(this.yamcs.instance,this.yamcs.processor,M,m.seqNum,d)}this.dialogRef.close()}static{this.\u0275fac=function(e){return new(e||t)(C(ke),C(Ee),C(k),C(Me))}}static{this.\u0275cmp=w({type:t,selectors:[["app-shelve-alarm-dialog"]],standalone:!0,features:[D],decls:20,vars:5,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["formControlName","duration",3,"options"],["formControlName","comment","rows","5",2,"resize","none"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,l){e&1&&(a(0,"h2",0),o(1,"Shelve"),n(),a(2,"mat-dialog-content")(3,"p"),p(4,cn,2,2)(5,sn,1,1),n(),a(6,"form",1)(7,"label"),o(8," Duration "),u(9,"br")(10,"ya-select",2),n(),u(11,"br"),a(12,"label"),o(13," Comment "),u(14,"textarea",3),n()()(),a(15,"mat-dialog-actions",4)(16,"ya-button",5),o(17,"CANCEL"),n(),a(18,"ya-button",6),S("click",function(){return l.shelve()}),o(19,"OK"),n()()),e&2&&(r(4),s(l.data.alarms.length===1?4:-1),r(),s(l.data.alarms.length!==1?5:-1),r(),_("formGroup",l.formGroup),r(4),_("options",l.durationOptions),r(8),_("disabled",!l.formGroup.valid))},dependencies:[I,N,we,L,H,F,$,Ve,Oe,He,Le,P,q],encapsulation:2,changeDetection:0})}};function pn(t,i){if(t&1){let e=b();a(0,"ya-page-button",7),S("click",function(){x(e);let m=c();return g(m.acknowledgeAlarms(m.selection.selected))}),o(1," Acknowledge "),n()}if(t&2){let e=c();_("disabled",!e.selection.hasValue())}}function dn(t,i){if(t&1){let e=b();a(0,"ya-page-button",8),S("click",function(){x(e);let m=c();return g(m.shelveAlarms(m.selection.selected))}),o(1," Shelve "),n()}if(t&2){let e=c();_("disabled",!e.selection.hasValue())}}function _n(t,i){if(t&1){let e=b();a(0,"ya-detail-toolbar"),o(1,"Alarm Detail"),n(),a(2,"div",9)(3,"app-alarm-detail",10),S("acknowledgeAlarm",function(m){x(e);let d=c();return g(d.acknowledgeAlarms([m]))})("shelveAlarm",function(m){x(e);let d=c();return g(d.shelveAlarms([m]))})("unshelveAlarm",function(m){x(e);let d=c();return g(d.unshelveAlarms([m]))})("clearAlarm",function(m){x(e);let d=c();return g(d.clearAlarms([m]))}),n()()}if(t&2){let e=c();r(3),_("alarm",i)("mayControl",e.mayControlAlarms())}}function un(t,i){t&1&&(a(0,"ya-detail-toolbar"),o(1,"Select an alarm"),n())}function fn(t,i){if(t&1){let e=b();a(0,"div",6),u(1,"app-alarms-page-tabs"),a(2,"dl",11)(3,"dt"),o(4,"Unacknowledged alarms:"),n(),a(5,"dd")(6,"strong"),o(7),v(8,"async"),n()(),a(9,"dt"),o(10,"Acknowledged alarms:"),n(),a(11,"dd")(12,"strong"),o(13),v(14,"async"),n()(),a(15,"dt"),o(16,"Shelved alarms:"),n(),a(17,"dd")(18,"strong"),o(19),v(20,"async"),n()()(),a(21,"form",12)(22,"div",13),u(23,"ya-search-filter",14)(24,"ya-select",15),n()(),a(25,"app-alarms-table",16),v(26,"async"),S("acknowledgeAlarm",function(m){x(e);let d=c();return g(d.acknowledgeAlarms([m]))})("shelveAlarm",function(m){x(e);let d=c();return g(d.shelveAlarms([m]))})("unshelveAlarm",function(m){x(e);let d=c();return g(d.unshelveAlarms([m]))}),n()()}if(t&2){let e,l,m,d=c();r(7),Y((e=h(8,9,d.dataSource.unacknowledgedAlarms$))==null?null:e.length),r(6),Y((l=h(14,11,d.dataSource.acknowledgedAlarms$))==null?null:l.length),r(6),Y((m=h(20,13,d.dataSource.shelvedAlarms$))==null?null:m.length),r(2),_("formGroup",d.filterForm),r(3),_("options",d.viewOptions),r(),_("dataSource",d.dataSource)("selection",d.selection)("view",h(26,15,d.view$))("mayControl",d.mayControlAlarms())}}var ze=class t{constructor(i,e,l,m,d,M,R){this.yamcs=i;this.route=e;this.router=l;this.dialog=d;this.authService=M;this.messageService=R;this.filterForm=new De({filter:new X,view:new X("standard")});this.detailAlarm$=new G(null);this.selection=new kt((i,e)=>`${e.triggerTime}__${e.id.namespace}__${e.id.name}__${e.seqNum}`,!1,[]);this.viewOptions=[{id:"standard",label:"Standard view (ack & unack)"},{id:"unacknowledged",label:"Unacknowledged alarms"},{id:"acknowledged",label:"Acknowledged alarms"},{id:"shelved",label:"Shelved alarms"},{id:"all",label:"All alarms"}];this.view$=new G("standard");m.setTitle("Alarms"),this.selectionSubscription=this.selection.changed.subscribe(()=>{let E=this.selection.selected;E.length===1?this.detailAlarm$.next(E[0]):this.detailAlarm$.next(null)}),this.dataSource=new qe(this.yamcs),this.dataSource.loadAlarms(),this.alarmsSubscription=this.dataSource.alarms$.subscribe(E=>{this.selection.matchNewValues(E);let it=this.detailAlarm$.value;if(it){for(let at of E)if(this.isSameAlarm(at,it)){this.detailAlarm$.next(at);break}}}),this.initializeOptions(),this.filterForm.get("filter").valueChanges.pipe(nt(400)).forEach(E=>{this.filter=E,this.updateURL(),this.dataSource.setFilter(E)}),this.filterForm.get("view").valueChanges.forEach(E=>{this.view$.next(E),this.updateURL(),this.selection.clear()})}initializeOptions(){let i=this.route.snapshot.queryParamMap;if(i.has("filter")&&(this.filter=i.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),i.has("view")){let e=i.get("view");this.view$.next(e),this.filterForm.get("view").setValue(e)}}isSameAlarm(i,e){return i.seqNum===e.seqNum&&i.id.namespace===e.id.namespace&&i.id.name===e.id.name&&i.triggerTime===e.triggerTime}acknowledgeAlarms(i){this.dialog.open(Be,{width:"400px",data:{alarms:i}}).afterClosed().subscribe(()=>this.selection.clear())}shelveAlarms(i){this.dialog.open(We,{width:"400px",data:{alarms:i}}).afterClosed().subscribe(()=>this.selection.clear())}unshelveAlarms(i){for(let e of i){let l=e.id.namespace+(e.id.name?"/"+e.id.name:"");this.yamcs.yamcsClient.unshelveAlarm(this.yamcs.instance,this.yamcs.processor,l,e.seqNum).then(()=>this.selection.clear()).catch(m=>this.messageService.showError(m))}}clearAlarms(i){for(let e of i){let l=e.id.namespace+(e.id.name?"/"+e.id.name:"");this.yamcs.yamcsClient.clearAlarm(this.yamcs.instance,this.yamcs.processor,l,e.seqNum,{})}}mayControlAlarms(){return this.authService.getUser().hasSystemPrivilege("ControlAlarms")}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filter||null,view:this.view$.value||null},queryParamsHandling:"merge"})}ngOnDestroy(){this.selectionSubscription?.unsubscribe(),this.alarmsSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||t)(C(k),C(ee),C(te),C(be),C(ft),C(Mt),C(_e))}}static{this.\u0275cmp=w({type:t,selectors:[["ng-component"]],standalone:!0,features:[D],decls:45,vars:6,consts:[[1,"ya-data-table"],["width","1"],[1,"icon16",2,"vertical-align","middle"],["icon","notifications_off",3,"disabled"],["icon","timer",3,"disabled"],[1,"table-wrapper"],[1,"panel-content"],["icon","notifications_off",3,"click","disabled"],["icon","timer",3,"click","disabled"],[2,"padding","0 16px"],[3,"acknowledgeAlarm","shelveAlarm","unshelveAlarm","clearAlarm","alarm","mayControl"],[1,"dl-horizontal"],[3,"formGroup"],[1,"filter-bar"],["formControlName","filter","placeholder","Filter by text search"],["formControlName","view",3,"options"],[3,"acknowledgeAlarm","shelveAlarm","unshelveAlarm","dataSource","selection","view","mayControl"]],template:function(e,l){if(e&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),o(2," Alarms "),a(3,"ya-help"),o(4," An alarm can be in these states: "),a(5,"table",0)(6,"tr")(7,"td",1)(8,"mat-icon",2),o(9,"notifications"),n()(),a(10,"td"),o(11,"The alarm is unacknowledged and the cause of the alarm still exists."),n()(),a(12,"tr")(13,"td")(14,"mat-icon",2),o(15,"notifications_none"),n()(),a(16,"td"),o(17," The alarm is unacknowledged and the cause that generated the alarm no longer exists. "),n()(),a(18,"tr")(19,"td")(20,"mat-icon",2),o(21,"check_circle"),n()(),a(22,"td"),o(23,"The alarm is acknowledged and the cause of the alarm still exists."),n()(),a(24,"tr")(25,"td")(26,"mat-icon",2),o(27,"check_circle_outline"),n()(),a(28,"td"),o(29," The alarm is acknowledged and the cause that generated the alarm no longer exists. "),n()(),a(30,"tr")(31,"td")(32,"mat-icon",2),o(33,"timer"),n()(),a(34,"td"),o(35,"The alarm was shelved."),n()()()(),o(36," \xA0\xA0\xA0 "),p(37,pn,2,1,"ya-page-button",3)(38,dn,2,1,"ya-page-button",4),n(),a(39,"ya-detail-pane"),p(40,_n,4,2),v(41,"async"),p(42,un,2,0,"ya-detail-toolbar"),n(),a(43,"div",5),p(44,fn,27,17,"div",6),n()()),e&2){let m;r(37),s(l.mayControlAlarms()?37:-1),r(),s(l.mayControlAlarms()?38:-1),r(2),s((m=h(41,4,l.detailAlarm$))?40:42,m),r(4),s(l.dataSource?44:-1)}},dependencies:[Ye,z,je,Ce,fe,I,ye,N,L,H,F,$,j,xt,gt,yt,bt,wt,q],styles:[".detail[_ngcontent-%COMP%]{background-color:#fcfcfc;float:right;height:100%;width:450px;overflow:auto;border-left:1px solid #d3d3d3;box-sizing:border-box}.table-wrapper[_ngcontent-%COMP%]{position:relative;overflow:auto;height:100%}mat-row[_ngcontent-%COMP%]{cursor:pointer}mat-row[_ngcontent-%COMP%]:hover{background:#fafafa}"],changeDetection:0})}};var hl=[{path:"",canActivate:[Ot,Vt],canActivateChild:[Lt],runGuardsAndResolvers:"always",component:Ht,children:[{path:"",pathMatch:"full",component:ze},{path:"history",component:Re},{path:"log",component:$e}]}];export{hl as ROUTES};
