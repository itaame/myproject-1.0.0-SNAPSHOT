import{b as Te,d as we,e as Bt,f as Ut}from"./chunk-WVE4Y3TR.js";import{$ as Je,$a as rt,$b as ut,A as $e,Aa as nt,Ae as Ft,Af as jt,B as he,Ba as $,Bb as re,Ca as r,Da as oe,Db as w,E as _,Ea as N,Ed as B,Fb as L,Fd as W,Gb as k,Gd as Ce,Hb as se,Hd as H,Ia as E,Ib as pt,Id as U,Ie as Y,J as x,Ja as ot,Jb as h,Jd as z,K as D,Ka as je,Kb as te,Kd as J,Ke as Nt,Lb as A,Le as Rt,Na as at,Nd as le,Oa as g,Ob as dt,Pa as C,Pb as P,Pe as S,Pf as Gt,Q as G,Qe as Lt,Sb as V,Se as ce,Td as gt,Ud as Ct,Ve as kt,Wd as St,We as At,X as c,Xd as _t,Y as u,Ye as K,Zd as Et,Ze as q,a as Ye,aa as v,b as qe,ca as p,cb as ae,cf as me,dc as vt,e as O,ea as Q,ga as y,gc as ft,ge as Se,ha as Ke,he as bt,hf as Pt,ia as Xe,ie as xt,ja as Ze,ka as o,ke as Dt,la as a,le as _e,lg as T,ma as l,mb as st,na as M,ne as Ee,oa as I,oc as ht,oe as Tt,of as X,og as Qt,qa as F,qb as lt,qe as wt,qf as Vt,ra as f,rb as ct,re as be,rf as Z,rg as b,sa as d,sb as ye,sd as ve,sf as Yt,sg as De,ta as et,tb as ge,tc as yt,te as xe,tf as qt,tg as Wt,ua as tt,ub as mt,ue as Mt,ug as Ht,wf as $t,y as ze,ye as It,za as it,ze as Ot}from"./chunk-SAZ6MTOG.js";var Be=(i,t)=>he(Ge).canActivate(i,t);var Ge=class i{constructor(t,e){this.authService=t;this.router=e}canActivate(t,e){return this.authService.getUser().hasSystemPrivilege("ReadEvents")?!0:(this.router.navigate(["/403"],{queryParams:{page:e.url}}),!1)}canActivateChild(t,e){return this.canActivate(t,e)}static{this.\u0275fac=function(e){return new(e||i)($e(De),$e(ye))}}static{this.\u0275prov=ze({token:i,factory:i.\u0275fac,providedIn:"root"})}};var Me=class i{constructor(t,e,n,s){this.dialogRef=t;this.yamcs=n;this.data=s;this.severityOptions=[{id:"INFO",label:"INFO"},{id:"WATCH",label:"WATCH"},{id:"WARNING",label:"WARNING"},{id:"DISTRESS",label:"DISTRESS"},{id:"CRITICAL",label:"CRITICAL"},{id:"SEVERE",label:"SEVERE"}];this.form=e.group({message:["",w.required],severity:"INFO",time:[S.toISOString(n.getMissionTime()),w.required]})}save(){this.yamcs.yamcsClient.createEvent(this.yamcs.instance,{message:this.form.value.message,severity:this.form.value.severity,time:S.toISOString(this.form.value.time)}).then(t=>this.dialogRef.close(t))}static{this.\u0275fac=function(e){return new(e||i)(u(B),u(ut),u(T),u(W))}}static{this.\u0275cmp=_({type:i,selectors:[["app-create-event-dialog"]],standalone:!0,features:[E],decls:21,vars:3,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["formControlName","message","rows","3"],["formControlName","severity",3,"options"],["formControlName","time","step","1"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,n){e&1&&(o(0,"h2",0),r(1,"Create event"),a(),o(2,"mat-dialog-content")(3,"form",1)(4,"label"),r(5," Message "),l(6,"textarea",2),a(),l(7,"br"),o(8,"label"),r(9," Severity "),l(10,"br")(11,"ya-select",3),a(),l(12,"br"),o(13,"label"),r(14," Event time "),l(15,"ya-date-time-input",4),a()()(),o(16,"mat-dialog-actions",5)(17,"ya-button",6),r(18,"CANCEL"),a(),o(19,"ya-button",7),f("click",function(){return n.save()}),r(20,"SAVE"),a()()),e&2&&(c(3),p("formGroup",n.form),c(8),p("options",n.severityOptions),c(8),p("disabled",!n.form.valid))},dependencies:[b,A,re,L,k,P,V,H,U,J,z,Y,ce,q],encapsulation:2,changeDetection:0})}};var zt="INFO",Jt=[],Oe=class i{constructor(t,e,n,s){this.dialogRef=t;this.yamcs=e;this.messageService=n;this.data=s;this.form=new se({name:new h("",w.required),filter:new h(""),severity:new h(zt,w.required),source:new h(Jt),shared:new h(!1,w.required)});this.form.patchValue({filter:s.filter||void 0,severity:s.severity,source:s.source})}save(){let{value:t}=this.form;this.yamcs.yamcsClient.createQuery(this.yamcs.instance,"events",{name:t.name,shared:t.shared??!1,query:{filter:t.filter??void 0,source:t.source??Jt,severity:t.severity??zt}}).then(e=>this.dialogRef.close(e)).catch(e=>this.messageService.showError(e))}static{this.\u0275fac=function(e){return new(e||i)(u(B),u(T),u(X),u(W))}}static{this.\u0275cmp=_({type:i,selectors:[["app-create-event-query-dialog"]],standalone:!0,features:[E],decls:37,vars:3,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],[1,"label"],["formControlName","name","type","text"],[1,"half-break"],["formControlName","filter"],["formControlName","severity"],["id","INFO","label","Info level"],["id","WATCH","label","Watch level"],["id","WARNING","label","Warning level"],["id","DISTRESS","label","Distress level"],["id","CRITICAL","label","Critical level"],["id","SEVERE","label","Severe level"],["formControlName","source","emptyOption","Any source",3,"options"],["formControlName","shared"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,n){e&1&&(o(0,"h2",0),r(1,"Save query"),a(),o(2,"mat-dialog-content")(3,"form",1)(4,"div",2),r(5," Name "),l(6,"input",3),a(),l(7,"hr",4),o(8,"div",2),r(9," Query "),l(10,"ya-filter-textarea",5),a(),l(11,"hr",4),o(12,"label"),r(13," Severity "),l(14,"br"),o(15,"ya-select",6),l(16,"ya-option",7)(17,"ya-option",8)(18,"ya-option",9)(19,"ya-option",10)(20,"ya-option",11)(21,"ya-option",12),a()(),l(22,"hr",4),o(23,"label"),r(24," Source "),l(25,"br")(26,"ya-multi-select",13),a(),l(27,"hr",4),o(28,"div",2),r(29," Share with other users "),l(30,"br")(31,"mat-slide-toggle",14),a()()(),o(32,"mat-dialog-actions",15)(33,"ya-button",16),r(34,"CANCEL"),a(),o(35,"ya-button",17),f("click",function(){return n.save()}),r(36,"SAVE"),a()()),e&2&&(c(3),p("formGroup",n.form),c(23),p("options",n.data.sourceOptions),c(9),p("disabled",!n.form.valid))},dependencies:[b,A,re,L,k,P,V,H,U,J,z,le,Y,me,Z,K,q],encapsulation:2,changeDetection:0})}};function ci(i,t){i&1&&r(0,` -
`)}function mi(i,t){if(i&1&&l(0,"ya-highlight",0),i&2){let e=d();p("text",e.summary)("term",e.highlight)}}function pi(i,t){if(i&1&&l(0,"br")(1,"ya-highlight",0),i&2){let e=d(2);c(),p("text",e.detail)("term",e.highlight)}}function di(i,t){if(i&1){let e=F();o(0,"ya-icon-action",1),f("click",function(){x(e);let s=d();return D(s.toggleExpanded())}),a(),v(1,pi,2,2),g(2,"async")}if(i&2){let e=d();c(),y(C(2,1,e.expanded$)?1:-1)}}var Fe=class i{constructor(){this.expanded$=new O(!1)}ngOnInit(){if(this.message!==null&&this.message!==void 0){let t=this.message.indexOf(`
`);t===-1?this.summary=this.message:(this.summary=this.message.substring(0,t),t+1<this.message.length&&(this.detail=this.message.substring(t+1)))}}toggleExpanded(){this.expanded$.next(!this.expanded$.value)}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=_({type:i,selectors:[["app-event-message"]],inputs:{message:"message",highlight:"highlight"},standalone:!0,features:[E],decls:3,vars:3,consts:[[3,"text","term"],["icon","more_horiz",3,"click"]],template:function(e,n){e&1&&v(0,ci,1,0)(1,mi,1,2,"ya-highlight",0)(2,di,3,3),e&2&&(y(n.summary===null||n.summary===void 0?0:-1),c(),y(n.summary!==null&&n.summary!==void 0?1:-1),c(),y(n.detail?2:-1))},dependencies:[b,ae,Pt,Lt],encapsulation:2,changeDetection:0})}};function ui(i,t){if(i&1&&l(0,"div",7),i&2){let e=d();Q("grayscale",e.grayscale)}}function vi(i,t){if(i&1&&l(0,"div",8),i&2){let e=d();Q("grayscale",e.grayscale)}}function fi(i,t){if(i&1&&l(0,"div",9),i&2){let e=d();Q("grayscale",e.grayscale)}}function hi(i,t){if(i&1&&l(0,"div",10),i&2){let e=d();Q("grayscale",e.grayscale)}}function yi(i,t){if(i&1&&l(0,"div",11),i&2){let e=d();Q("grayscale",e.grayscale)}}function gi(i,t){if(i&1&&l(0,"div",12),i&2){let e=d();Q("grayscale",e.grayscale)}}function Ci(i,t){if(i&1&&l(0,"div",13),i&2){let e=d();Q("grayscale",e.grayscale)}}var Ne=class i{constructor(){this.grayscale=!1}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=_({type:i,selectors:[["app-event-severity"]],inputs:{severity:"severity",grayscale:"grayscale"},standalone:!0,features:[E],decls:7,vars:1,consts:[[1,"info",3,"grayscale"],[1,"watch",3,"grayscale"],[1,"warning",3,"grayscale"],[1,"distress",3,"grayscale"],[1,"critical",3,"grayscale"],[1,"severe",3,"grayscale"],[1,"error",3,"grayscale"],[1,"info"],[1,"watch"],[1,"warning"],[1,"distress"],[1,"critical"],[1,"severe"],[1,"error"]],template:function(e,n){if(e&1&&v(0,ui,1,2,"div",0)(1,vi,1,2,"div",1)(2,fi,1,2,"div",2)(3,hi,1,2,"div",3)(4,yi,1,2,"div",4)(5,gi,1,2,"div",5)(6,Ci,1,2,"div",6),e&2){let s;y((s=n.severity)==="INFO"?0:s==="WATCH"?1:s==="WARNING"?2:s==="DISTRESS"?3:s==="CRITICAL"?4:s==="SEVERE"?5:s==="ERROR"?6:-1)}},dependencies:[b],styles:['.info[_ngcontent-%COMP%], .watch[_ngcontent-%COMP%], .warning[_ngcontent-%COMP%], .distress[_ngcontent-%COMP%], .critical[_ngcontent-%COMP%], .severe[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{display:inline-block;height:5px;width:29px;position:relative;background-image:url("./media/level-sprite.png")}.info[_ngcontent-%COMP%]{background-position:0 0}.watch[_ngcontent-%COMP%]{background-position:0 -5px}.warning[_ngcontent-%COMP%]{background-position:0 -10px}.distress[_ngcontent-%COMP%]{background-position:0 -15px}.critical[_ngcontent-%COMP%]{background-position:0 -20px}.severe[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{background-position:0 -25px}.grayscale[_ngcontent-%COMP%]{filter:grayscale(100%);-webkit-filter:grayscale(100%)}@media print{.info[_ngcontent-%COMP%], .watch[_ngcontent-%COMP%], .warning[_ngcontent-%COMP%], .distress[_ngcontent-%COMP%], .critical[_ngcontent-%COMP%], .severe[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{-webkit-print-color-adjust:exact;print-color-adjust:exact}}'],changeDetection:0})}};var Si=["*"],_i=()=>({matrixParams:"exact",paths:"exact",queryParams:"ignored"}),Zt=i=>({c:i}),pe=class i{constructor(t){this.yamcs=t}static{this.\u0275fac=function(e){return new(e||i)(u(T))}}static{this.\u0275cmp=_({type:i,selectors:[["app-events-page-tabs"]],standalone:!0,features:[E],ngContentSelectors:Si,decls:13,vars:12,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["tabPanel",""],["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","/events","routerLinkActive","",3,"routerLinkActiveOptions","active","queryParams"],["mat-tab-link","","routerLink","/events/queries","routerLinkActive","",3,"active","queryParams"],[2,"flex","1 1 auto"],[1,"actions"]],template:function(e,n){if(e&1&&(et(),o(0,"nav",3)(1,"a",4,0),r(3," Query "),a(),o(4,"a",5,1),r(6," Saved queries "),a(),l(7,"div",6),o(8,"div",7),tt(9),a()(),o(10,"mat-tab-nav-panel",null,2),l(12,"router-outlet"),a()),e&2){let s=$(2),m=$(5),He=$(11);p("mat-stretch-tabs",!1)("tabPanel",He),c(),p("routerLinkActiveOptions",ot(7,_i))("active",s.isActive)("queryParams",je(8,Zt,n.yamcs.context)),c(3),p("active",m.isActive)("queryParams",je(10,Zt,n.yamcs.context))}},dependencies:[b,ct,ge,mt,It,Ft,Ot],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}.actions[_ngcontent-%COMP%]{display:flex;align-items:center}"],changeDetection:0})}};var Re=class i{constructor(t,e,n){this.dialogRef=t;this.yamcs=e;this.data=n;this.downloadURL$=new O(null);this.form=new pt({start:new te(null),stop:new te(null),severity:new te(null,w.required),filter:new te(null),source:new te([]),delimiter:new te(null,w.required)});this.form.setValue({start:n.start?S.toISOString(n.start):"",stop:n.stop?S.toISOString(n.stop):"",filter:n.filter||"",source:n.source,severity:n.severity,delimiter:"TAB"}),this.formChangeSubscription=this.form.valueChanges.subscribe(()=>{this.updateURL()}),this.updateURL()}closeDialog(){this.dialogRef.close(!0)}updateURL(){if(this.form.valid){let t={delimiter:this.form.value.delimiter,severity:this.form.value.severity};if(this.form.value.start&&(t.start=S.toISOString(this.form.value.start)),this.form.value.stop&&(t.stop=S.toISOString(this.form.value.stop)),this.form.value.filter&&(t.filter=this.form.value.filter),this.form.value.source.length){let n=this.form.value.source;t.source=n}let e=this.yamcs.yamcsClient.getEventsDownloadURL(this.yamcs.instance,t);this.downloadURL$.next(e)}else this.downloadURL$.next(null)}ngOnDestroy(){this.formChangeSubscription?.unsubscribe()}static{this.\u0275fac=function(e){return new(e||i)(u(B),u(T),u(W))}}static{this.\u0275cmp=_({type:i,selectors:[["ng-component"]],standalone:!0,features:[E],decls:45,vars:6,consts:[["mat-dialog-title",""],[1,"ya-form"],[3,"formGroup"],[1,"label"],["formControlName","start"],[1,"half-break"],["formControlName","stop"],["formControlName","filter"],["formControlName","severity"],["id","INFO","label","Info level"],["id","WATCH","label","Watch level"],["id","WARNING","label","Warning level"],["id","DISTRESS","label","Distress level"],["id","CRITICAL","label","Critical level"],["id","SEVERE","label","Severe level"],["formControlName","source","emptyOption","Any source",3,"options"],["formControlName","delimiter"],["id","COMMA","label","Comma"],["id","SEMICOLON","label","Semicolon"],["id","TAB","label","Tab"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","link","disabled"]],template:function(e,n){e&1&&(o(0,"h2",0),r(1,"Export events"),a(),o(2,"mat-dialog-content",1)(3,"form",2)(4,"div",3),r(5," Start "),l(6,"ya-date-time-input",4),a(),l(7,"hr",5),o(8,"div",3),r(9," Stop "),l(10,"ya-date-time-input",6),a(),l(11,"hr",5),o(12,"div",3),r(13," Query "),l(14,"ya-filter-textarea",7),a(),l(15,"hr",5),o(16,"div",3),r(17," Severity "),l(18,"br"),o(19,"ya-select",8),l(20,"ya-option",9)(21,"ya-option",10)(22,"ya-option",11)(23,"ya-option",12)(24,"ya-option",13)(25,"ya-option",14),a()(),l(26,"hr",5),o(27,"div",3),r(28," Source "),l(29,"br")(30,"ya-multi-select",15),a(),l(31,"hr",5),o(32,"div",3),r(33," CSV column delimiter "),l(34,"br"),o(35,"ya-select",16),l(36,"ya-option",17)(37,"ya-option",18)(38,"ya-option",19),a()()()(),o(39,"mat-dialog-actions",20)(40,"ya-button",21),r(41,"CANCEL"),a(),o(42,"ya-download-button",22),g(43,"async"),f("click",function(){return n.closeDialog()}),r(44," DOWNLOAD "),a()()),e&2&&(c(3),p("formGroup",n.form),c(27),p("options",n.data.sourceOptions),c(12),p("link",C(43,4,n.downloadURL$))("disabled",!n.form.valid))},dependencies:[b,ae,A,L,k,P,V,H,U,J,z,Y,ce,At,me,Z,K,q],encapsulation:2})}};function de(i,t,e,n){let s=t.label+' = ""',m=ve(i.state,s,e,n);m.selection={anchor:e+s.length-1},i.dispatch(m)}function ei(i,t,e,n){i.dispatch(ve(i.state,t.label+" = ",e,n))}function ti(i,t,e,n){i.dispatch(ve(i.state,t.label+" = ",e,n))}function We(i,t,e,n){i.dispatch(ve(i.state,t.label+" ",e,n))}var ii=[{label:"message",type:"method",info:"Filter on event message",apply:de},{label:"seqNumber",type:"method",info:"Filter on event sequence number",apply:ti},{label:"severity",type:"method",info:"Filter on event severity (info, watch, warning, distress, critical, severe)",apply:ei},{label:"source",type:"method",info:"Filter on event source",apply:de},{label:"type",type:"method",info:"Filter on event type",apply:de},{section:"Exclude events",label:"-message",type:"method",info:"Exclude events based on message",apply:de},{section:"Exclude events",label:"-seqNumber",type:"method",info:"Exclude events based on sequence number",apply:ti},{section:"Exclude events",label:"-severity",type:"method",info:"Exclude events based on severity (info, watch, warning, distress, critical, severe)",apply:ei},{section:"Exclude events",label:"-source",type:"method",info:"Exclude events based on source",apply:de},{section:"Exclude events",label:"-type",type:"method",info:"Exclude events based on type",apply:de},{section:"Logical operators",label:"AND",type:"constant",apply:We},{section:"Logical operators",label:"OR",type:"constant",apply:We},{section:"Logical operators",label:"NOT",type:"constant",apply:We}];var Le=class{constructor(t){this.watermarkObserver=t;this.dirty=!1;this.archiveEvents=[];this.bufferSize=500;this.bufferWatermark=400;this.pointer=0;this.alreadyWarned=!1;this.realtimeBuffer=Array(this.bufferSize).fill(void 0)}addArchiveData(t){this.archiveEvents=this.archiveEvents.concat(t),this.dirty=!0}addRealtimeEvent(t){this.pointer<this.bufferSize&&(this.realtimeBuffer[this.pointer]=t,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.alreadyWarned=!0,this.watermarkObserver()),this.pointer=this.pointer+1),this.dirty=!0}reset(){this.archiveEvents=[],this.realtimeBuffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.dirty=!0}snapshot(){let t=this.realtimeBuffer.filter(n=>n!==void 0);return this.archiveEvents.concat(t).sort((n,s)=>{let m=-n.generationTime.localeCompare(s.generationTime);return m===0&&(m=-n.source.localeCompare(s.source)),m!==0?m:s.seqNumber-n.seqNumber})}compact(t){let e=this.snapshot();e.length=Math.min(t,e.length),this.reset(),this.archiveEvents=e,this.dirty=!0}};var ke=class extends vt{constructor(e,n){super();this.yamcs=e;this.pageSize=100;this.blockHasMore=!1;this.events$=new O([]);this.sources$=new O([]);this.loading$=new O(!1);this.streaming$=new O(!1);this.syncSubscription=n.sync(()=>{this.eventBuffer.dirty&&!this.loading$.getValue()&&(this.emitEvents(),this.eventBuffer.dirty=!1)}),this.eventBuffer=new Le(()=>{this.blockHasMore=!0,this.eventBuffer.compact(500)})}connect(){return this.events$}emitEvents(){this.events$.next(this.eventBuffer.snapshot())}loadEvents(e){return this.loading$.next(!0),this.streaming$.value&&this.realtimeSubscription.sendMessage({instance:this.yamcs.instance,filter:e.filter}),Promise.all([this.yamcs.yamcsClient.getEventSources(this.yamcs.instance),this.loadPage(qe(Ye({},e),{limit:this.pageSize+1}))]).then(n=>{let s=n[0],m=n[1];return this.eventBuffer.reset(),this.blockHasMore=!1,this.eventBuffer.addArchiveData(m),this.sources$.next(s),this.emitEvents(),m}).catch(n=>{throw this.eventBuffer.reset(),n}).finally(()=>{this.loading$.next(!1)})}hasMore(){return this.offscreenRecord!=null&&!this.blockHasMore}loadPage(e){return this.options=e,this.yamcs.yamcsClient.getEvents(this.yamcs.instance,e).then(n=>(n.length>this.pageSize?(n.splice(n.length-1,1),this.offscreenRecord=n[n.length-1]):this.offscreenRecord=null,n))}async loadMoreData(e){if(this.offscreenRecord)return this.loadPage(qe(Ye({},e),{stop:this.offscreenRecord.generationTime,limit:this.pageSize+1})).then(n=>{this.eventBuffer.addArchiveData(n),this.emitEvents()})}startStreaming(){this.streaming$.next(!0),this.realtimeSubscription=this.yamcs.yamcsClient.createEventSubscription({instance:this.yamcs.instance,filter:this.options.filter},e=>{this.addEventSource(e),!this.loading$.getValue()&&this.matchesFilter(e)&&this.eventBuffer.addRealtimeEvent(e)})}addEventSource(e){if(e.source){for(let n of this.sources$.value)if(n===e.source)return;this.sources$.next([...this.sources$.value,e.source].sort((n,s)=>n.toLowerCase().localeCompare(s.toLocaleLowerCase())))}}matchesFilter(e){if(this.options){if(this.options.source&&e.source!==this.options.source)return!1;if(this.options.severity)switch(this.options.severity){case"SEVERE":case"ERROR":if(e.severity==="CRITICAL")return!1;case"CRITICAL":if(e.severity==="DISTRESS")return!1;case"DISTRESS":if(e.severity==="WARNING")return!1;case"WARNING":if(e.severity==="WATCH")return!1;case"WATCH":if(e.severity==="INFO")return!1}}return!0}stopStreaming(){this.realtimeSubscription?.cancel(),this.streaming$.next(!1)}disconnect(){this.stopStreaming(),this.syncSubscription?.unsubscribe(),this.events$.complete(),this.sources$.complete(),this.loading$.complete(),this.streaming$.complete()}};var bi=["searchFilter"];function xi(i,t){if(i&1){let e=F();o(0,"ya-page-button",7),f("click",function(){x(e);let s=d();return D(s.createEvent())}),r(1," Create event "),a()}}function Di(i,t){if(i&1){let e=F();o(0,"ya-page-button",8),f("click",function(){x(e);let s=d();return D(s.stopStreaming())}),r(1," Stop streaming "),a()}}function Ti(i,t){if(i&1){let e=F();o(0,"ya-page-button",9),f("click",function(){x(e);let s=d();return D(s.startStreaming())}),r(1,"Start streaming"),a()}}function wi(i,t){if(i&1){let e=F();l(0,"ya-date-time-input",51)(1,"ya-date-time-input",52),o(2,"ya-button",50),f("click",function(){x(e);let s=d(2);return D(s.applyCustomDates())}),r(3," Apply "),a()}if(i&2){let e=d(2);c(2),p("disabled",e.filterForm.invalid)}}function Mi(i,t){if(i&1){let e=F();o(0,"ya-button",53),f("click",function(){x(e);let s=d(2);return D(s.jumpToNow())}),r(1,"Jump to now"),a()}}function Ii(i,t){if(i&1&&(o(0,"span"),r(1," Showing events from "),o(2,"b"),r(3,"the last hour"),a(),r(4," ending at "),o(5,"b"),r(6),g(7,"datetime"),a(),r(8," (Mission Time) "),a()),i&2){let e=d(2);c(6),oe(C(7,1,e.validStop))}}function Oi(i,t){if(i&1&&(o(0,"span"),r(1," Showing events from "),o(2,"b"),r(3,"the last 6 hours"),a(),r(4," ending at "),o(5,"b"),r(6),g(7,"datetime"),a(),r(8," (Mission Time) "),a()),i&2){let e=d(2);c(6),oe(C(7,1,e.validStop))}}function Fi(i,t){if(i&1&&(o(0,"span"),r(1," Showing events from "),o(2,"b"),r(3,"the last 24 hours"),a(),r(4," ending at "),o(5,"b"),r(6),g(7,"datetime"),a(),r(8," (Mission Time) "),a()),i&2){let e=d(2);c(6),oe(C(7,1,e.validStop))}}function Ni(i,t){i&1&&(o(0,"span"),r(1," Showing events from "),o(2,"b"),r(3,"all time"),a()())}function Ri(i,t){if(i&1&&(o(0,"span"),r(1," Showing events from "),o(2,"b"),r(3),g(4,"datetime"),a(),r(5," to "),o(6,"b"),r(7),g(8,"datetime"),a(),r(9," (Mission Time) "),a()),i&2){let e=d(2);c(3),oe(C(4,2,e.validStart)),c(4),oe(C(8,4,e.validStop))}}function Li(i,t){i&1&&l(0,"ya-dots")}function ki(i,t){i&1&&(o(0,"div",32),r(1," Listening for events "),l(2,"ya-dots",54),a())}function Ai(i,t){if(i&1){let e=F();r(0," \xA0 "),o(1,"a",55),f("click",function(s){return x(e),d(2),$(16).doSearch(),D(s.preventDefault())}),r(2," Apply filter "),a(),r(3," . ")}}function Pi(i,t){if(i&1&&(o(0,"ya-table-top"),r(1," The search filter has changed. "),v(2,Ai,4,0),g(3,"async"),a()),i&2){d();let e=$(16);c(2),y(C(3,1,e.errorState$)?-1:2)}}function Vi(i,t){i&1&&(o(0,"th",56),r(1,"Severity"),a())}function Yi(i,t){if(i&1&&(o(0,"td",57),l(1,"app-event-severity",58),a()),i&2){let e=t.$implicit;c(),p("severity",e.severity)}}function qi(i,t){i&1&&(o(0,"th",56),r(1,"Message"),a())}function $i(i,t){if(i&1&&(o(0,"td",59),l(1,"app-event-message",60),a()),i&2){let e=t.$implicit,n=d(2);c(),p("message",e.message)("highlight",n.filterForm.value.filter)}}function ji(i,t){i&1&&(o(0,"th",56),r(1,"Type"),a())}function Gi(i,t){if(i&1&&(o(0,"td",57),r(1),a()),i&2){let e=t.$implicit;c(),N(" ",e.type||"-"," ")}}function Qi(i,t){i&1&&(o(0,"th",56),r(1,"Source"),a())}function Bi(i,t){if(i&1&&(o(0,"td",57),r(1),a()),i&2){let e=t.$implicit;c(),N(" ",e.source||"-"," ")}}function Wi(i,t){i&1&&(o(0,"th",56),r(1,"Generation time"),a())}function Hi(i,t){if(i&1&&(o(0,"td",61),r(1),g(2,"datetime"),a()),i&2){let e=t.$implicit;c(),N(" ",C(2,1,e.generationTime)||"-"," ")}}function Ui(i,t){i&1&&(o(0,"th",56),r(1,"Reception time"),a())}function zi(i,t){if(i&1&&(o(0,"td",61),r(1),g(2,"datetime"),a()),i&2){let e=t.$implicit;c(),N(" ",C(2,1,e.receptionTime)||"-"," ")}}function Ji(i,t){i&1&&(o(0,"th",56),r(1,"Sequence number"),a())}function Ki(i,t){if(i&1&&(o(0,"td",57),r(1),a()),i&2){let e,n=t.$implicit;c(),N(" ",(e=n.seqNumber)!==null&&e!==void 0?e:"-"," ")}}function Xi(i,t){if(i&1&&(o(0,"th",56),r(1),a()),i&2){let e=d().$implicit;c(),N(" ",e.label," ")}}function Zi(i,t){if(i&1&&r(0),i&2){let e,n=d().$implicit,s=d().$implicit;N(" ",(e=n.extra[s.id])!==null&&e!==void 0?e:"-"," ")}}function en(i,t){i&1&&r(0," - ")}function tn(i,t){if(i&1&&(o(0,"td",57),v(1,Zi,1,1)(2,en,1,0),a()),i&2){let e=t.$implicit;c(),y(e.extra?1:2)}}function nn(i,t){if(i&1&&(M(0,47),v(1,Xi,2,1,"th",37)(2,tn,3,1,"td",38),I()),i&2){let e=t.$implicit;p("cdkColumnDef",e.id)}}function on(i,t){i&1&&l(0,"tr",62)}function an(i,t){if(i&1&&l(0,"tr",63),i&2){let e=t.$implicit;p("ngClass",e.severity)}}function rn(i,t){if(i&1){let e=F();o(0,"div",6)(1,"app-events-page-tabs")(2,"ya-button",10),f("click",function(){x(e);let s=d();return D(s.clearQuery())}),r(3," Clear query "),a(),o(4,"ya-button",11),f("click",function(){x(e);let s=d();return D(s.openSaveQueryDialog())}),r(5," Save query "),a()(),o(6,"form",12)(7,"div",13)(8,"ya-select",14),l(9,"ya-option",15)(10,"ya-option",16)(11,"ya-option",17)(12,"ya-option",18)(13,"ya-option",19),a(),v(14,wi,4,1),o(15,"ya-search-filter2",20,0),f("typedValue",function(s){x(e);let m=d();return D(m.parseQuery(s))}),a(),o(17,"ya-select",21),l(18,"ya-option",22)(19,"ya-option",23)(20,"ya-option",24)(21,"ya-option",25)(22,"ya-option",26)(23,"ya-option",27),a(),l(24,"ya-multi-select",28),g(25,"async"),v(26,Mi,2,0,"ya-button"),o(27,"mat-slide-toggle",29),r(28," Multiline "),a()()(),o(29,"div",30)(30,"div"),v(31,Ii,9,3,"span")(32,Oi,9,3,"span")(33,Fi,9,3,"span")(34,Ni,4,0,"span")(35,Ri,10,6,"span"),a(),l(36,"div",31),v(37,Li,1,0,"ya-dots"),g(38,"async"),v(39,ki,3,0,"div",32),g(40,"async"),o(41,"ya-button",33),f("click",function(){x(e);let s=d();return D(s.exportEvents())}),r(42,"Export CSV"),a(),l(43,"ya-column-chooser",34,1),a(),v(45,Pi,4,3,"ya-table-top"),o(46,"table",35),M(47,36),v(48,Vi,2,0,"th",37)(49,Yi,2,1,"td",38),I(),M(50,39),v(51,qi,2,0,"th",37)(52,$i,2,2,"td",40),I(),M(53,41),v(54,ji,2,0,"th",37)(55,Gi,2,1,"td",38),I(),M(56,42),v(57,Qi,2,0,"th",37)(58,Bi,2,1,"td",38),I(),M(59,43),v(60,Wi,2,0,"th",37)(61,Hi,3,3,"td",44),I(),M(62,45),v(63,Ui,2,0,"th",37)(64,zi,3,3,"td",44),I(),M(65,46),v(66,Ji,2,0,"th",37)(67,Ki,2,1,"td",38),I(),Xe(68,nn,3,1,"ng-container",47,Ke),v(70,on,1,0,"tr",48),g(71,"async"),v(72,an,1,1,"tr",49),g(73,"async"),a(),o(74,"mat-toolbar"),l(75,"span",31),o(76,"ya-button",50),f("click",function(){x(e);let s=d();return D(s.loadMoreData())}),r(77,"Load more"),a(),l(78,"span",31),a()()}if(i&2){let e,n=$(16),s=$(44),m=d();c(2),p("disabled",!m.isClearQueryEnabled()),c(4),p("formGroup",m.filterForm),c(8),y(m.filterForm.value.interval==="CUSTOM"?14:-1),c(),p("completions",m.completions)("expanded",m.multilineControl.value),c(9),p("options",C(25,18,m.sourceOptions$)),c(2),y(m.filterForm.value.interval!=="CUSTOM"?26:-1),c(),p("disableRipple",!0)("formControl",m.multilineControl),c(4),y((e=m.appliedInterval)==="PT1H"?31:e==="PT6H"?32:e==="P1D"?33:e==="NO_LIMIT"?34:e==="CUSTOM"?35:-1),c(6),y(C(38,20,m.dataSource.loading$)?37:-1),c(2),y(C(40,22,m.dataSource.streaming$)?39:-1),c(4),p("columns",m.columns),c(2),y(n.dirty()?45:-1),c(),p("dataSource",m.dataSource),c(22),Ze(m.extraColumns),c(2),p("cdkHeaderRowDef",C(71,24,s.displayedColumns$)),c(2),p("cdkRowDefColumns",C(73,26,s.displayedColumns$)),c(4),p("disabled",!m.dataSource.hasMore())}}var ue="PT1H",Ae=class i{constructor(t,e,n,s,m,He,hn,ri,si){this.yamcs=t;this.authService=e;this.dialog=n;this.messageService=m;this.router=He;this.route=hn;this.filter=G();this.severity=G();this.source=G();this.interval=G();this.customStart=G();this.customStop=G();this.parseFilterSubscription=G.required();this.searchFilter=Je.required("searchFilter");this.completions=ii;this.filterForm=new se({filter:new h(null),severity:new h("INFO"),source:new h([]),interval:new h(ue),customStart:new h(null),customStop:new h(null)});this.multilineControl=new h(!1);this.columns=[{id:"severity",label:"Severity",visible:!0},{id:"gentime",label:"Generation time",alwaysVisible:!0},{id:"message",label:"Message",alwaysVisible:!0},{id:"source",label:"Source",visible:!0},{id:"type",label:"Type",visible:!0},{id:"rectime",label:"Reception time"},{id:"seqNumber",label:"Sequence number"}];this.extraColumns=[];this.sourceOptions$=new O([]);this.downloadURL$=new O(null);ri.setTitle("Events");let Ue=s.getConfig().events;if(Ue){this.extraColumns=Ue.extraColumns||[];for(let ne of this.extraColumns)for(let R=0;R<this.columns.length;R++)if(this.columns[R].id===ne.after){this.columns.splice(R+1,0,ne);break}}t.yamcsClient.getEventSources(t.instance).then(ne=>{for(let R of ne)this.sourceOptions$.next([...this.sourceOptions$.value,{id:R,label:R}])}),this.dataSource=new ke(t,si),this.dataSource.sources$.subscribe(ne=>{this.sourceOptions$.next(ne.map(R=>({id:R,label:R})))})}isClearQueryEnabled(){let t=this.filterForm.value;return this.searchFilter().empty()||t.severity!=="INFO"||t.source?.length}ngOnInit(){this.parseFilterSubscription().addMessageListener(t=>{t.errorMessage?this.searchFilter().addErrorMark(t.errorMessage,{beginLine:t.beginLine,beginColumn:t.beginColumn,endLine:t.endLine,endColumn:t.endColumn}):this.searchFilter().clearErrorMark()}),this.initializeOptions(),this.loadData(),this.filterForm.get("filter").valueChanges.forEach(t=>{this.loadData()}),this.filterForm.get("severity").valueChanges.forEach(t=>{this.loadData()}),this.filterForm.get("source").valueChanges.forEach(t=>{this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(t=>{if(t==="CUSTOM"){let e=this.validStart||this.yamcs.getMissionTime(),n=this.validStop||this.yamcs.getMissionTime();this.filterForm.get("customStart").setValue(S.toISOString(e)),this.filterForm.get("customStop").setValue(S.toISOString(n))}else t==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=t,this.loadData()):t&&(this.validStop=this.yamcs.getMissionTime(),this.validStart=S.subtractDuration(this.validStop,t),this.appliedInterval=t,this.loadData())})}ngAfterViewInit(){(this.filter()||"").indexOf(`
`)!==-1&&this.multilineControl.setValue(!0)}initializeOptions(){if(this.filter()){let t=this.filter();this.filterForm.get("filter").setValue(t)}if(this.severity()){let t=this.severity();this.filterForm.get("severity").setValue(t)}if(this.source()){let t=this.source();this.filterForm.get("source").setValue(t)}if(this.interval())if(this.appliedInterval=this.interval(),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let t=this.customStart();this.filterForm.get("customStart").setValue(t),this.validStart=S.toDate(t);let e=this.customStop();this.filterForm.get("customStop").setValue(e),this.validStop=S.toDate(e)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=this.yamcs.getMissionTime(),this.validStart=S.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval=ue,this.validStop=this.yamcs.getMissionTime(),this.validStart=S.subtractDuration(this.validStop,ue)}jumpToNow(){let t=this.filterForm.controls.interval.value;t==="NO_LIMIT"?this.filterForm.get("interval").setValue(ue):t==="CUSTOM"?this.filterForm.get("interval").setValue(ue):t&&(this.validStop=this.yamcs.getMissionTime(),this.validStart=S.subtractDuration(this.validStop,t),this.loadData())}startStreaming(){this.filterForm.get("interval").setValue("NO_LIMIT"),this.dataSource.startStreaming()}stopStreaming(){this.dataSource.stopStreaming()}applyCustomDates(){let{controls:t}=this.filterForm;this.validStart=S.toDate(t.customStart.value),this.validStop=S.toDate(t.customStop.value),this.appliedInterval="CUSTOM",this.loadData()}loadData(){let{controls:t}=this.filterForm;this.updateURL();let e={severity:t.severity.value};this.validStart&&(e.start=this.validStart.toISOString()),this.validStop&&(e.stop=this.validStop.toISOString());let n=t.filter.value;n&&(e.filter=n);let s=t.source.value;s?.length&&(e.source=s),this.dataSource.loadEvents(e).catch(m=>this.messageService.showError(m))}loadMoreData(){let{controls:t}=this.filterForm,e={severity:t.severity.value};this.validStart&&(e.start=this.validStart.toISOString());let n=t.filter.value;n&&(e.filter=n);let s=t.source.value;s?.length&&(e.source=s),this.dataSource.loadMoreData(e).catch(m=>this.messageService.showError(m))}updateURL(){let{controls:t}=this.filterForm;this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:t.filter.value||null,severity:t.severity.value,source:t.source.value?t.source.value:null,interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?t.customStart.value:null,customStop:this.appliedInterval==="CUSTOM"?t.customStop.value:null},queryParamsHandling:"merge"})}clearQuery(){this.filterForm.reset({severity:"INFO",source:[],interval:ue})}openSaveQueryDialog(){let{controls:t}=this.filterForm;this.dialog.open(Oe,{width:"800px",data:{severity:t.severity.value,filter:this.searchFilter().getTypedValue(),source:t.source.value,sourceOptions:this.sourceOptions$.value}}).afterClosed().subscribe(e=>{e&&this.messageService.showInfo("Query saved")})}parseQuery(t){this.parseFilterSubscription().sendMessage({resource:"events",filter:t})}mayWriteEvents(){return this.authService.getUser().hasSystemPrivilege("WriteEvents")}createEvent(){this.dialog.open(Me,{width:"400px"}).afterClosed().subscribe(e=>{e&&this.jumpToNow()})}exportEvents(){let{controls:t}=this.filterForm;this.dialog.open(Re,{width:"800px",data:{severity:t.severity.value,start:this.validStart,stop:this.validStop,filter:t.filter.value,source:t.source.value,sourceOptions:this.sourceOptions$.value}})}ngOnDestroy(){this.parseFilterSubscription().cancel()}static{this.\u0275fac=function(e){return new(e||i)(u(T),u(De),u(Ce),u(Rt),u(X),u(ye),u(lt),u(st),u(Qt))}}static{this.\u0275cmp=_({type:i,selectors:[["ng-component"]],viewQuery:function(e,n){e&1&&it(n.searchFilter,bi,5),e&2&&nt()},inputs:{filter:[1,"filter"],severity:[1,"severity"],source:[1,"source"],interval:[1,"interval"],customStart:[1,"customStart"],customStop:[1,"customStop"],parseFilterSubscription:[1,"parseFilterSubscription"]},standalone:!0,features:[E],decls:9,vars:5,consts:[["searchFilter",""],["columnChooser",""],["icon","add_circle_outline"],["matTooltip","Pause streaming events","icon","pause"],["icon","play_arrow"],["matTooltip","Jump to now","icon","refresh",3,"click"],[1,"panel-content"],["icon","add_circle_outline",3,"click"],["matTooltip","Pause streaming events","icon","pause",3,"click"],["icon","play_arrow",3,"click"],["appearance","text","icon","clear",3,"click","disabled"],["appearance","text","icon","save",3,"click"],[3,"formGroup"],[1,"filter-bar","query",2,"margin-top","16px"],["icon","access_time","formControlName","interval"],["id","PT1H","label","Last hour"],["id","PT6H","label","Last 6 hours"],["id","P1D","label","Last 24 hours"],["id","NO_LIMIT","label","No limit"],["id","CUSTOM","label","Custom","group","true"],["formControlName","filter","placeholder","Search events",2,"flex","1 1 auto","margin-right","7px",3,"typedValue","completions","expanded"],["formControlName","severity"],["id","INFO","label","Info level"],["id","WATCH","label","Watch level"],["id","WARNING","label","Warning level"],["id","DISTRESS","label","Distress level"],["id","CRITICAL","label","Critical level"],["id","SEVERE","label","Severe level"],["formControlName","source","emptyOption","Any source",3,"options"],[3,"disableRipple","formControl"],[1,"table-actions"],[2,"flex","1 1 auto"],[2,"text-align","right","flex","1 1 150px"],["appearance","text","icon","download",3,"click"],["preferenceKey","events","appearance","text","icon","view_columns",3,"columns"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","severity"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","message"],["mat-cell","","class","mono message expand",4,"cdkCellDef"],["cdkColumnDef","type"],["cdkColumnDef","source"],["cdkColumnDef","gentime"],["mat-cell","","style","white-space: nowrap",4,"cdkCellDef"],["cdkColumnDef","rectime"],["cdkColumnDef","seqNumber"],[3,"cdkColumnDef"],["mat-header-row","",4,"cdkHeaderRowDef"],["mat-row","",3,"ngClass",4,"cdkRowDef","cdkRowDefColumns"],[3,"click","disabled"],["formControlName","customStart"],["formControlName","customStop"],[3,"click"],["fontSize","16px"],["href","",1,"ya-link",3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"severity"],["mat-cell","",1,"mono","message","expand"],[3,"message","highlight"],["mat-cell","",2,"white-space","nowrap"],["mat-header-row",""],["mat-row","",3,"ngClass"]],template:function(e,n){e&1&&(o(0,"app-instance-page")(1,"app-instance-toolbar"),r(2," Events \xA0\xA0\xA0 "),v(3,xi,2,0,"ya-page-button",2)(4,Di,2,0,"ya-page-button",3),g(5,"async"),v(6,Ti,2,0,"ya-page-button",4),o(7,"ya-page-icon-button",5),f("click",function(){return n.jumpToNow()}),a()(),v(8,rn,79,28,"div",6),a()),e&2&&(c(3),y(n.mayWriteEvents()?3:-1),c(),y(C(5,3,n.dataSource.streaming$)?4:6),c(4),y(n.dataSource?8:-1))},dependencies:[Fe,pe,Ne,we,Te,b,rt,ae,A,L,k,dt,P,V,Et,gt,Ct,St,_t,le,Se,_e,Ee,be,xe,yt,ht,Y,Nt,ce,kt,Z,K,Yt,qt,$t,q,jt,Gt],styles:[".filter-bar.query[_ngcontent-%COMP%]{height:unset}.table-status[_ngcontent-%COMP%]{background-color:var(--y-background-color);height:24px;line-height:24px;font-size:12px;padding-left:6px}.table-status[_ngcontent-%COMP%]   .message-zone[_ngcontent-%COMP%]{float:right;height:24px;line-height:24px;font-size:12px;padding-right:6px}.ya-data-table[_ngcontent-%COMP%]   td.mat-mdc-cell.message[_ngcontent-%COMP%]{white-space:pre-wrap}"],changeDetection:0})}};var ni="INFO",oi=[],Pe=class i{constructor(t,e,n,s){this.dialogRef=t;this.yamcs=e;this.messageService=n;this.data=s;this.form=new se({name:new h("",w.required),filter:new h(""),severity:new h(ni,w.required),source:new h(oi),shared:new h(!1,w.required)});let{query:m}=s;this.form.patchValue({name:m.name,filter:m.query.filter||void 0,severity:m.query.severity,source:m.query.source,shared:m.shared})}save(){let{value:t}=this.form,e=this.data.query.id;this.yamcs.yamcsClient.editQuery(this.yamcs.instance,"events",e,{name:t.name,shared:t.shared??!1,query:{filter:t.filter??void 0,source:t.source??oi,severity:t.severity??ni}}).then(n=>this.dialogRef.close(n)).catch(n=>this.messageService.showError(n))}static{this.\u0275fac=function(e){return new(e||i)(u(B),u(T),u(X),u(W))}}static{this.\u0275cmp=_({type:i,selectors:[["app-edit-event-query-dialog"]],standalone:!0,features:[E],decls:37,vars:3,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],[1,"label"],["formControlName","name","type","text"],[1,"half-break"],["formControlName","filter"],["formControlName","severity"],["id","INFO","label","Info level"],["id","WATCH","label","Watch level"],["id","WARNING","label","Warning level"],["id","DISTRESS","label","Distress level"],["id","CRITICAL","label","Critical level"],["id","SEVERE","label","Severe level"],["formControlName","source","emptyOption","Any source",3,"options"],["formControlName","shared"],["align","end"],["mat-dialog-close",""],["appearance","primary",3,"click","disabled"]],template:function(e,n){e&1&&(o(0,"h2",0),r(1,"Edit query"),a(),o(2,"mat-dialog-content")(3,"form",1)(4,"div",2),r(5," Name "),l(6,"input",3),a(),l(7,"hr",4),o(8,"div",2),r(9," Query "),l(10,"ya-filter-textarea",5),a(),l(11,"hr",4),o(12,"label"),r(13," Severity "),l(14,"br"),o(15,"ya-select",6),l(16,"ya-option",7)(17,"ya-option",8)(18,"ya-option",9)(19,"ya-option",10)(20,"ya-option",11)(21,"ya-option",12),a()(),l(22,"hr",4),o(23,"label"),r(24," Source "),l(25,"br")(26,"ya-multi-select",13),a(),l(27,"hr",4),o(28,"div",2),r(29," Share with other users "),l(30,"br")(31,"mat-slide-toggle",14),a()()(),o(32,"mat-dialog-actions",15)(33,"ya-button",16),r(34,"CANCEL"),a(),o(35,"ya-button",17),f("click",function(){return n.save()}),r(36,"SAVE"),a()()),e&2&&(c(3),p("formGroup",n.form),c(23),p("options",n.data.sourceOptions),c(9),p("disabled",!n.form.valid))},dependencies:[b,A,re,L,k,P,V,H,U,J,z,le,Y,me,Z,K,q],encapsulation:2,changeDetection:0})}};var sn=(i,t,e,n)=>({filter:i,severity:t,source:e,c:n});function ln(i,t){i&1&&(o(0,"th",11),r(1,"Name"),a())}function cn(i,t){if(i&1&&(o(0,"td",12)(1,"a",13),r(2),a()()),i&2){let e=t.$implicit,n=d();c(),p("queryParams",at(2,sn,e.query.filter,e.query.severity,e.query.source,n.yamcs.context)),c(),N(" ",e.name," ")}}function mn(i,t){i&1&&(o(0,"th",14),r(1,"Visibility"),a())}function pn(i,t){if(i&1&&(o(0,"td",12),r(1),a()),i&2){let e=t.$implicit;c(),N(" ",e.shared?"Shared":"Private"," ")}}function dn(i,t){i&1&&l(0,"th",15)}function un(i,t){if(i&1){let e=F();o(0,"td",12)(1,"ya-more")(2,"button",16),f("click",function(){let s=x(e).$implicit,m=d();return D(m.openEditQueryDialog(s))}),r(3,"Edit query"),a(),o(4,"button",16),f("click",function(){let s=x(e).$implicit,m=d();return D(m.openDeleteQueryDialog(s))}),r(5,"Delete query"),a()()()}}function vn(i,t){i&1&&l(0,"tr",17)}function fn(i,t){i&1&&l(0,"tr",18)}var Ve=class i{constructor(t,e,n){this.yamcs=t;this.messageService=e;this.dialog=n;this.displayedColumns=["name","visibility","actions"];this.dataSource=new Mt;this.sourceOptions=[];this.refreshTable(),t.yamcsClient.getEventSources(t.instance).then(s=>{this.sourceOptions=s.map(m=>({id:m,label:m}))})}refreshTable(){this.yamcs.yamcsClient.getQueries(this.yamcs.instance,"events").then(t=>this.dataSource.data=t).catch(t=>this.messageService.showError(t))}openEditQueryDialog(t){this.dialog.open(Pe,{width:"800px",data:{query:t,sourceOptions:this.sourceOptions}}).afterClosed().subscribe(e=>{e&&(this.refreshTable(),this.messageService.showInfo("Query updated"))})}openDeleteQueryDialog(t){confirm(`Are you sure you want to delete query ${t.name}`)&&this.yamcs.yamcsClient.deleteQuery(this.yamcs.instance,"events",t.id).then(()=>this.refreshTable()).catch(e=>this.messageService.showError(e))}static{this.\u0275fac=function(e){return new(e||i)(u(T),u(X),u(Ce))}}static{this.\u0275cmp=_({type:i,selectors:[["app-event-query-list"]],standalone:!0,features:[E],decls:17,vars:3,consts:[[1,"panel-content"],["mat-table","",1,"ya-data-table","expand",2,"margin-top","16px",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","style","min-width: 200px",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","visibility"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",2,"min-width","200px"],["mat-cell",""],["routerLink","/events",3,"queryParams"],["mat-header-cell",""],["mat-header-cell","",1,"expand"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(e,n){e&1&&(o(0,"app-instance-page")(1,"app-instance-toolbar"),r(2,"Events"),a(),o(3,"div",0),l(4,"app-events-page-tabs"),o(5,"table",1),M(6,2),v(7,ln,2,0,"th",3)(8,cn,3,7,"td",4),I(),M(9,5),v(10,mn,2,0,"th",6)(11,pn,2,1,"td",4),I(),M(12,7),v(13,dn,1,0,"th",8)(14,un,6,0,"td",4),I(),v(15,vn,1,0,"tr",9)(16,fn,1,0,"tr",10),a()()()),e&2&&(c(5),p("dataSource",n.dataSource),c(10),p("matHeaderRowDef",n.displayedColumns),c(),p("matRowDefColumns",n.displayedColumns))},dependencies:[Te,we,pe,b,ge,ft,Se,xt,Tt,Dt,bt,wt,_e,Ee,be,xe,Vt],encapsulation:2})}};var ai=(i,t)=>{let n=he(T).yamcsClient.createParseFilterSubscription({resource:"events",filter:""},()=>null);return new Promise((s,m)=>{n.addReplyListener(()=>{s(n)})})};var xa=[{path:"",canActivate:[Wt,Bt],canActivateChild:[Ht],runGuardsAndResolvers:"always",component:Ut,children:[{path:"",pathMatch:"full",component:Ae,canActivate:[Be],resolve:{parseFilterSubscription:ai}},{path:"queries",component:Ve,canActivate:[Be]}]}];export{xa as ROUTES};
